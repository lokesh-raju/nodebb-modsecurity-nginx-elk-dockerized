"use strict";define("admin/manage/categories",["vendor/jquery/serializeObject/jquery.ba-serializeobject.min","translator","benchpress","categorySelector"],function(e,a,t,n){var i={};var r=-1;var o;i.init=function(){socket.emit("admin.categories.getAll",function(e,a){if(e){return app.alertError(e.message)}i.render(a)});$('button[data-action="create"]').on("click",i.throwCreateModal);$(".categories").on("click",'button[data-action="toggle"]',function(){var e=$(this);var a=e.attr("data-cid");var t=e.parents('li[data-cid="'+a+'"]');var n=t.hasClass("disabled");var r=t.find("li[data-cid]");var o=r.map(function(){return $(this).attr("data-cid")}).get();t.toggleClass("disabled",!n);r.toggleClass("disabled",!n);e.translateText(!n?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]");e.toggleClass("btn-primary",!n).toggleClass("btn-danger",n);r.find('button[data-action="toggle"]').translateText(!n?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]");r.find('button[data-action="toggle"]').toggleClass("btn-primary",!n).toggleClass("btn-danger",n);i.toggle([a].concat(o),!n);return false});$(".categories").on("click",".toggle",function(){var e=$(this);e.find("i").toggleClass("fa-minus").toggleClass("fa-plus");e.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden")});$("#collapse-all").on("click",function(){e(false)});$("#expand-all").on("click",function(){e(true)});function e(e){var a=$(".categories .toggle");a.find("i").toggleClass("fa-minus",e).toggleClass("fa-plus",!e);a.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!e)}};i.throwCreateModal=function(){socket.emit("categories.getSelectCategories",{},function(e,a){if(e){return app.alertError(e.message)}a.unshift({cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"});t.parse("admin/partials/categories/create",{categories:a},function(e){var a=bootbox.dialog({title:"[[admin/manage/categories:alert.create]]",message:e,buttons:{save:{label:"[[global:save]]",className:"btn-primary",callback:o}}});var t=n.init(a.find('#parentCidGroup [component="category-selector"]'));var r=n.init(a.find('#cloneFromCidGroup [component="category-selector"]'));function o(){var e=a.find("form").serializeObject();e.description="";e.icon="fa-comments";e.uid=app.user.uid;e.parentCid=t.getSelectedCid();e.cloneFromCid=r.getSelectedCid();i.create(e);a.modal("hide");return false}$("#cloneChildren").on("change",function(){var e=$(this);var n=a.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');if(e.prop("checked")){n.attr("disabled","disabled");t.selectCategory(0)}else{n.removeAttr("disabled")}});a.find("form").on("submit",o)})})};i.create=function(e){socket.emit("admin.categories.create",e,function(e,a){if(e){return app.alertError(e.message)}app.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3});ajaxify.go("admin/manage/categories/"+a.cid)})};i.render=function(e){var t=$(".categories");if(!e||!e.length){a.translate("[[admin/manage/categories:alert.none-active]]",function(e){$("<div></div>").addClass("alert alert-info text-center").text(e).appendTo(t)})}else{o={};d(e,t,0)}};i.toggle=function(e,a){var t={};e.forEach(function(e){t[e]={disabled:a?1:0}});socket.emit("admin.categories.update",t,function(e){if(e){return app.alertError(e.message)}})};function c(e){r=e.to.dataset.cid}function s(e){var a=parseInt(r,10)!==-1;if(e.newIndex!=null&&parseInt(e.oldIndex,10)!==parseInt(e.newIndex,10)||a){var t=a?o[r]:o[e.from.dataset.cid];var n={};var i=0;var c=t.toArray();var s=c.length;for(i;i<s;i+=1){n[c[i]]={order:i+1}}if(a){n[e.item.dataset.cid].parentCid=r}r=-1;socket.emit("admin.categories.update",n)}}function d(e,n,i){var r=0;e.forEach(function(e,t,n){a.translate(e.name,function(a){if(e.name!==a){e.name=a}r+=1;if(r===n.length){l()}})});if(!e.length){l()}function l(){t.parse("admin/partials/categories/category-rows",{cid:i,categories:e},function(t){a.translate(t,function(a){n.append(a);for(var t=0,r=e.length;t<r;t+=1){d(e[t].children,$('li[data-cid="'+e[t].cid+'"]'),e[t].cid)}o[i]=Sortable.create($('ul[data-cid="'+i+'"]')[0],{group:"cross-categories",animation:150,handle:".icon",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:c,onEnd:s})})})}}return i});
//# sourceMappingURL=categories.js.map