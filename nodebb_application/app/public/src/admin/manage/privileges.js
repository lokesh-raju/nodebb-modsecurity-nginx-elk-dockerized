"use strict";define("admin/manage/privileges",["autocomplete","translator","benchpress","categorySelector"],function(e,a,i,r){var t={};var o;t.init=function(){o=isNaN(parseInt(ajaxify.data.selectedCategory.cid,10))?"admin":ajaxify.data.selectedCategory.cid;r.init($('[component="category-selector"]'),function(e){o=parseInt(e.cid,10);o=isNaN(o)?"admin":o;t.refreshPrivilegeTable();ajaxify.updateHistory("admin/manage/privileges/"+(o||""))});t.setupPrivilegeTable()};t.setupPrivilegeTable=function(){$(".privilege-table-container").on("change",'input[type="checkbox"]',function(){var e=$(this);var a=e.parent().attr("data-privilege");var i=e.prop("checked");var r=e.parents("tr");var o=r.attr("data-group-name")||r.attr("data-uid");var n=parseInt(r.attr("data-private")||0,10);var s=r.attr("data-group-name")!==undefined;if(o){if(s&&a==="groups:moderate"&&!n&&i){bootbox.confirm("[[admin/manage/categories:alert.confirm-moderate]]",function(r){if(r){t.setPrivilege(o,a,i,e)}else{e.prop("checked",!e.prop("checked"))}})}else{t.setPrivilege(o,a,i,e)}}else{app.alertError("[[error:invalid-data]]")}});$(".privilege-table-container").on("click",'[data-action="search.user"]',t.addUserToPrivilegeTable);$(".privilege-table-container").on("click",'[data-action="search.group"]',t.addGroupToPrivilegeTable);$(".privilege-table-container").on("click",'[data-action="copyToChildren"]',function(){t.copyPrivilegesToChildren(o,"")});$(".privilege-table-container").on("click",'[data-action="copyToChildrenGroup"]',function(){var e=$(this).parents("[data-group-name]").attr("data-group-name");t.copyPrivilegesToChildren(o,e)});$(".privilege-table-container").on("click",'[data-action="copyPrivilegesFrom"]',function(){t.copyPrivilegesFromCategory(o,"")});$(".privilege-table-container").on("click",'[data-action="copyPrivilegesFromGroup"]',function(){var e=$(this).parents("[data-group-name]").attr("data-group-name");t.copyPrivilegesFromCategory(o,e)});$(".privilege-table-container").on("click",'[data-action="copyToAll"]',function(){t.copyPrivilegesToAllCategories(o,"")});$(".privilege-table-container").on("click",'[data-action="copyToAllGroup"]',function(){var e=$(this).parents("[data-group-name]").attr("data-group-name");t.copyPrivilegesToAllCategories(o,e)});t.exposeAssumedPrivileges()};t.refreshPrivilegeTable=function(){socket.emit("admin.categories.getPrivilegeSettings",o,function(e,r){if(e){return app.alertError(e.message)}var n=parseInt(o,10)?"admin/partials/privileges/category":"admin/partials/privileges/global";i.parse(n,{privileges:r},function(e){a.translate(e,function(e){$(".privilege-table-container").html(e);t.exposeAssumedPrivileges()})})})};t.exposeAssumedPrivileges=function(){var e=[];$('.privilege-table tr[data-group-name="registered-users"] td input[type="checkbox"]').parent().each(function(a,i){if($(i).find("input").prop("checked")){e.push(i.getAttribute("data-privilege"))}});for(var a=0,i=e.length;a<i;a+=1){var r=$('.privilege-table tr[data-group-name]:not([data-group-name="registered-users"],[data-group-name="guests"],[data-group-name="spiders"]) td[data-privilege="'+e[a]+'"] input');r.each(function(e,a){if(!a.checked){a.indeterminate=true}})}};t.setPrivilege=function(e,a,i,r){socket.emit("admin.categories.setPrivilege",{cid:isNaN(o)?0:o,privilege:a,set:i,member:e},function(e){if(e){return app.alertError(e.message)}r.replaceWith('<i class="fa fa-spin fa-spinner"></i>');t.refreshPrivilegeTable()})};t.addUserToPrivilegeTable=function(){var a=bootbox.dialog({title:"[[admin/manage/categories:alert.find-user]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.user-search]]" />',show:true});a.on("shown.bs.modal",function(){var i=a.find("input");i.focus();e.user(i,function(e,i){var r;if(ajaxify.data.url==="/admin/manage/privileges/admin"){r=["admin:dashboard"]}else{r=o?["find","read","topics:read"]:["chat"]}socket.emit("admin.categories.setPrivilege",{cid:isNaN(o)?0:o,privilege:r,set:true,member:i.item.user.uid},function(e){if(e){return app.alertError(e.message)}t.refreshPrivilegeTable();a.modal("hide")})})})};t.addGroupToPrivilegeTable=function(){var a=bootbox.dialog({title:"[[admin/manage/categories:alert.find-group]]",message:'<input class="form-control input-lg" placeholder="[[admin/manage/categories:alert.group-search]]" />',show:true});a.on("shown.bs.modal",function(){var i=a.find("input");i.focus();e.group(i,function(e,i){var r;if(ajaxify.data.url==="/admin/manage/privileges/admin"){r=["groups:admin:dashboard"]}else{r=o?["groups:find","groups:read","groups:topics:read"]:["groups:chat"]}socket.emit("admin.categories.setPrivilege",{cid:isNaN(o)?0:o,privilege:r,set:true,member:i.item.group.name},function(e){if(e){return app.alertError(e.message)}t.refreshPrivilegeTable();a.modal("hide")})})})};t.copyPrivilegesToChildren=function(e,a){socket.emit("admin.categories.copyPrivilegesToChildren",{cid:e,group:a},function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[admin/manage/categories:privileges.copy-success]]")})};t.copyPrivilegesFromCategory=function(e,a){r.modal(ajaxify.data.categories.slice(1),function(i){socket.emit("admin.categories.copyPrivilegesFrom",{toCid:e,fromCid:i,group:a},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})})};t.copyPrivilegesToAllCategories=function(e,a){socket.emit("admin.categories.copyPrivilegesToAllCategories",{cid:e,group:a},function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[admin/manage/categories:privileges.copy-success]]")})};return t});
//# sourceMappingURL=privileges.js.map