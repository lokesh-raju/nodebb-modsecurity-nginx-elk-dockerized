{"version":3,"sources":["public/src/admin/manage/tags.js"],"names":["define","infinitescroll","selectable","colorpicker","Tags","timeoutId","init","enable","handleCreate","handleSearch","handleModify","handleRename","handleDeleteSelected","createModal","$","createTagName","createModalGo","on","e","keyCode","click","modal","setTimeout","focus","socket","emit","tag","val","err","app","alertError","message","ajaxify","refresh","clearTimeout","query","result","parseAndTranslate","tags","html","utils","makeNumbersHumanReadable","find","tagsToModify","length","firstTag","bootbox","dialog","title","buttons","success","label","className","callback","bgColor","color","data","each","idx","push","value","attr","css","alertSuccess","handleColorPickers","newName","tagsToDelete","confirm","index","el","remove","enableColorPicker","inputEl","$inputEl"],"mappings":"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","file":"public/src/admin/manage/tags.js","sourcesContent":["'use strict';\n\n\ndefine('admin/manage/tags', [\n\t'forum/infinitescroll',\n\t'admin/modules/selectable',\n\t'admin/modules/colorpicker',\n], function (infinitescroll, selectable, colorpicker) {\n\tvar\tTags = {};\n\tvar timeoutId = 0;\n\n\tTags.init = function () {\n\t\tselectable.enable('.tag-management', '.tag-row');\n\n\t\thandleCreate();\n\t\thandleSearch();\n\t\thandleModify();\n\t\thandleRename();\n\t\thandleDeleteSelected();\n\t};\n\n\tfunction handleCreate() {\n\t\tvar createModal = $('#create-modal');\n\t\tvar createTagName = $('#create-tag-name');\n\t\tvar createModalGo = $('#create-modal-go');\n\n\t\tcreateModal.on('keypress', function (e) {\n\t\t\tif (e.keyCode === 13) {\n\t\t\t\tcreateModalGo.click();\n\t\t\t}\n\t\t});\n\n\t\t$('#create').on('click', function () {\n\t\t\tcreateModal.modal('show');\n\t\t\tsetTimeout(function () {\n\t\t\t\tcreateTagName.focus();\n\t\t\t}, 250);\n\t\t});\n\n\t\tcreateModalGo.on('click', function () {\n\t\t\tsocket.emit('admin.tags.create', {\n\t\t\t\ttag: createTagName.val(),\n\t\t\t}, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\tcreateTagName.val('');\n\t\t\t\tcreateModal.on('hidden.bs.modal', function () {\n\t\t\t\t\tajaxify.refresh();\n\t\t\t\t});\n\t\t\t\tcreateModal.modal('hide');\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction handleSearch() {\n\t\t$('#tag-search').on('input propertychange', function () {\n\t\t\tif (timeoutId) {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\ttimeoutId = 0;\n\t\t\t}\n\n\t\t\ttimeoutId = setTimeout(function () {\n\t\t\t\tsocket.emit('topics.searchAndLoadTags', {\n\t\t\t\t\tquery: $('#tag-search').val(),\n\t\t\t\t}, function (err, result) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tapp.parseAndTranslate('admin/manage/tags', 'tags', {\n\t\t\t\t\t\ttags: result.tags,\n\t\t\t\t\t}, function (html) {\n\t\t\t\t\t\t$('.tag-list').html(html);\n\t\t\t\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\n\t\t\t\t\t\ttimeoutId = 0;\n\n\t\t\t\t\t\tselectable.enable('.tag-management', '.tag-row');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}, 250);\n\t\t});\n\t}\n\n\tfunction handleModify() {\n\t\t$('#modify').on('click', function () {\n\t\t\tvar tagsToModify = $('.tag-row.ui-selected');\n\t\t\tif (!tagsToModify.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar firstTag = $(tagsToModify[0]);\n\t\t\tvar modal = bootbox.dialog({\n\t\t\t\ttitle: '[[admin/manage/tags:alerts.editing]]',\n\t\t\t\tmessage: firstTag.find('.tag-modal').html(),\n\t\t\t\tbuttons: {\n\t\t\t\t\tsuccess: {\n\t\t\t\t\t\tlabel: 'Save',\n\t\t\t\t\t\tclassName: 'btn-primary save',\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\tvar modal = $('.bootbox');\n\t\t\t\t\t\t\tvar bgColor = modal.find('[data-name=\"bgColor\"]').val();\n\t\t\t\t\t\t\tvar color = modal.find('[data-name=\"color\"]').val();\n\t\t\t\t\t\t\tvar data = [];\n\t\t\t\t\t\t\ttagsToModify.each(function (idx, tag) {\n\t\t\t\t\t\t\t\ttag = $(tag);\n\t\t\t\t\t\t\t\tdata.push({\n\t\t\t\t\t\t\t\t\tvalue: tag.attr('data-tag'),\n\t\t\t\t\t\t\t\t\tcolor: modal.find('[data-name=\"color\"]').val(),\n\t\t\t\t\t\t\t\t\tbgColor: modal.find('[data-name=\"bgColor\"]').val(),\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\ttag.find('[data-name=\"bgColor\"]').val(bgColor);\n\t\t\t\t\t\t\t\ttag.find('[data-name=\"color\"]').val(color);\n\t\t\t\t\t\t\t\ttag.find('.tag-item').css('background-color', bgColor).css('color', color);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tsocket.emit('admin.tags.update', data, function (err) {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/tags:alerts.update-success]]');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\thandleColorPickers(modal);\n\t\t});\n\t}\n\n\tfunction handleRename() {\n\t\t$('#rename').on('click', function () {\n\t\t\tvar tagsToModify = $('.tag-row.ui-selected');\n\t\t\tif (!tagsToModify.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar modal = bootbox.dialog({\n\t\t\t\ttitle: '[[admin/manage/tags:alerts.editing]]',\n\t\t\t\tmessage: $('.rename-modal').html(),\n\t\t\t\tbuttons: {\n\t\t\t\t\tsuccess: {\n\t\t\t\t\t\tlabel: 'Save',\n\t\t\t\t\t\tclassName: 'btn-primary save',\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\tvar data = [];\n\t\t\t\t\t\t\ttagsToModify.each(function (idx, tag) {\n\t\t\t\t\t\t\t\ttag = $(tag);\n\t\t\t\t\t\t\t\tdata.push({\n\t\t\t\t\t\t\t\t\tvalue: tag.attr('data-tag'),\n\t\t\t\t\t\t\t\t\tnewName: modal.find('[data-name=\"value\"]').val(),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tsocket.emit('admin.tags.rename', data, function (err) {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/tags:alerts.update-success]]');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction handleDeleteSelected() {\n\t\t$('#deleteSelected').on('click', function () {\n\t\t\tvar tagsToDelete = $('.tag-row.ui-selected');\n\t\t\tif (!tagsToDelete.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/tags:alerts.confirm-delete]]', function (confirm) {\n\t\t\t\tif (!confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar tags = [];\n\t\t\t\ttagsToDelete.each(function (index, el) {\n\t\t\t\t\ttags.push($(el).attr('data-tag'));\n\t\t\t\t});\n\t\t\t\tsocket.emit('admin.tags.deleteTags', {\n\t\t\t\t\ttags: tags,\n\t\t\t\t}, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\ttagsToDelete.remove();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction handleColorPickers(modal) {\n\t\tfunction enableColorPicker(idx, inputEl) {\n\t\t\tvar $inputEl = $(inputEl);\n\t\t\tcolorpicker.enable($inputEl);\n\t\t}\n\n\t\tmodal.find('[data-name=\"bgColor\"], [data-name=\"color\"]').each(enableColorPicker);\n\t}\n\n\treturn Tags;\n});\n"]}