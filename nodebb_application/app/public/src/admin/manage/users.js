"use strict";define("admin/manage/users",["translator","benchpress","autocomplete"],function(e,a,r){var n={};n.init=function(){var n=$(".nav-pills li");var t=window.location.pathname;if(!n.find('a[href^="'+t+'"]').length||t===config.relative_path+"/admin/manage/users"){t=config.relative_path+"/admin/manage/users/latest"}n.removeClass("active").find('a[href^="'+t+'"]').parent().addClass("active");$("#results-per-page").val(ajaxify.data.resultsPerPage).on("change",function(){var e=utils.params();e.resultsPerPage=$("#results-per-page").val();ajaxify.go(window.location.pathname+"?"+$.param(e))});function o(){var e=[];$('.users-table [component="user/select/single"]').each(function(){if($(this).is(":checked")){e.push($(this).attr("data-uid"))}});return e}function u(e,a){$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(e).each(function(){$(this).toggleClass("hidden",!a)})}function c(){$('.users-table [component="user/select/single"]').prop("checked",false);$('.users-table [component="user/select/all"]').prop("checked",false)}function l(){$('.users-table [component="user/select/single"]:checked').parents(".user-row").remove()}function m(e,a,r){return function(n){if(n){return app.alertError(n.message)}app.alertSuccess(e);if(a){u(a,r)}c()}}$('[component="user/select/all"]').on("click",function(){$('.users-table [component="user/select/single"]').prop("checked",$(this).is(":checked"))});$(".manage-groups").on("click",function(){var n=o();if(!n.length){app.alertError("[[error:no-users-selected]]");return false}socket.emit("admin.user.loadGroups",n,function(n,s){if(n){return app.alertError(n)}a.parse("admin/partials/manage_user_groups",s,function(a){var n=bootbox.dialog({message:a,title:"[[admin/manage/users:manage-groups]]",onEscape:true});n.on("shown.bs.modal",function(){r.group(n.find(".group-search"),function(a,r){var n=$(a.target).attr("data-uid");socket.emit("admin.groups.join",{uid:n,groupName:r.item.value},function(a){if(a){return app.alertError(a)}r.item.group.nameEscaped=e.escape(r.item.group.displayName);app.parseAndTranslate("admin/partials/manage_user_groups",{users:[{groups:[r.item.group]}]},function(e){$("[data-uid="+n+"] .group-area").append(e.find(".group-area").html())})})})});n.on("click",".group-area a",function(){n.modal("hide")});n.on("click",".remove-group-icon",function(){var e=$(this).parents("[data-group-name]");var a=e.attr("data-group-name");var r=$(this).parents("[data-uid]").attr("data-uid");socket.emit("admin.groups.leave",{uid:r,groupName:a},function(a){if(a){return app.alertError(a)}e.remove()});return false})})})});$(".ban-user").on("click",function(){var e=o();if(!e.length){app.alertError("[[error:no-users-selected]]");return false}bootbox.confirm(e.length>1?"[[admin/manage/users:alerts.confirm-ban-multi]]":"[[admin/manage/users:alerts.confirm-ban]]",function(a){if(a){socket.emit("user.banUsers",{uids:e,reason:""},m("[[admin/manage/users:alerts.ban-success]]",".ban",true))}})});$(".ban-user-temporary").on("click",function(){var e=o();if(!e.length){app.alertError("[[error:no-users-selected]]");return false}a.parse("admin/partials/temporary-ban",{},function(a){bootbox.dialog({className:"ban-modal",title:"[[user:ban_account]]",message:a,show:true,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[admin/manage/users:alerts.button-ban-x, "+e.length+"]]",callback:function(){var a=$(".ban-modal form").serializeArray().reduce(function(e,a){e[a.name]=a.value;return e},{});var r=a.length>0?Date.now()+a.length*1e3*60*60*(parseInt(a.unit,10)?24:1):0;socket.emit("user.banUsers",{uids:e,until:r,reason:a.reason},m("[[admin/manage/users:alerts.ban-success]]",".ban",true))}}}})})});$(".unban-user").on("click",function(){var e=o();if(!e.length){app.alertError("[[error:no-users-selected]]");return false}socket.emit("user.unbanUsers",e,m("[[admin/manage/users:alerts.unban-success]]",".ban",false))});$(".reset-lockout").on("click",function(){var e=o();if(!e.length){return}socket.emit("admin.user.resetLockouts",e,m("[[admin/manage/users:alerts.lockout-reset-success]]"))});$(".validate-email").on("click",function(){var e=o();if(!e.length){return}bootbox.confirm("[[admin/manage/users:alerts.confirm-validate-email]]",function(a){if(!a){return}socket.emit("admin.user.validateEmail",e,function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[admin/manage/users:alerts.validate-email-success]]");u(".notvalidated",false);u(".validated",true);c()})})});$(".send-validation-email").on("click",function(){var e=o();if(!e.length){return}socket.emit("admin.user.sendValidationEmail",e,function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[notifications:email-confirm-sent]]")})});$(".password-reset-email").on("click",function(){var e=o();if(!e.length){return}bootbox.confirm("[[admin/manage/users:alerts.password-reset-confirm]]",function(a){if(a){socket.emit("admin.user.sendPasswordResetEmail",e,m("[[notifications:email-confirm-sent]]"))}})});$(".force-password-reset").on("click",function(){var e=o();if(!e.length){return}bootbox.confirm("[[admin/manage/users:alerts.confirm-force-password-reset]]",function(a){if(a){socket.emit("admin.user.forcePasswordReset",e,m("[[admin/manage/users:alerts.validate-force-password-reset-success]]"))}})});$(".delete-user").on("click",function(){var e=o();if(!e.length){return}bootbox.confirm("[[admin/manage/users:alerts.confirm-delete]]",function(a){if(a){socket.emit("admin.user.deleteUsers",e,function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[admin/manage/users:alerts.delete-success]]");l();c();if(!$('.users-table [component="user/select/single"]').length){ajaxify.refresh()}})}})});$(".delete-user-content").on("click",function(){var e=o();if(!e.length){return}bootbox.confirm("[[admin/manage/users:alerts.confirm-delete-content]]",function(a){if(a){socket.emit("admin.user.deleteUsersContent",e,function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[admin/manage/users:alerts.delete-content-success]]")})}})});$(".delete-user-and-content").on("click",function(){var e=o();if(!e.length){return}bootbox.confirm("[[admin/manage/users:alerts.confirm-purge]]",function(a){if(a){socket.emit("admin.user.deleteUsersAndContent",e,function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[admin/manage/users:alerts.delete-success]]");l();c();if(!$('.users-table [component="user/select/single"]').length){ajaxify.refresh()}})}})});function d(){$("#createUser").on("click",function(){a.parse("admin/partials/create_user_modal",{},function(e){bootbox.dialog({message:e,title:"[[admin/manage/users:alerts.create]]",onEscape:true,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},create:{label:"[[admin/manage/users:alerts.button-create]]",className:"btn-primary",callback:function(){f.call(this);return false}}}})});return false})}function f(){var e=this;var a=document.getElementById("create-user-name").value;var r=document.getElementById("create-user-email").value;var n=document.getElementById("create-user-password").value;var s=document.getElementById("create-user-password-again").value;var t=$("#create-modal-error");if(n!==s){return t.translateHtml("[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]").removeClass("hide")}var i={username:a,email:r,password:n};socket.emit("admin.user.createUser",i,function(a){if(a){return t.translateHtml("[[admin/manage/users:alerts.error-x, "+a.message+"]]").removeClass("hide")}e.modal("hide");e.on("hidden.bs.modal",function(){ajaxify.refresh()});app.alertSuccess("[[admin/manage/users:alerts.create-success]]")})}var p=0;$("#search-user-uid, #search-user-name, #search-user-email, #search-user-ip").on("keyup",function(){if(p!==0){clearTimeout(p);p=0}var e=$(this);var a=e.attr("data-search-type");p=setTimeout(function(){$(".fa-spinner").removeClass("hidden");s({searchBy:a,query:e.val(),page:1})},250)});d();i()};function s(e){var a=decodeURIComponent($.param(e));$.get(config.relative_path+"/api/admin/manage/users/search?"+a,t).fail(function(e){if(e&&e.responseJSON&&e.responseJSON.error){app.alertError(e.responseJSON.error)}})}function t(r){a.parse("partials/paginator",{pagination:r.pagination},function(e){$(".pagination-container").replaceWith(e)});app.parseAndTranslate("admin/manage/users","users",r,function(a){$(".users-table tbody tr").remove();$(".users-table tbody").append(a);a.find(".timeago").timeago();$(".fa-spinner").addClass("hidden");if(r&&r.users.length===0){$("#user-notfound-notify").translateHtml("[[admin/manage/users:search.not-found]]").removeClass("hidden");$("#user-found-notify").addClass("hidden")}else{$("#user-found-notify").translateHtml(e.compile("admin/manage/users:alerts.x-users-found",r.matchCount,r.timing)).removeClass("hidden");$("#user-notfound-notify").addClass("hidden")}})}function i(){$('[component="user/invite"]').on("click",function(){bootbox.prompt("[[admin/manage/users:alerts.prompt-email]]",function(e){if(!e){return}socket.emit("user.invite",e,function(a){if(a){return app.alertError(a.message)}app.alertSuccess("[[admin/manage/users:alerts.email-sent-to, "+e+"]]")})});return false})}return n});
//# sourceMappingURL=users.js.map