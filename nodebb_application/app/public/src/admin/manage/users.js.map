{"version":3,"sources":["public/src/admin/manage/users.js"],"names":["define","translator","Benchpress","autocomplete","Users","init","navPills","$","pathname","window","location","find","length","config","relative_path","removeClass","parent","addClass","val","ajaxify","data","resultsPerPage","on","query","utils","params","go","param","getSelectedUids","uids","each","this","is","push","attr","update","className","state","parents","toggleClass","unselectAll","prop","removeSelected","remove","done","successMessage","flag","err","app","alertError","message","alertSuccess","socket","emit","parse","html","modal","bootbox","dialog","title","onEscape","group","ev","ui","uid","target","groupName","item","value","nameEscaped","escape","displayName","parseAndTranslate","users","groups","append","groupCard","confirm","reason","show","buttons","close","label","submit","callback","formData","serializeArray","reduce","cur","name","until","Date","now","parseInt","unit","refresh","handleUserCreate","cancel","create","createUser","call","username","document","getElementById","email","password","passwordAgain","errorEl","translateHtml","user","timeoutId","clearTimeout","$this","type","setTimeout","loadSearchPage","searchBy","page","handleInvite","qs","decodeURIComponent","get","renderSearchResults","fail","xhrErr","responseJSON","error","pagination","replaceWith","timeago","compile","matchCount","timing","prompt"],"mappings":"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","file":"public/src/admin/manage/users.js","sourcesContent":["'use strict';\n\ndefine('admin/manage/users', ['translator', 'benchpress', 'autocomplete'], function (translator, Benchpress, autocomplete) {\n\tvar Users = {};\n\n\tUsers.init = function () {\n\t\tvar navPills = $('.nav-pills li');\n\t\tvar pathname = window.location.pathname;\n\t\tif (!navPills.find('a[href^=\"' + pathname + '\"]').length || pathname === config.relative_path + '/admin/manage/users') {\n\t\t\tpathname = config.relative_path + '/admin/manage/users/latest';\n\t\t}\n\t\tnavPills.removeClass('active').find('a[href^=\"' + pathname + '\"]').parent().addClass('active');\n\n\t\t$('#results-per-page').val(ajaxify.data.resultsPerPage).on('change', function () {\n\t\t\tvar query = utils.params();\n\t\t\tquery.resultsPerPage = $('#results-per-page').val();\n\t\t\tajaxify.go(window.location.pathname + '?' + $.param(query));\n\t\t});\n\n\t\tfunction getSelectedUids() {\n\t\t\tvar uids = [];\n\n\t\t\t$('.users-table [component=\"user/select/single\"]').each(function () {\n\t\t\t\tif ($(this).is(':checked')) {\n\t\t\t\t\tuids.push($(this).attr('data-uid'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn uids;\n\t\t}\n\n\t\tfunction update(className, state) {\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').find(className).each(function () {\n\t\t\t\t$(this).toggleClass('hidden', !state);\n\t\t\t});\n\t\t}\n\n\t\tfunction unselectAll() {\n\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', false);\n\t\t\t$('.users-table [component=\"user/select/all\"]').prop('checked', false);\n\t\t}\n\n\t\tfunction removeSelected() {\n\t\t\t$('.users-table [component=\"user/select/single\"]:checked').parents('.user-row').remove();\n\t\t}\n\n\t\tfunction done(successMessage, className, flag) {\n\t\t\treturn function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess(successMessage);\n\t\t\t\tif (className) {\n\t\t\t\t\tupdate(className, flag);\n\t\t\t\t}\n\t\t\t\tunselectAll();\n\t\t\t};\n\t\t}\n\n\t\t$('[component=\"user/select/all\"]').on('click', function () {\n\t\t\t$('.users-table [component=\"user/select/single\"]').prop('checked', $(this).is(':checked'));\n\t\t});\n\n\t\t$('.manage-groups').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tsocket.emit('admin.user.loadGroups', uids, function (err, data) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t}\n\t\t\t\tBenchpress.parse('admin/partials/manage_user_groups', data, function (html) {\n\t\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\ttitle: '[[admin/manage/users:manage-groups]]',\n\t\t\t\t\t\tonEscape: true,\n\t\t\t\t\t});\n\t\t\t\t\tmodal.on('shown.bs.modal', function () {\n\t\t\t\t\t\tautocomplete.group(modal.find('.group-search'), function (ev, ui) {\n\t\t\t\t\t\t\tvar uid = $(ev.target).attr('data-uid');\n\t\t\t\t\t\t\tsocket.emit('admin.groups.join', { uid: uid, groupName: ui.item.value }, function (err) {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tui.item.group.nameEscaped = translator.escape(ui.item.group.displayName);\n\t\t\t\t\t\t\t\tapp.parseAndTranslate('admin/partials/manage_user_groups', { users: [{ groups: [ui.item.group] }] }, function (html) {\n\t\t\t\t\t\t\t\t\t$('[data-uid=' + uid + '] .group-area').append(html.find('.group-area').html());\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tmodal.on('click', '.group-area a', function () {\n\t\t\t\t\t\tmodal.modal('hide');\n\t\t\t\t\t});\n\t\t\t\t\tmodal.on('click', '.remove-group-icon', function () {\n\t\t\t\t\t\tvar groupCard = $(this).parents('[data-group-name]');\n\t\t\t\t\t\tvar groupName = groupCard.attr('data-group-name');\n\t\t\t\t\t\tvar uid = $(this).parents('[data-uid]').attr('data-uid');\n\t\t\t\t\t\tsocket.emit('admin.groups.leave', { uid: uid, groupName: groupName }, function (err) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tgroupCard.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.ban-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\t// specifically to keep the menu open\n\t\t\t}\n\n\t\t\tbootbox.confirm((uids.length > 1 ? '[[admin/manage/users:alerts.confirm-ban-multi]]' : '[[admin/manage/users:alerts.confirm-ban]]'), function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('user.banUsers', { uids: uids, reason: '' }, done('[[admin/manage/users:alerts.ban-success]]', '.ban', true));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.ban-user-temporary').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\t// specifically to keep the menu open\n\t\t\t}\n\n\t\t\tBenchpress.parse('admin/partials/temporary-ban', {}, function (html) {\n\t\t\t\tbootbox.dialog({\n\t\t\t\t\tclassName: 'ban-modal',\n\t\t\t\t\ttitle: '[[user:ban_account]]',\n\t\t\t\t\tmessage: html,\n\t\t\t\t\tshow: true,\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\tclose: {\n\t\t\t\t\t\t\tlabel: '[[global:close]]',\n\t\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsubmit: {\n\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-ban-x, ' + uids.length + ']]',\n\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\tvar formData = $('.ban-modal form').serializeArray().reduce(function (data, cur) {\n\t\t\t\t\t\t\t\t\tdata[cur.name] = cur.value;\n\t\t\t\t\t\t\t\t\treturn data;\n\t\t\t\t\t\t\t\t}, {});\n\t\t\t\t\t\t\t\tvar until = formData.length > 0 ? (Date.now() + (formData.length * 1000 * 60 * 60 * (parseInt(formData.unit, 10) ? 24 : 1))) : 0;\n\t\t\t\t\t\t\t\tsocket.emit('user.banUsers', { uids: uids, until: until, reason: formData.reason }, done('[[admin/manage/users:alerts.ban-success]]', '.ban', true));\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.unban-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\tapp.alertError('[[error:no-users-selected]]');\n\t\t\t\treturn false;\t// specifically to keep the menu open\n\t\t\t}\n\n\t\t\tsocket.emit('user.unbanUsers', uids, done('[[admin/manage/users:alerts.unban-success]]', '.ban', false));\n\t\t});\n\n\t\t$('.reset-lockout').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsocket.emit('admin.user.resetLockouts', uids, done('[[admin/manage/users:alerts.lockout-reset-success]]'));\n\t\t});\n\n\t\t$('.validate-email').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-validate-email]]', function (confirm) {\n\t\t\t\tif (!confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsocket.emit('admin.user.validateEmail', uids, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.validate-email-success]]');\n\t\t\t\t\tupdate('.notvalidated', false);\n\t\t\t\t\tupdate('.validated', true);\n\t\t\t\t\tunselectAll();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t$('.send-validation-email').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsocket.emit('admin.user.sendValidationEmail', uids, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess('[[notifications:email-confirm-sent]]');\n\t\t\t});\n\t\t});\n\n\t\t$('.password-reset-email').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.password-reset-confirm]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.sendPasswordResetEmail', uids, done('[[notifications:email-confirm-sent]]'));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.force-password-reset').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-force-password-reset]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.forcePasswordReset', uids, done('[[admin/manage/users:alerts.validate-force-password-reset-success]]'));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.delete-user').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-delete]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.deleteUsers', uids, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\n\t\t\t\t\t\tremoveSelected();\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t\tif (!$('.users-table [component=\"user/select/single\"]').length) {\n\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.delete-user-content').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-delete-content]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.deleteUsersContent', uids, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-content-success]]');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$('.delete-user-and-content').on('click', function () {\n\t\t\tvar uids = getSelectedUids();\n\t\t\tif (!uids.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-purge]]', function (confirm) {\n\t\t\t\tif (confirm) {\n\t\t\t\t\tsocket.emit('admin.user.deleteUsersAndContent', uids, function (err) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.delete-success]]');\n\t\t\t\t\t\tremoveSelected();\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t\tif (!$('.users-table [component=\"user/select/single\"]').length) {\n\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tfunction handleUserCreate() {\n\t\t\t$('#createUser').on('click', function () {\n\t\t\t\tBenchpress.parse('admin/partials/create_user_modal', {}, function (html) {\n\t\t\t\t\tbootbox.dialog({\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\ttitle: '[[admin/manage/users:alerts.create]]',\n\t\t\t\t\t\tonEscape: true,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tcancel: {\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-cancel]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcreate: {\n\t\t\t\t\t\t\t\tlabel: '[[admin/manage/users:alerts.button-create]]',\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\n\t\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\t\tcreateUser.call(this);\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\tfunction createUser() {\n\t\t\tvar modal = this;\n\t\t\tvar username = document.getElementById('create-user-name').value;\n\t\t\tvar email = document.getElementById('create-user-email').value;\n\t\t\tvar password = document.getElementById('create-user-password').value;\n\t\t\tvar passwordAgain = document.getElementById('create-user-password-again').value;\n\n\t\t\tvar errorEl = $('#create-modal-error');\n\n\t\t\tif (password !== passwordAgain) {\n\t\t\t\treturn errorEl.translateHtml('[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]').removeClass('hide');\n\t\t\t}\n\n\t\t\tvar user = {\n\t\t\t\tusername: username,\n\t\t\t\temail: email,\n\t\t\t\tpassword: password,\n\t\t\t};\n\n\t\t\tsocket.emit('admin.user.createUser', user, function (err) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn errorEl.translateHtml('[[admin/manage/users:alerts.error-x, ' + err.message + ']]').removeClass('hide');\n\t\t\t\t}\n\n\t\t\t\tmodal.modal('hide');\n\t\t\t\tmodal.on('hidden.bs.modal', function () {\n\t\t\t\t\tajaxify.refresh();\n\t\t\t\t});\n\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.create-success]]');\n\t\t\t});\n\t\t}\n\n\t\tvar timeoutId = 0;\n\n\t\t$('#search-user-uid, #search-user-name, #search-user-email, #search-user-ip').on('keyup', function () {\n\t\t\tif (timeoutId !== 0) {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\ttimeoutId = 0;\n\t\t\t}\n\n\t\t\tvar $this = $(this);\n\t\t\tvar type = $this.attr('data-search-type');\n\n\t\t\ttimeoutId = setTimeout(function () {\n\t\t\t\t$('.fa-spinner').removeClass('hidden');\n\t\t\t\tloadSearchPage({\n\t\t\t\t\tsearchBy: type,\n\t\t\t\t\tquery: $this.val(),\n\t\t\t\t\tpage: 1,\n\t\t\t\t});\n\t\t\t}, 250);\n\t\t});\n\n\t\thandleUserCreate();\n\n\t\thandleInvite();\n\t};\n\n\tfunction loadSearchPage(query) {\n\t\tvar qs = decodeURIComponent($.param(query));\n\t\t$.get(config.relative_path + '/api/admin/manage/users/search?' + qs, renderSearchResults).fail(function (xhrErr) {\n\t\t\tif (xhrErr && xhrErr.responseJSON && xhrErr.responseJSON.error) {\n\t\t\t\tapp.alertError(xhrErr.responseJSON.error);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction renderSearchResults(data) {\n\t\tBenchpress.parse('partials/paginator', { pagination: data.pagination }, function (html) {\n\t\t\t$('.pagination-container').replaceWith(html);\n\t\t});\n\n\t\tapp.parseAndTranslate('admin/manage/users', 'users', data, function (html) {\n\t\t\t$('.users-table tbody tr').remove();\n\t\t\t$('.users-table tbody').append(html);\n\t\t\thtml.find('.timeago').timeago();\n\t\t\t$('.fa-spinner').addClass('hidden');\n\n\t\t\tif (data && data.users.length === 0) {\n\t\t\t\t$('#user-notfound-notify').translateHtml('[[admin/manage/users:search.not-found]]')\n\t\t\t\t\t.removeClass('hidden');\n\t\t\t\t$('#user-found-notify').addClass('hidden');\n\t\t\t} else {\n\t\t\t\t$('#user-found-notify').translateHtml(translator.compile('admin/manage/users:alerts.x-users-found', data.matchCount, data.timing))\n\t\t\t\t\t.removeClass('hidden');\n\t\t\t\t$('#user-notfound-notify').addClass('hidden');\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction handleInvite() {\n\t\t$('[component=\"user/invite\"]').on('click', function () {\n\t\t\tbootbox.prompt('[[admin/manage/users:alerts.prompt-email]]', function (email) {\n\t\t\t\tif (!email) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsocket.emit('user.invite', email, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.email-sent-to, ' + email + ']]');\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\t}\n\n\n\treturn Users;\n});\n"]}