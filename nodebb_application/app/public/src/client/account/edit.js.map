{"version":3,"sources":["public/src/client/account/edit.js"],"names":["define","header","translator","components","pictureCropper","Benchpress","AccountEdit","init","$","on","updateProfile","app","loadJQueryUI","datepicker","changeMonth","changeYear","yearRange","defaultDate","handleImageChange","handleAccountDelete","handleEmailConfirm","updateSignature","updateAboutMe","handleGroupSort","userData","uid","val","fullname","website","birthday","location","groupTitle","signature","aboutme","JSON","stringify","Array","isArray","window","trigger","socket","emit","err","data","alertError","message","alertSuccess","picture","attr","updateHeader","parseInt","ajaxify","theirid","yourid","defaultAvatar","pictures","uploaded","reduce","memo","cur","type","parse","icon","text","bgColor","allowProfileImageUploads","html","translate","modal","bootbox","dialog","className","title","show","buttons","close","label","callback","onCloseModal","update","saveSelection","updateImages","selectImageType","find","removeClass","this","addClass","handleImageUpload","parents","each","getAttribute","changeUserPicture","refresh","translated","confirm","confirmBtn","prop","password","restoreButton","confirmText","href","config","relative_path","focus","onUploadComplete","urlOnServer","startsWith","Date","now","length","uploadedpicture","onRemoveComplete","socketMethod","route","userslug","aspectRatio","paramName","paramValue","fileSize","maximumProfileImageSize","allowSkippingCrop","description","accept","allowedProfileImageExtensios","url","uploadModal","handleImageCrop","btn","removeAttr","getCharsLeft","el","max","maximumSignatureLength","maximumAboutMeLength","move","direction","selected","allowMultipleBadges","insertAfter","next","prev","insertBefore"],"mappings":"AAAA,aAGAA,OAAO,sBAAuB,uBAAwB,aAAc,aAAc,iBAAkB,cAAe,SAAUC,EAAQC,EAAYC,EAAYC,EAAgBC,GAC5K,IAAIC,KAEJA,EAAYC,KAAO,WAClBN,EAAOM,OAEPC,EAAE,cAAcC,GAAG,QAASC,GAE5BC,IAAIC,aAAa,WAChBJ,EAAE,kBAAkBK,YACnBC,YAAa,KACbC,WAAY,KACZC,UAAW,WACXC,YAAa,WAIfC,IACAC,IACAC,IACAC,IACAC,IACAC,KAGD,SAASb,IACR,IAAIc,GACHC,IAAKjB,EAAE,aAAakB,MACpBC,SAAUnB,EAAE,kBAAkBkB,MAC9BE,QAASpB,EAAE,iBAAiBkB,MAC5BG,SAAUrB,EAAE,kBAAkBkB,MAC9BI,SAAUtB,EAAE,kBAAkBkB,MAC9BK,WAAYvB,EAAE,eAAekB,MAC7BM,UAAWxB,EAAE,mBAAmBkB,MAChCO,QAASzB,EAAE,iBAAiBkB,OAG7BF,EAASO,WAAaG,KAAKC,UAAUC,MAAMC,QAAQb,EAASO,YAAcP,EAASO,YAAcP,EAASO,aAE1GvB,EAAE8B,QAAQC,QAAQ,wBAAyBf,GAE3CgB,OAAOC,KAAK,qBAAsBjB,EAAU,SAAUkB,EAAKC,GAC1D,GAAID,EAAK,CACR,OAAO/B,IAAIiC,WAAWF,EAAIG,SAG3BlC,IAAImC,aAAa,mCAEjB,GAAIH,EAAKI,QAAS,CACjBvC,EAAE,yBAAyBwC,KAAK,MAAOL,EAAKI,SAG7CE,EAAaN,EAAKI,WAGnB,OAAO,MAGR,SAASE,EAAaF,GACrB,GAAIG,SAASC,QAAQR,KAAKS,QAAS,MAAQF,SAASC,QAAQR,KAAKU,OAAQ,IAAK,CAC7E,OAED,IAAKN,GAAWI,QAAQR,KAAKW,cAAe,CAC3CP,EAAUI,QAAQR,KAAKW,cAExB9C,EAAE,wCAAwCuC,EAAU,OAAS,UAC7DvC,EAAE,sCAAsCuC,EAAU,OAAS,UAC3D,GAAIA,EAAS,CACZvC,EAAE,wCAAwCwC,KAAK,MAAOD,IAIxD,SAAS7B,IACRV,EAAE,qBAAqBC,GAAG,QAAS,WAClC+B,OAAOC,KAAK,2BACXhB,IAAK0B,QAAQR,KAAKlB,KAChB,SAAUiB,EAAKa,GACjB,GAAIb,EAAK,CACR,OAAO/B,IAAIiC,WAAWF,EAAIG,SAI3B,IAAIW,EAAWD,EAASE,OAAO,SAAUC,EAAMC,GAC9C,OAAOD,GAAQC,EAAIC,OAAS,YAC1B,OAEHvD,EAAWwD,MAAM,wCAChBN,SAAUA,EACVC,SAAUA,EACVM,MAAQC,KAAMZ,QAAQR,KAAK,aAAcqB,QAASb,QAAQR,KAAK,iBAC/DW,cAAeH,QAAQR,KAAKW,cAC5BW,yBAA0Bd,QAAQR,KAAKsB,0BACrC,SAAUC,GACZhE,EAAWiE,UAAUD,EAAM,SAAUA,GACpC,IAAIE,EAAQC,QAAQC,QACnBC,UAAW,mBACXC,MAAO,0BACP3B,QAASqB,EACTO,KAAM,KACNC,SACCC,OACCC,MAAO,mBACPC,SAAUC,EACVP,UAAW,YAEZQ,QACCH,MAAO,0BACPC,SAAUG,MAKbZ,EAAM3D,GAAG,iBAAkBwE,GAC3Bb,EAAM3D,GAAG,QAAS,mBAAoB,SAASyE,IAC9Cd,EAAMe,KAAK,oBAAoBC,YAAY,UAC3C5E,EAAE6E,MAAMC,SAAS,YAGlBC,EAAkBnB,GAElB,SAASa,IAER,IAAK9B,QAAQR,KAAKI,QAAS,CAC1BqB,EAAMe,KAAK,+BAA+BK,QAAQ,oBAAoBF,SAAS,cACzE,CACNlB,EAAMe,KAAK,wBAAwBM,KAAK,WACvC,GAAIJ,KAAKK,aAAa,SAAWvC,QAAQR,KAAKI,QAAS,CACtDvC,EAAE6E,MAAMG,QAAQ,oBAAoBF,SAAS,cAMjD,SAASN,IACR,IAAIpB,EAAOQ,EAAMe,KAAK,2BAA2BnC,KAAK,aAEtD2C,EAAkB/B,EAAM,SAAUlB,GACjC,GAAIA,EAAK,CACR,OAAO/B,IAAIiC,WAAWF,EAAIG,SAG3BI,EAAaW,IAAS,UAAY,GAAKQ,EAAMe,KAAK,+BAA+BnC,KAAK,QACtFG,QAAQyC,YAIV,SAASd,IACRV,EAAMA,MAAM,eAMhB,OAAO,QAIT,SAASjD,IACRX,EAAE,qBAAqBC,GAAG,QAAS,WAClCP,EAAWiE,UAAU,kCAAmC,SAAU0B,GACjE,IAAIzB,EAAQC,QAAQyB,QAAQD,EAAa,8EAA+E,SAAUC,GACjI,IAAKA,EAAS,CACb,OAGD,IAAIC,EAAa3B,EAAMe,KAAK,gBAC5BY,EAAW7B,KAAK,yCAChB6B,EAAWC,KAAK,WAAY,MAE5BxD,OAAOC,KAAK,sBACXwD,SAAUzF,EAAE,qBAAqBkB,OAC/B,SAAUgB,GACZ,SAASwD,IACRhG,EAAWiE,UAAU,8BAA+B,SAAUgC,GAC7DJ,EAAWhC,KAAKoC,GAChBJ,EAAWC,KAAK,WAAY,SAI9B,GAAItD,EAAK,CACRwD,IACA,OAAOvF,IAAIiC,WAAWF,EAAIG,SAG3BkD,EAAW7B,KAAK,+BAChB5B,OAAOR,SAASsE,KAAOC,OAAOC,cAAgB,MAG/C,OAAO,QAGRlC,EAAM3D,GAAG,iBAAkB,WAC1B2D,EAAMe,KAAK,SAASoB,YAGtB,OAAO,QAIT,SAAShB,EAAkBnB,GAC1B,SAASoC,EAAiBC,GACzBA,IAAgBA,EAAYC,WAAW,QAAUL,OAAOC,cAAgB,IAAMG,EAAc,IAAME,KAAKC,MAEvG3D,EAAawD,GAEb,GAAItD,QAAQR,KAAKI,SAAWI,QAAQR,KAAKI,QAAQ8D,OAAQ,CACxDrG,EAAE,qCAAqCwC,KAAK,MAAOyD,GACnDtD,QAAQR,KAAKmE,gBAAkBL,MACzB,CACNtD,QAAQyC,QAAQ,WACfpF,EAAE,qCAAqCwC,KAAK,MAAOyD,MAKtD,SAASM,IACR,GAAI5D,QAAQR,KAAKmE,kBAAoB3D,QAAQR,KAAKI,QAAS,CAC1DI,QAAQyC,UACR3C,KAIFmB,EAAMe,KAAK,0BAA0B1E,GAAG,QAAS,WAChD2D,EAAMA,MAAM,QAEZhE,EAAeqE,MACduC,aAAc,4BACdC,MAAOZ,OAAOC,cAAgB,aAAenD,QAAQR,KAAKuE,SAAW,iBACrEC,YAAa,EAAI,EACjBC,UAAW,MACXC,WAAYlE,QAAQR,KAAKS,QACzBkE,SAAUnE,QAAQR,KAAK4E,wBACvBC,kBAAmB,MACnBhD,MAAO,0BACPiD,YAAa,4BACbC,OAAQvE,QAAQR,KAAKgF,8BACnB,SAAUC,GACZpB,EAAiBoB,KAGlB,OAAO,QAGRxD,EAAMe,KAAK,8BAA8B1E,GAAG,QAAS,WACpD2D,EAAMA,MAAM,QACZ/D,EAAWwD,MAAM,mDAAqD,SAAUK,GAC/EhE,EAAWiE,UAAUD,EAAM,SAAUA,GACpC,IAAI2D,EAAcrH,EAAE0D,GACpB2D,EAAYzD,MAAM,QAElByD,EAAY1C,KAAK,eAAe1E,GAAG,QAAS,WAC3C,IAAImH,EAAMC,EAAY1C,KAAK,kBAAkBzD,MAC7C,IAAKkG,EAAK,CACT,OAAO,MAGRC,EAAYzD,MAAM,QAElBhE,EAAe0H,iBACdF,IAAKA,EACLZ,aAAc,4BACdG,YAAa,EACbK,kBAAmB,MACnBJ,UAAW,MACXC,WAAYlE,QAAQR,KAAKS,SACvBoD,GAEH,OAAO,YAKV,OAAO,QAGRpC,EAAMe,KAAK,mCAAmC1E,GAAG,QAAS,WACzD+B,OAAOC,KAAK,8BACXhB,IAAK0B,QAAQR,KAAKS,SAChB,SAAUV,GACZ0B,EAAMA,MAAM,QACZ,GAAI1B,EAAK,CACR,OAAO/B,IAAIiC,WAAWF,EAAIG,SAE3BkE,QAKH,SAAS3F,IACRZ,EAAE,kBAAkBC,GAAG,QAAS,WAC/B,IAAIsH,EAAMvH,EAAE6E,MAAMrC,KAAK,WAAY,MACnCR,OAAOC,KAAK,uBAAyB,SAAUC,GAC9CqF,EAAIC,WAAW,YACf,GAAItF,EAAK,CACR,OAAO/B,IAAIiC,WAAWF,EAAIG,SAE3BlC,IAAImC,aAAa,4CAKpB,SAAS6C,EAAkB/B,EAAMiB,GAChCrC,OAAOC,KAAK,sBACXmB,KAAMA,EACNnC,IAAK0B,QAAQR,KAAKS,SAChByB,GAGJ,SAASoD,EAAaC,EAAIC,GACzB,OAAOD,EAAGrB,OAAS,IAAMqB,EAAGxG,MAAMmF,OAAS,IAAMsB,EAAM,IAAM,GAG9D,SAAS9G,IACR,IAAI6G,EAAK1H,EAAE,mBACXA,EAAE,2BAA2B0D,KAAK+D,EAAaC,EAAI/E,QAAQR,KAAKyF,yBAEhEF,EAAGzH,GAAG,eAAgB,WACrBD,EAAE,2BAA2B0D,KAAK+D,EAAaC,EAAI/E,QAAQR,KAAKyF,2BAIlE,SAAS9G,IACR,IAAI4G,EAAK1H,EAAE,iBACXA,EAAE,yBAAyB0D,KAAK+D,EAAaC,EAAI/E,QAAQR,KAAK0F,uBAE9DH,EAAGzH,GAAG,eAAgB,WACrBD,EAAE,yBAAyB0D,KAAK+D,EAAaC,EAAI/E,QAAQR,KAAK0F,yBAIhE,SAAS9G,IACR,SAAS+G,EAAKC,GACb,IAAIC,EAAWhI,EAAE,eAAekB,MAChC,IAAKyB,QAAQR,KAAK8F,qBAAwBrG,MAAMC,QAAQmG,IAAaA,EAAS3B,OAAS,EAAI,CAC1F,OAED,IAAIqB,EAAK1H,EAAE,eAAe2E,KAAK,aAC/B,GAAI+C,EAAGrB,QAAUqB,EAAGxG,MAAO,CAC1B,GAAI6G,EAAY,EAAG,CAClBL,EAAGQ,YAAYR,EAAGS,aACZ,GAAIT,EAAGU,OAAOlH,MAAO,CAC3BwG,EAAGW,aAAaX,EAAGU,UAItBpI,EAAE,gCAAgCC,GAAG,QAAS,WAC7C6H,GAAM,KAEP9H,EAAE,kCAAkCC,GAAG,QAAS,WAC/C6H,EAAK,KAIP,OAAOhI","file":"public/src/client/account/edit.js","sourcesContent":["'use strict';\n\n\ndefine('forum/account/edit', ['forum/account/header', 'translator', 'components', 'pictureCropper', 'benchpress'], function (header, translator, components, pictureCropper, Benchpress) {\n\tvar AccountEdit = {};\n\n\tAccountEdit.init = function () {\n\t\theader.init();\n\n\t\t$('#submitBtn').on('click', updateProfile);\n\n\t\tapp.loadJQueryUI(function () {\n\t\t\t$('#inputBirthday').datepicker({\n\t\t\t\tchangeMonth: true,\n\t\t\t\tchangeYear: true,\n\t\t\t\tyearRange: '1900:-5y',\n\t\t\t\tdefaultDate: '-13y',\n\t\t\t});\n\t\t});\n\n\t\thandleImageChange();\n\t\thandleAccountDelete();\n\t\thandleEmailConfirm();\n\t\tupdateSignature();\n\t\tupdateAboutMe();\n\t\thandleGroupSort();\n\t};\n\n\tfunction updateProfile() {\n\t\tvar userData = {\n\t\t\tuid: $('#inputUID').val(),\n\t\t\tfullname: $('#inputFullname').val(),\n\t\t\twebsite: $('#inputWebsite').val(),\n\t\t\tbirthday: $('#inputBirthday').val(),\n\t\t\tlocation: $('#inputLocation').val(),\n\t\t\tgroupTitle: $('#groupTitle').val(),\n\t\t\tsignature: $('#inputSignature').val(),\n\t\t\taboutme: $('#inputAboutMe').val(),\n\t\t};\n\n\t\tuserData.groupTitle = JSON.stringify(Array.isArray(userData.groupTitle) ? userData.groupTitle : [userData.groupTitle]);\n\n\t\t$(window).trigger('action:profile.update', userData);\n\n\t\tsocket.emit('user.updateProfile', userData, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tapp.alertSuccess('[[user:profile_update_success]]');\n\n\t\t\tif (data.picture) {\n\t\t\t\t$('#user-current-picture').attr('src', data.picture);\n\t\t\t}\n\n\t\t\tupdateHeader(data.picture);\n\t\t});\n\n\t\treturn false;\n\t}\n\n\tfunction updateHeader(picture) {\n\t\tif (parseInt(ajaxify.data.theirid, 10) !== parseInt(ajaxify.data.yourid, 10)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!picture && ajaxify.data.defaultAvatar) {\n\t\t\tpicture = ajaxify.data.defaultAvatar;\n\t\t}\n\t\t$('#header [component=\"avatar/picture\"]')[picture ? 'show' : 'hide']();\n\t\t$('#header [component=\"avatar/icon\"]')[!picture ? 'show' : 'hide']();\n\t\tif (picture) {\n\t\t\t$('#header [component=\"avatar/picture\"]').attr('src', picture);\n\t\t}\n\t}\n\n\tfunction handleImageChange() {\n\t\t$('#changePictureBtn').on('click', function () {\n\t\t\tsocket.emit('user.getProfilePictures', {\n\t\t\t\tuid: ajaxify.data.uid,\n\t\t\t}, function (err, pictures) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\n\t\t\t\t// boolean to signify whether an uploaded picture is present in the pictures list\n\t\t\t\tvar uploaded = pictures.reduce(function (memo, cur) {\n\t\t\t\t\treturn memo || cur.type === 'uploaded';\n\t\t\t\t}, false);\n\n\t\t\t\tBenchpress.parse('partials/modals/change_picture_modal', {\n\t\t\t\t\tpictures: pictures,\n\t\t\t\t\tuploaded: uploaded,\n\t\t\t\t\ticon: { text: ajaxify.data['icon:text'], bgColor: ajaxify.data['icon:bgColor'] },\n\t\t\t\t\tdefaultAvatar: ajaxify.data.defaultAvatar,\n\t\t\t\t\tallowProfileImageUploads: ajaxify.data.allowProfileImageUploads,\n\t\t\t\t}, function (html) {\n\t\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\t\t\tclassName: 'picture-switcher',\n\t\t\t\t\t\t\ttitle: '[[user:change_picture]]',\n\t\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\tclose: {\n\t\t\t\t\t\t\t\t\tlabel: '[[global:close]]',\n\t\t\t\t\t\t\t\t\tcallback: onCloseModal,\n\t\t\t\t\t\t\t\t\tclassName: 'btn-link',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdate: {\n\t\t\t\t\t\t\t\t\tlabel: '[[global:save_changes]]',\n\t\t\t\t\t\t\t\t\tcallback: saveSelection,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tmodal.on('shown.bs.modal', updateImages);\n\t\t\t\t\t\tmodal.on('click', '.list-group-item', function selectImageType() {\n\t\t\t\t\t\t\tmodal.find('.list-group-item').removeClass('active');\n\t\t\t\t\t\t\t$(this).addClass('active');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\thandleImageUpload(modal);\n\n\t\t\t\t\t\tfunction updateImages() {\n\t\t\t\t\t\t\t// Check to see which one is the active picture\n\t\t\t\t\t\t\tif (!ajaxify.data.picture) {\n\t\t\t\t\t\t\t\tmodal.find('.list-group-item .user-icon').parents('.list-group-item').addClass('active');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmodal.find('.list-group-item img').each(function () {\n\t\t\t\t\t\t\t\t\tif (this.getAttribute('src') === ajaxify.data.picture) {\n\t\t\t\t\t\t\t\t\t\t$(this).parents('.list-group-item').addClass('active');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfunction saveSelection() {\n\t\t\t\t\t\t\tvar type = modal.find('.list-group-item.active').attr('data-type');\n\n\t\t\t\t\t\t\tchangeUserPicture(type, function (err) {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tupdateHeader(type === 'default' ? '' : modal.find('.list-group-item.active img').attr('src'));\n\t\t\t\t\t\t\t\tajaxify.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfunction onCloseModal() {\n\t\t\t\t\t\t\tmodal.modal('hide');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction handleAccountDelete() {\n\t\t$('#deleteAccountBtn').on('click', function () {\n\t\t\ttranslator.translate('[[user:delete_account_confirm]]', function (translated) {\n\t\t\t\tvar modal = bootbox.confirm(translated + '<p><input type=\"password\" class=\"form-control\" id=\"confirm-password\" /></p>', function (confirm) {\n\t\t\t\t\tif (!confirm) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar confirmBtn = modal.find('.btn-primary');\n\t\t\t\t\tconfirmBtn.html('<i class=\"fa fa-spinner fa-spin\"></i>');\n\t\t\t\t\tconfirmBtn.prop('disabled', true);\n\n\t\t\t\t\tsocket.emit('user.deleteAccount', {\n\t\t\t\t\t\tpassword: $('#confirm-password').val(),\n\t\t\t\t\t}, function (err) {\n\t\t\t\t\t\tfunction restoreButton() {\n\t\t\t\t\t\t\ttranslator.translate('[[modules:bootbox.confirm]]', function (confirmText) {\n\t\t\t\t\t\t\t\tconfirmBtn.text(confirmText);\n\t\t\t\t\t\t\t\tconfirmBtn.prop('disabled', false);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\trestoreButton();\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconfirmBtn.html('<i class=\"fa fa-check\"></i>');\n\t\t\t\t\t\twindow.location.href = config.relative_path + '/';\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\n\t\t\t\tmodal.on('shown.bs.modal', function () {\n\t\t\t\t\tmodal.find('input').focus();\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction handleImageUpload(modal) {\n\t\tfunction onUploadComplete(urlOnServer) {\n\t\t\turlOnServer = (!urlOnServer.startsWith('http') ? config.relative_path : '') + urlOnServer + '?' + Date.now();\n\n\t\t\tupdateHeader(urlOnServer);\n\n\t\t\tif (ajaxify.data.picture && ajaxify.data.picture.length) {\n\t\t\t\t$('#user-current-picture, img.avatar').attr('src', urlOnServer);\n\t\t\t\tajaxify.data.uploadedpicture = urlOnServer;\n\t\t\t} else {\n\t\t\t\tajaxify.refresh(function () {\n\t\t\t\t\t$('#user-current-picture, img.avatar').attr('src', urlOnServer);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction onRemoveComplete() {\n\t\t\tif (ajaxify.data.uploadedpicture === ajaxify.data.picture) {\n\t\t\t\tajaxify.refresh();\n\t\t\t\tupdateHeader();\n\t\t\t}\n\t\t}\n\n\t\tmodal.find('[data-action=\"upload\"]').on('click', function () {\n\t\t\tmodal.modal('hide');\n\n\t\t\tpictureCropper.show({\n\t\t\t\tsocketMethod: 'user.uploadCroppedPicture',\n\t\t\t\troute: config.relative_path + '/api/user/' + ajaxify.data.userslug + '/uploadpicture',\n\t\t\t\taspectRatio: 1 / 1,\n\t\t\t\tparamName: 'uid',\n\t\t\t\tparamValue: ajaxify.data.theirid,\n\t\t\t\tfileSize: ajaxify.data.maximumProfileImageSize,\n\t\t\t\tallowSkippingCrop: false,\n\t\t\t\ttitle: '[[user:upload_picture]]',\n\t\t\t\tdescription: '[[user:upload_a_picture]]',\n\t\t\t\taccept: ajaxify.data.allowedProfileImageExtensios,\n\t\t\t}, function (url) {\n\t\t\t\tonUploadComplete(url);\n\t\t\t});\n\n\t\t\treturn false;\n\t\t});\n\n\t\tmodal.find('[data-action=\"upload-url\"]').on('click', function () {\n\t\t\tmodal.modal('hide');\n\t\t\tBenchpress.parse('partials/modals/upload_picture_from_url_modal', {}, function (html) {\n\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\tvar uploadModal = $(html);\n\t\t\t\t\tuploadModal.modal('show');\n\n\t\t\t\t\tuploadModal.find('.upload-btn').on('click', function () {\n\t\t\t\t\t\tvar url = uploadModal.find('#uploadFromUrl').val();\n\t\t\t\t\t\tif (!url) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tuploadModal.modal('hide');\n\n\t\t\t\t\t\tpictureCropper.handleImageCrop({\n\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\tsocketMethod: 'user.uploadCroppedPicture',\n\t\t\t\t\t\t\taspectRatio: 1,\n\t\t\t\t\t\t\tallowSkippingCrop: false,\n\t\t\t\t\t\t\tparamName: 'uid',\n\t\t\t\t\t\t\tparamValue: ajaxify.data.theirid,\n\t\t\t\t\t\t}, onUploadComplete);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn false;\n\t\t});\n\n\t\tmodal.find('[data-action=\"remove-uploaded\"]').on('click', function () {\n\t\t\tsocket.emit('user.removeUploadedPicture', {\n\t\t\t\tuid: ajaxify.data.theirid,\n\t\t\t}, function (err) {\n\t\t\t\tmodal.modal('hide');\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tonRemoveComplete();\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction handleEmailConfirm() {\n\t\t$('#confirm-email').on('click', function () {\n\t\t\tvar btn = $(this).attr('disabled', true);\n\t\t\tsocket.emit('user.emailConfirm', {}, function (err) {\n\t\t\t\tbtn.removeAttr('disabled');\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tapp.alertSuccess('[[notifications:email-confirm-sent]]');\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction changeUserPicture(type, callback) {\n\t\tsocket.emit('user.changePicture', {\n\t\t\ttype: type,\n\t\t\tuid: ajaxify.data.theirid,\n\t\t}, callback);\n\t}\n\n\tfunction getCharsLeft(el, max) {\n\t\treturn el.length ? '(' + el.val().length + '/' + max + ')' : '';\n\t}\n\n\tfunction updateSignature() {\n\t\tvar el = $('#inputSignature');\n\t\t$('#signatureCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumSignatureLength));\n\n\t\tel.on('keyup change', function () {\n\t\t\t$('#signatureCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumSignatureLength));\n\t\t});\n\t}\n\n\tfunction updateAboutMe() {\n\t\tvar el = $('#inputAboutMe');\n\t\t$('#aboutMeCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumAboutMeLength));\n\n\t\tel.on('keyup change', function () {\n\t\t\t$('#aboutMeCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumAboutMeLength));\n\t\t});\n\t}\n\n\tfunction handleGroupSort() {\n\t\tfunction move(direction) {\n\t\t\tvar selected = $('#groupTitle').val();\n\t\t\tif (!ajaxify.data.allowMultipleBadges || (Array.isArray(selected) && selected.length > 1)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar el = $('#groupTitle').find(':selected');\n\t\t\tif (el.length && el.val()) {\n\t\t\t\tif (direction > 0) {\n\t\t\t\t\tel.insertAfter(el.next());\n\t\t\t\t} else if (el.prev().val()) {\n\t\t\t\t\tel.insertBefore(el.prev());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$('[component=\"group/order/up\"]').on('click', function () {\n\t\t\tmove(-1);\n\t\t});\n\t\t$('[component=\"group/order/down\"]').on('click', function () {\n\t\t\tmove(1);\n\t\t});\n\t}\n\n\treturn AccountEdit;\n});\n"]}