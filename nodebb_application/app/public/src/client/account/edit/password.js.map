{"version":3,"sources":["public/src/client/account/edit/password.js"],"names":["define","header","translator","zxcvbn","AccountEditPassword","init","handlePasswordChange","currentPassword","$","password_notify","password_confirm_notify","password","password_confirm","passwordvalid","passwordsmatch","onPasswordChanged","passwordStrength","val","length","ajaxify","data","minimumPasswordLength","showError","utils","isPasswordValid","username","email","score","minimumPasswordStrength","showSuccess","onPasswordConfirmChanged","parent","removeClass","children","show","find","html","on","btn","this","addClass","socket","emit","newPassword","uid","theirid","err","app","alertError","message","parseInt","user","window","location","href","config","relative_path","go","userslug","element","msg","translate"],"mappings":"AAAA,aAGAA,OAAO,+BAAgC,uBAAwB,aAAc,UAAW,SAAUC,EAAQC,EAAYC,GACrH,IAAIC,KAEJA,EAAoBC,KAAO,WAC1BJ,EAAOI,OAEPC,KAGD,SAASA,IACR,IAAIC,EAAkBC,EAAE,yBACxB,IAAIC,EAAkBD,EAAE,oBACxB,IAAIE,EAA0BF,EAAE,4BAChC,IAAIG,EAAWH,EAAE,qBACjB,IAAII,EAAmBJ,EAAE,0BACzB,IAAIK,EAAgB,MACpB,IAAIC,EAAiB,MAErB,SAASC,IACR,IAAIC,EAAmBb,EAAOQ,EAASM,OACvCJ,EAAgB,MAChB,GAAIF,EAASM,MAAMC,OAASC,QAAQC,KAAKC,sBAAuB,CAC/DC,EAAUb,EAAiB,8CACrB,GAAIE,EAASM,MAAMC,OAAS,IAAK,CACvCI,EAAUb,EAAiB,oCACrB,IAAKc,MAAMC,gBAAgBb,EAASM,OAAQ,CAClDK,EAAUb,EAAiB,uCACrB,GAAIE,EAASM,QAAUE,QAAQC,KAAKK,SAAU,CACpDH,EAAUb,EAAiB,2CACrB,GAAIE,EAASM,QAAUE,QAAQC,KAAKM,MAAO,CACjDJ,EAAUb,EAAiB,wCACrB,GAAIO,EAAiBW,MAAQR,QAAQC,KAAKQ,wBAAyB,CACzEN,EAAUb,EAAiB,8BACrB,CACNoB,EAAYpB,GACZI,EAAgB,MAIlB,SAASiB,IACR,GAAInB,EAASM,QAAUL,EAAiBK,MAAO,CAC9CK,EAAUZ,EAAyB,wCACnCI,EAAiB,UACX,CACN,GAAIH,EAASM,MAAO,CACnBY,EAAYnB,OACN,CACNA,EAAwBqB,SAASC,YAAY,8BAC7CtB,EAAwBuB,WAAWC,OACnCxB,EAAwByB,KAAK,QAAQC,KAAK,IAG3CtB,EAAiB,MAInBH,EAAS0B,GAAG,OAAQtB,GACpBH,EAAiByB,GAAG,OAAQP,GAE5BtB,EAAE,sBAAsB6B,GAAG,QAAS,WACnCtB,IACAe,IAEA,IAAIQ,EAAM9B,EAAE+B,MACZ,GAAI1B,GAAiBC,EAAgB,CACpCwB,EAAIE,SAAS,YAAYL,KAAK,KAAKH,YAAY,QAC/CS,OAAOC,KAAK,uBACXnC,gBAAiBA,EAAgBU,MACjC0B,YAAahC,EAASM,MACtB2B,IAAKzB,QAAQC,KAAKyB,SAChB,SAAUC,GACZR,EAAIN,YAAY,YAAYG,KAAK,KAAKK,SAAS,QAC/CjC,EAAgBU,IAAI,IACpBN,EAASM,IAAI,IACbL,EAAiBK,IAAI,IACrBR,EAAgBsB,SAASC,YAAY,4BACrCtB,EAAwBqB,SAASC,YAAY,4BAC7ClB,EAAiB,MACjBD,EAAgB,MAEhB,GAAIiC,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3B,GAAIC,SAASH,IAAII,KAAKP,IAAK,MAAQM,SAAS/B,QAAQC,KAAKwB,IAAK,IAAK,CAClEQ,OAAOC,SAASC,KAAOC,OAAOC,cAAgB,aACxC,CACNrC,QAAQsC,GAAG,QAAUtC,QAAQC,KAAKsC,SAAW,gBAGzC,CACN,IAAK5C,EAAgB,CACpBiC,IAAIC,WAAW,wCAGhB,IAAKnC,EAAe,CACnBkC,IAAIC,WAAW,mCAGjB,OAAO,QAIT,SAAS1B,EAAUqC,EAASC,GAC3B1D,EAAW2D,UAAUD,EAAK,SAAUA,GACnCD,EAAQvB,KAAKwB,GAEbD,EAAQ5B,SACNC,YAAY,gBACZQ,SAAS,iBAIb,SAASX,EAAY8B,GACpBA,EAAQvB,KAAK,IACbuB,EAAQ5B,SACNC,YAAY,eACZQ,SAAS,gBAGZ,OAAOpC","file":"public/src/client/account/edit/password.js","sourcesContent":["'use strict';\n\n\ndefine('forum/account/edit/password', ['forum/account/header', 'translator', 'zxcvbn'], function (header, translator, zxcvbn) {\n\tvar AccountEditPassword = {};\n\n\tAccountEditPassword.init = function () {\n\t\theader.init();\n\n\t\thandlePasswordChange();\n\t};\n\n\tfunction handlePasswordChange() {\n\t\tvar currentPassword = $('#inputCurrentPassword');\n\t\tvar password_notify = $('#password-notify');\n\t\tvar password_confirm_notify = $('#password-confirm-notify');\n\t\tvar password = $('#inputNewPassword');\n\t\tvar password_confirm = $('#inputNewPasswordAgain');\n\t\tvar passwordvalid = false;\n\t\tvar passwordsmatch = false;\n\n\t\tfunction onPasswordChanged() {\n\t\t\tvar passwordStrength = zxcvbn(password.val());\n\t\t\tpasswordvalid = false;\n\t\t\tif (password.val().length < ajaxify.data.minimumPasswordLength) {\n\t\t\t\tshowError(password_notify, '[[reset_password:password_too_short]]');\n\t\t\t} else if (password.val().length > 512) {\n\t\t\t\tshowError(password_notify, '[[error:password-too-long]]');\n\t\t\t} else if (!utils.isPasswordValid(password.val())) {\n\t\t\t\tshowError(password_notify, '[[user:change_password_error]]');\n\t\t\t} else if (password.val() === ajaxify.data.username) {\n\t\t\t\tshowError(password_notify, '[[user:password_same_as_username]]');\n\t\t\t} else if (password.val() === ajaxify.data.email) {\n\t\t\t\tshowError(password_notify, '[[user:password_same_as_email]]');\n\t\t\t} else if (passwordStrength.score < ajaxify.data.minimumPasswordStrength) {\n\t\t\t\tshowError(password_notify, '[[user:weak_password]]');\n\t\t\t} else {\n\t\t\t\tshowSuccess(password_notify);\n\t\t\t\tpasswordvalid = true;\n\t\t\t}\n\t\t}\n\n\t\tfunction onPasswordConfirmChanged() {\n\t\t\tif (password.val() !== password_confirm.val()) {\n\t\t\t\tshowError(password_confirm_notify, '[[user:change_password_error_match]]');\n\t\t\t\tpasswordsmatch = false;\n\t\t\t} else {\n\t\t\t\tif (password.val()) {\n\t\t\t\t\tshowSuccess(password_confirm_notify);\n\t\t\t\t} else {\n\t\t\t\t\tpassword_confirm_notify.parent().removeClass('alert-success alert-danger');\n\t\t\t\t\tpassword_confirm_notify.children().show();\n\t\t\t\t\tpassword_confirm_notify.find('.msg').html('');\n\t\t\t\t}\n\n\t\t\t\tpasswordsmatch = true;\n\t\t\t}\n\t\t}\n\n\t\tpassword.on('blur', onPasswordChanged);\n\t\tpassword_confirm.on('blur', onPasswordConfirmChanged);\n\n\t\t$('#changePasswordBtn').on('click', function () {\n\t\t\tonPasswordChanged();\n\t\t\tonPasswordConfirmChanged();\n\n\t\t\tvar btn = $(this);\n\t\t\tif (passwordvalid && passwordsmatch) {\n\t\t\t\tbtn.addClass('disabled').find('i').removeClass('hide');\n\t\t\t\tsocket.emit('user.changePassword', {\n\t\t\t\t\tcurrentPassword: currentPassword.val(),\n\t\t\t\t\tnewPassword: password.val(),\n\t\t\t\t\tuid: ajaxify.data.theirid,\n\t\t\t\t}, function (err) {\n\t\t\t\t\tbtn.removeClass('disabled').find('i').addClass('hide');\n\t\t\t\t\tcurrentPassword.val('');\n\t\t\t\t\tpassword.val('');\n\t\t\t\t\tpassword_confirm.val('');\n\t\t\t\t\tpassword_notify.parent().removeClass('show-success show-danger');\n\t\t\t\t\tpassword_confirm_notify.parent().removeClass('show-success show-danger');\n\t\t\t\t\tpasswordsmatch = false;\n\t\t\t\t\tpasswordvalid = false;\n\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t}\n\t\t\t\t\tif (parseInt(app.user.uid, 10) === parseInt(ajaxify.data.uid, 10)) {\n\t\t\t\t\t\twindow.location.href = config.relative_path + '/login';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tajaxify.go('user/' + ajaxify.data.userslug + '/edit');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (!passwordsmatch) {\n\t\t\t\t\tapp.alertError('[[user:change_password_error_match]]');\n\t\t\t\t}\n\n\t\t\t\tif (!passwordvalid) {\n\t\t\t\t\tapp.alertError('[[user:change_password_error]]');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tfunction showError(element, msg) {\n\t\ttranslator.translate(msg, function (msg) {\n\t\t\telement.html(msg);\n\n\t\t\telement.parent()\n\t\t\t\t.removeClass('show-success')\n\t\t\t\t.addClass('show-danger');\n\t\t});\n\t}\n\n\tfunction showSuccess(element) {\n\t\telement.html('');\n\t\telement.parent()\n\t\t\t.removeClass('show-danger')\n\t\t\t.addClass('show-success');\n\t}\n\n\treturn AccountEditPassword;\n});\n"]}