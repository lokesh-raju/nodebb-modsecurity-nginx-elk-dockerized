{"version":3,"sources":["public/src/client/account/settings.js"],"names":["define","header","components","sounds","translator","AccountSettings","$","window","on","ajaxify","data","template","name","val","config","bootswatchSkin","app","reskin","init","settings","loadSettings","homePageRoute","homePageCustom","get","relative_path","saveSettings","fail","alertError","this","toggleCustomRoute","find","e","preventDefault","soundName","parent","playSound","timeago","each","id","input","setting","attr","is","socket","emit","uid","theirid","err","newSettings","message","alertSuccess","languageChanged","key","hasOwnProperty","userLang","loadMap","parseInt","user","translate","translated","htmlEl","css","getScript","utils","userLangToTimeagoCode","overrides","overrideTimeago","refresh","show","hide"],"mappings":"AAAA,aAGAA,OAAO,0BAA2B,uBAAwB,aAAc,SAAU,cAAe,SAAUC,EAAQC,EAAYC,EAAQC,GACtI,IAAIC,KAGJC,EAAEC,QAAQC,GAAG,uBAAwB,WACpC,GAAIC,QAAQC,KAAKC,SAASC,OAAS,oBAAsBN,EAAE,mBAAmBO,QAAUC,OAAOC,eAAgB,CAC9GC,IAAIC,OAAOH,OAAOC,mBAIpBV,EAAgBa,KAAO,WACtBjB,EAAOiB,OAEPZ,EAAE,cAAcE,GAAG,QAAS,WAC3B,IAAIW,EAAWC,IAEf,GAAID,EAASE,gBAAkB,UAAYF,EAASG,eAAgB,CACnEhB,EAAEiB,IAAIT,OAAOU,cAAgB,IAAML,EAASG,eAAgB,WAC3DG,EAAaN,KACXO,KAAK,WACPV,IAAIW,WAAW,2CAEV,CACNF,EAAaN,GAGd,OAAO,QAGRb,EAAE,mBAAmBE,GAAG,SAAU,WACjCQ,IAAIC,OAAOX,EAAEsB,MAAMf,SAGpBP,EAAE,mCAAmCE,GAAG,SAAUqB,GAElDvB,EAAE,YAAYwB,KAAK,8BAA8BtB,GAAG,QAAS,SAAUuB,GACtEA,EAAEC,iBAEF,IAAIC,EAAY3B,EAAEsB,MAAMM,SAASA,SAASJ,KAAK,UAC7CjB,MACFV,EAAOgC,UAAUF,KAGlBJ,IAEA3B,EAAWqB,IAAI,iBAAiBO,KAAK,YAAYM,WAGlD,SAAShB,IACR,IAAID,KAEJb,EAAE,YAAYwB,KAAK,2BAA2BO,KAAK,SAAUC,EAAIC,GAChEA,EAAQjC,EAAEiC,GACV,IAAIC,EAAUD,EAAME,KAAK,iBACzB,GAAIF,EAAMG,GAAG,UAAW,CACvBvB,EAASqB,GAAWD,EAAM1B,MAC1B,OAGD,OAAQ0B,EAAME,KAAK,SAClB,IAAK,OACL,IAAK,WACJtB,EAASqB,GAAWD,EAAM1B,MAC1B,MACD,IAAK,WACJM,EAASqB,GAAWD,EAAMG,GAAG,YAAc,EAAI,EAC/C,SAIH,OAAOvB,EAGR,SAASM,EAAaN,GACrBwB,OAAOC,KAAK,qBAAuBC,IAAKpC,QAAQC,KAAKoC,QAAS3B,SAAUA,GAAY,SAAU4B,EAAKC,GAClG,GAAID,EAAK,CACR,OAAO/B,IAAIW,WAAWoB,EAAIE,SAG3BjC,IAAIkC,aAAa,8BACjB,IAAIC,EAAkB,MACtB,IAAK,IAAIC,KAAOJ,EAAa,CAC5B,GAAIA,EAAYK,eAAeD,GAAM,CACpC,GAAIA,IAAQ,YAActC,OAAOwC,WAAaN,EAAYM,SAAU,CACnEH,EAAkB,KAEnB,GAAIrC,OAAOuC,eAAeD,GAAM,CAC/BtC,OAAOsC,GAAOJ,EAAYI,KAK7BjD,EAAOoD,UAEP,GAAIJ,GAAmBK,SAASxC,IAAIyC,KAAKZ,IAAK,MAAQW,SAAS/C,QAAQC,KAAKoC,QAAS,IAAK,CACzF1C,EAAWsD,UAAU,mBAAoB5C,OAAOwC,SAAU,SAAUK,GACnE,IAAIC,EAAStD,EAAE,QACfsD,EAAOnB,KAAK,WAAYkB,GACxBC,EAAOC,IAAI,YAAaF,KAEzBrD,EAAEwD,UAAUhD,OAAOU,cAAgB,wDAA0DuC,MAAMC,sBAAsBlD,OAAOwC,UAAY,MAAO,WAClJW,UAAUC,kBACVzD,QAAQ0D,eAMZ,SAAStC,IACR,GAAIvB,EAAE,mCAAmCO,QAAU,SAAU,CAC5DP,EAAE,mBAAmB8D,WACf,CACN9D,EAAE,mBAAmB+D,OACrB/D,EAAE,oCAAoCO,IAAI,KAI5C,OAAOR","file":"public/src/client/account/settings.js","sourcesContent":["'use strict';\n\n\ndefine('forum/account/settings', ['forum/account/header', 'components', 'sounds', 'translator'], function (header, components, sounds, translator) {\n\tvar\tAccountSettings = {};\n\n\t// If page skin is changed but not saved, switch the skin back\n\t$(window).on('action:ajaxify.start', function () {\n\t\tif (ajaxify.data.template.name === 'account/settings' && $('#bootswatchSkin').val() !== config.bootswatchSkin) {\n\t\t\tapp.reskin(config.bootswatchSkin);\n\t\t}\n\t});\n\n\tAccountSettings.init = function () {\n\t\theader.init();\n\n\t\t$('#submitBtn').on('click', function () {\n\t\t\tvar settings = loadSettings();\n\n\t\t\tif (settings.homePageRoute === 'custom' && settings.homePageCustom) {\n\t\t\t\t$.get(config.relative_path + '/' + settings.homePageCustom, function () {\n\t\t\t\t\tsaveSettings(settings);\n\t\t\t\t}).fail(function () {\n\t\t\t\t\tapp.alertError('[[error:invalid-home-page-route]]');\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsaveSettings(settings);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n\n\t\t$('#bootswatchSkin').on('change', function () {\n\t\t\tapp.reskin($(this).val());\n\t\t});\n\n\t\t$('[data-property=\"homePageRoute\"]').on('change', toggleCustomRoute);\n\n\t\t$('.account').find('button[data-action=\"play\"]').on('click', function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar\tsoundName = $(this).parent().parent().find('select')\n\t\t\t\t.val();\n\t\t\tsounds.playSound(soundName);\n\t\t});\n\n\t\ttoggleCustomRoute();\n\n\t\tcomponents.get('user/sessions').find('.timeago').timeago();\n\t};\n\n\tfunction loadSettings() {\n\t\tvar settings = {};\n\n\t\t$('.account').find('input, textarea, select').each(function (id, input) {\n\t\t\tinput = $(input);\n\t\t\tvar setting = input.attr('data-property');\n\t\t\tif (input.is('select')) {\n\t\t\t\tsettings[setting] = input.val();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (input.attr('type')) {\n\t\t\t\tcase 'text':\n\t\t\t\tcase 'textarea':\n\t\t\t\t\tsettings[setting] = input.val();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'checkbox':\n\t\t\t\t\tsettings[setting] = input.is(':checked') ? 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\treturn settings;\n\t}\n\n\tfunction saveSettings(settings) {\n\t\tsocket.emit('user.saveSettings', { uid: ajaxify.data.theirid, settings: settings }, function (err, newSettings) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tapp.alertSuccess('[[success:settings-saved]]');\n\t\t\tvar languageChanged = false;\n\t\t\tfor (var key in newSettings) {\n\t\t\t\tif (newSettings.hasOwnProperty(key)) {\n\t\t\t\t\tif (key === 'userLang' && config.userLang !== newSettings.userLang) {\n\t\t\t\t\t\tlanguageChanged = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (config.hasOwnProperty(key)) {\n\t\t\t\t\t\tconfig[key] = newSettings[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsounds.loadMap();\n\n\t\t\tif (languageChanged && parseInt(app.user.uid, 10) === parseInt(ajaxify.data.theirid, 10)) {\n\t\t\t\ttranslator.translate('[[language:dir]]', config.userLang, function (translated) {\n\t\t\t\t\tvar htmlEl = $('html');\n\t\t\t\t\thtmlEl.attr('data-dir', translated);\n\t\t\t\t\thtmlEl.css('direction', translated);\n\t\t\t\t});\n\t\t\t\t$.getScript(config.relative_path + '/assets/vendor/jquery/timeago/locales/jquery.timeago.' + utils.userLangToTimeagoCode(config.userLang) + '.js', function () {\n\t\t\t\t\toverrides.overrideTimeago();\n\t\t\t\t\tajaxify.refresh();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction toggleCustomRoute() {\n\t\tif ($('[data-property=\"homePageRoute\"]').val() === 'custom') {\n\t\t\t$('#homePageCustom').show();\n\t\t} else {\n\t\t\t$('#homePageCustom').hide();\n\t\t\t$('[data-property=\"homePageCustom\"]').val('');\n\t\t}\n\t}\n\n\treturn AccountSettings;\n});\n"]}