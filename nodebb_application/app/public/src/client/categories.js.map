{"version":3,"sources":["public/src/client/categories.js"],"names":["define","components","categories","$","window","on","ev","data","ajaxify","currentPage","url","socket","removeListener","onNewPost","init","app","enterRoom","tooltip","placement","posts","length","topic","renderNewPost","cid","post","category","get","numRecentReplies","attr","parseInt","find","recentPosts","parseAndTranslate","html","addClass","hide","appendTo","insertBefore","first","fadeIn","createUserTooltips","timeago","last","remove","trigger"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,cAAe,SAAUC,GACpD,IAAIC,KAEJC,EAAEC,QAAQC,GAAG,uBAAwB,SAAUC,EAAIC,GAClD,GAAIC,QAAQC,cAAgBF,EAAKG,IAAK,CACrCC,OAAOC,eAAe,iBAAkBV,EAAWW,cAIrDX,EAAWY,KAAO,WACjBC,IAAIC,UAAU,cAEdL,OAAOC,eAAe,iBAAkBV,EAAWW,WACnDF,OAAON,GAAG,iBAAkBH,EAAWW,WAEvCV,EAAE,oBAAoBc,SACrBC,UAAW,YAIbhB,EAAWW,UAAY,SAAUN,GAChC,GAAIA,GAAQA,EAAKY,OAASZ,EAAKY,MAAMC,QAAUb,EAAKY,MAAM,GAAGE,MAAO,CACnEC,EAAcf,EAAKY,MAAM,GAAGE,MAAME,IAAKhB,EAAKY,MAAM,MAIpD,SAASG,EAAcC,EAAKC,GAC3B,IAAIC,EAAWxB,EAAWyB,IAAI,sBAAuB,MAAOH,GAC5D,IAAII,EAAmBF,EAASG,KAAK,yBACrC,IAAKD,IAAqBE,SAASF,EAAkB,IAAK,CACzD,OAED,IAAKF,EAASK,KAAK,8BAA8BV,OAAQ,CACxD,OAGD,IAAIW,EAAcN,EAASK,KAAK,gCAEhCf,IAAIiB,kBAAkB,+BAAgC,SAAWb,OAAQK,IAAS,SAAUS,GAC3FA,EAAKH,KAAK,0CAA0CI,SAAS,kBAC7DD,EAAKE,OACL,GAAIJ,EAAYX,SAAW,EAAG,CAC7Ba,EAAKG,SAASX,OACR,CACNQ,EAAKI,aAAaN,EAAYO,SAG/BL,EAAKM,SAELxB,IAAIyB,qBACJP,EAAKH,KAAK,YAAYW,UAEtB,GAAIhB,EAASK,KAAK,gCAAgCV,OAASS,SAASF,EAAkB,IAAK,CAC1FI,EAAYW,OAAOC,SAGpBxC,EAAEC,QAAQwC,QAAQ,uBAAyBzB,OAAQK,OAIrD,OAAOtB","file":"public/src/client/categories.js","sourcesContent":["'use strict';\n\n\ndefine('forum/categories', ['components'], function (components) {\n\tvar\tcategories = {};\n\n\t$(window).on('action:ajaxify.start', function (ev, data) {\n\t\tif (ajaxify.currentPage !== data.url) {\n\t\t\tsocket.removeListener('event:new_post', categories.onNewPost);\n\t\t}\n\t});\n\n\tcategories.init = function () {\n\t\tapp.enterRoom('categories');\n\n\t\tsocket.removeListener('event:new_post', categories.onNewPost);\n\t\tsocket.on('event:new_post', categories.onNewPost);\n\n\t\t$('.category-header').tooltip({\n\t\t\tplacement: 'bottom',\n\t\t});\n\t};\n\n\tcategories.onNewPost = function (data) {\n\t\tif (data && data.posts && data.posts.length && data.posts[0].topic) {\n\t\t\trenderNewPost(data.posts[0].topic.cid, data.posts[0]);\n\t\t}\n\t};\n\n\tfunction renderNewPost(cid, post) {\n\t\tvar category = components.get('categories/category', 'cid', cid);\n\t\tvar numRecentReplies = category.attr('data-numRecentReplies');\n\t\tif (!numRecentReplies || !parseInt(numRecentReplies, 10)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!category.find('[component=\"topic/teaser\"]').length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar recentPosts = category.find('[component=\"category/posts\"]');\n\n\t\tapp.parseAndTranslate('partials/categories/lastpost', 'posts', { posts: [post] }, function (html) {\n\t\t\thtml.find('.post-content img:not(.not-responsive)').addClass('img-responsive');\n\t\t\thtml.hide();\n\t\t\tif (recentPosts.length === 0) {\n\t\t\t\thtml.appendTo(category);\n\t\t\t} else {\n\t\t\t\thtml.insertBefore(recentPosts.first());\n\t\t\t}\n\n\t\t\thtml.fadeIn();\n\n\t\t\tapp.createUserTooltips();\n\t\t\thtml.find('.timeago').timeago();\n\n\t\t\tif (category.find('[component=\"category/posts\"]').length > parseInt(numRecentReplies, 10)) {\n\t\t\t\trecentPosts.last().remove();\n\t\t\t}\n\n\t\t\t$(window).trigger('action:posts.loaded', { posts: [post] });\n\t\t});\n\t}\n\n\treturn categories;\n});\n"]}