"use strict";define("forum/category/tools",["topicSelect","components","translator"],function(e,t,o){var n={};n.init=function(){e.init(a);C();t.get("topic/delete").on("click",function(){r("delete",e.getSelectedTids());return false});t.get("topic/restore").on("click",function(){r("restore",e.getSelectedTids());return false});t.get("topic/purge").on("click",function(){r("purge",e.getSelectedTids());return false});t.get("topic/lock").on("click",function(){var t=e.getSelectedTids();if(!t.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.lock",{tids:t},c);return false});t.get("topic/unlock").on("click",function(){var t=e.getSelectedTids();if(!t.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.unlock",{tids:t},c);return false});t.get("topic/pin").on("click",function(){var t=e.getSelectedTids();if(!t.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.pin",{tids:t},c);return false});t.get("topic/unpin").on("click",function(){var t=e.getSelectedTids();if(!t.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.unpin",{tids:t},c);return false});t.get("topic/mark-unread-for-all").on("click",function(){var t=e.getSelectedTids();if(!t.length){return app.alertError("[[error:no-topics-selected]]")}socket.emit("topics.markAsUnreadForAll",t,function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[topic:markAsUnreadForAll.success]]");t.forEach(function(e){$('[component="category/topic"][data-tid="'+e+'"]').addClass("unread")});c()});return false});t.get("topic/move").on("click",function(){require(["forum/topic/move"],function(t){var o=e.getSelectedTids();if(!o.length){return app.alertError("[[error:no-topics-selected]]")}t.init(o,null,c)});return false});t.get("topic/move-all").on("click",function(){var e=ajaxify.data.cid;if(!ajaxify.data.template.category){return app.alertError("[[error:invalid-data]]")}require(["forum/topic/move"],function(t){t.init(null,e,function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})})});t.get("topic/merge").on("click",function(){require(["forum/topic/merge"],function(e){e.init()})});n.removeListeners();socket.on("event:topic_deleted",v);socket.on("event:topic_restored",v);socket.on("event:topic_purged",_);socket.on("event:topic_locked",m);socket.on("event:topic_unlocked",m);socket.on("event:topic_pinned",k);socket.on("event:topic_unpinned",k);socket.on("event:topic_moved",h)};function r(e,t){if(!t.length){return app.alertError("[[error:no-topics-selected]]")}o.translate("[[topic:thread_tools."+e+"_confirm]]",function(o){bootbox.confirm(o,function(o){if(!o){return}socket.emit("topics."+e,{tids:t},s)})})}n.removeListeners=function(){socket.removeListener("event:topic_deleted",v);socket.removeListener("event:topic_restored",v);socket.removeListener("event:topic_purged",_);socket.removeListener("event:topic_locked",m);socket.removeListener("event:topic_unlocked",m);socket.removeListener("event:topic_pinned",k);socket.removeListener("event:topic_unpinned",k);socket.removeListener("event:topic_moved",h)};function i(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function c(t){if(t){return app.alertError(t.message)}i();e.unselectAll()}function s(e){if(e){return app.alertError(e.message)}i();a()}function a(){var o=e.getSelectedTids();var n=l(p,o);var r=d(p,o);var i=l(f,o);var c=l(u,o);t.get("topic/delete").toggleClass("hidden",n);t.get("topic/restore").toggleClass("hidden",!n);t.get("topic/purge").toggleClass("hidden",!r);t.get("topic/lock").toggleClass("hidden",c);t.get("topic/unlock").toggleClass("hidden",!c);t.get("topic/pin").toggleClass("hidden",i);t.get("topic/unpin").toggleClass("hidden",!i)}function l(e,t){for(var o=0;o<t.length;o+=1){if(e(t[o])){return true}}return false}function d(e,t){for(var o=0;o<t.length;o+=1){if(!e(t[o])){return false}}return true}function p(e){return g(e).hasClass("deleted")}function u(e){return g(e).hasClass("locked")}function f(e){return g(e).hasClass("pinned")}function g(e){return t.get("category/topic","tid",e)}function v(e){var t=g(e.tid);t.toggleClass("deleted",e.isDeleted);t.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function k(e){var t=g(e.tid);t.toggleClass("pinned",e.isPinned);t.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned);ajaxify.refresh()}function m(e){var t=g(e.tid);t.toggleClass("locked",e.isLocked);t.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function h(e){g(e.tid).remove()}function _(e){g(e.tid).remove()}function C(){var e=ajaxify.data.topics.reduce(function(e,t){e=t.pinned?e+=1:e;return e},0);if(!app.user.isAdmin&&!app.user.isMod||e<2){return}app.loadJQueryUI(function(){var e=$('[component="category"]').filter(function(e,t){return!$(t).parents("[widget-area],[data-widget-area]").length});e.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',update:function(){var t=[];var o=e.find('[component="category/topic"].pinned');o.each(function(e,n){t.push({tid:$(n).attr("data-tid"),order:o.length-e-1})});socket.emit("topics.orderPinnedTopics",t,function(e){if(e){return app.alertError(e.message)}})}})})}return n});
//# sourceMappingURL=tools.js.map