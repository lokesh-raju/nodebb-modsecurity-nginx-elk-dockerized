{"version":3,"sources":["public/src/client/chats/search.js"],"names":["define","components","search","init","timeoutId","get","on","clearTimeout","setTimeout","doSearch","username","val","chatsListEl","$","empty","socket","emit","query","searchBy","paginate","err","data","app","alertError","message","displayResults","users","filter","user","parseInt","uid","length","translateHtml","forEach","userObj","chatEl","displayUser","onUserClick","parent","toggleClass","createUserImage","picture","status","attr","appendTo","append","roomId","require","chats","switchChat","newChat"],"mappings":"AAAA,aAGAA,OAAO,sBAAuB,cAAe,SAAUC,GACtD,IAAIC,KAEJA,EAAOC,KAAO,WACb,IAAIC,EAAY,EAEhBH,EAAWI,IAAI,eAAeC,GAAG,QAAS,WACzC,GAAIF,EAAW,CACdG,aAAaH,GACbA,EAAY,EAGbA,EAAYI,WAAWC,EAAU,QAInC,SAASA,IACR,IAAIC,EAAWT,EAAWI,IAAI,eAAeM,MAC7C,IAAIC,EAAcC,EAAE,kCAEpB,IAAKH,EAAU,CACd,OAAOE,EAAYE,QAGpBC,OAAOC,KAAK,eACXC,MAAOP,EACPQ,SAAU,WACVC,SAAU,OACR,SAAUC,EAAKC,GACjB,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BC,EAAeb,EAAaS,KAI9B,SAASI,EAAeb,EAAaS,GACpCT,EAAYE,QAEZO,EAAKK,MAAQL,EAAKK,MAAMC,OAAO,SAAUC,GACxC,OAAOC,SAASD,EAAKE,IAAK,MAAQD,SAASP,IAAIM,KAAKE,IAAK,MAG1D,IAAKT,EAAKK,MAAMK,OAAQ,CACvB,OAAOnB,EAAYoB,cAAc,6DAGlCX,EAAKK,MAAMO,QAAQ,SAAUC,GAC5B,IAAIC,EAASC,EAAYxB,EAAasB,GACtCG,EAAYF,EAAQD,KAGrBtB,EAAY0B,SAASC,YAAY,OAAQ,MAG1C,SAASH,EAAYxB,EAAasB,GACjC,SAASM,IACR,OAAQN,EAAQO,QACf,aAAeP,EAAQO,QAAU,YAAcP,EAAQxB,SAAW,OAClE,mDAAqDwB,EAAQ,gBAAkB,KAAOA,EAAQ,aAAe,UAC7G,iCAAmCA,EAAQQ,OAAS,UAAYR,EAAQxB,SAG1E,IAAIyB,EAAStB,EAAE,0CACb8B,KAAK,WAAYT,EAAQJ,KACzBc,SAAShC,GAEXuB,EAAOU,OAAOL,KACd,OAAOL,EAGR,SAASE,EAAYF,EAAQD,GAC5BC,EAAO7B,GAAG,QAAS,WAClBS,OAAOC,KAAK,+BAAgCkB,EAAQJ,IAAK,SAAUV,EAAK0B,GACvE,GAAI1B,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAE3B,GAAIsB,EAAQ,CACXC,SAAS,eAAgB,SAAUC,GAClCA,EAAMC,WAAWH,SAEZ,CACNxB,IAAI4B,QAAQhB,EAAQJ,UAMxB,OAAO5B","file":"public/src/client/chats/search.js","sourcesContent":["'use strict';\n\n\ndefine('forum/chats/search', ['components'], function (components) {\n\tvar search = {};\n\n\tsearch.init = function () {\n\t\tvar timeoutId = 0;\n\n\t\tcomponents.get('chat/search').on('keyup', function () {\n\t\t\tif (timeoutId) {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\ttimeoutId = 0;\n\t\t\t}\n\n\t\t\ttimeoutId = setTimeout(doSearch, 250);\n\t\t});\n\t};\n\n\tfunction doSearch() {\n\t\tvar username = components.get('chat/search').val();\n\t\tvar chatsListEl = $('[component=\"chat/search/list\"]');\n\n\t\tif (!username) {\n\t\t\treturn chatsListEl.empty();\n\t\t}\n\n\t\tsocket.emit('user.search', {\n\t\t\tquery: username,\n\t\t\tsearchBy: 'username',\n\t\t\tpaginate: false,\n\t\t}, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tdisplayResults(chatsListEl, data);\n\t\t});\n\t}\n\n\tfunction displayResults(chatsListEl, data) {\n\t\tchatsListEl.empty();\n\n\t\tdata.users = data.users.filter(function (user) {\n\t\t\treturn parseInt(user.uid, 10) !== parseInt(app.user.uid, 10);\n\t\t});\n\n\t\tif (!data.users.length) {\n\t\t\treturn chatsListEl.translateHtml('<li><div><span>[[users:no-users-found]]</span></div></li>');\n\t\t}\n\n\t\tdata.users.forEach(function (userObj) {\n\t\t\tvar chatEl = displayUser(chatsListEl, userObj);\n\t\t\tonUserClick(chatEl, userObj);\n\t\t});\n\n\t\tchatsListEl.parent().toggleClass('open', true);\n\t}\n\n\tfunction displayUser(chatsListEl, userObj) {\n\t\tfunction createUserImage() {\n\t\t\treturn (userObj.picture ?\n\t\t\t\t'<img src=\"' +\tuserObj.picture + '\" title=\"' +\tuserObj.username + '\" />' :\n\t\t\t\t'<div class=\"user-icon\" style=\"background-color: ' + userObj['icon:bgColor'] + '\">' + userObj['icon:text'] + '</div>') +\n\t\t\t\t'<i class=\"fa fa-circle status ' + userObj.status + '\"></i> ' + userObj.username;\n\t\t}\n\n\t\tvar chatEl = $('<li component=\"chat/search/user\"></li>')\n\t\t\t.attr('data-uid', userObj.uid)\n\t\t\t.appendTo(chatsListEl);\n\n\t\tchatEl.append(createUserImage());\n\t\treturn chatEl;\n\t}\n\n\tfunction onUserClick(chatEl, userObj) {\n\t\tchatEl.on('click', function () {\n\t\t\tsocket.emit('modules.chats.hasPrivateChat', userObj.uid, function (err, roomId) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t}\n\t\t\t\tif (roomId) {\n\t\t\t\t\trequire(['forum/chats'], function (chats) {\n\t\t\t\t\t\tchats.switchChat(roomId);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tapp.newChat(userObj.uid);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\treturn search;\n});\n"]}