{"version":3,"sources":["public/src/client/flags/detail.js"],"names":["define","FlagsList","components","translator","Benchpress","AccountHeader","AccountsDelete","Detail","init","$","val","ajaxify","data","state","removeAttr","assignee","on","action","this","getAttribute","uid","parents","attr","noteEl","document","getElementById","app","user","socket","emit","flagId","serializeArray","err","history","alertError","message","alertSuccess","reloadHistory","note","value","datetime","payload","reloadNotes","notes","setAttribute","removeAttribute","newChat","banAccount","refresh","account","content","purge","postAction","target","pid","tid","closest","bootbox","confirm","ok","selectedNoteEl","index","textareaEl","siblings","parentElement","children","el","hasOwnProperty","classList","remove","add","focus","enableFilterForm","translate","msg","parse","html","wrapperEl","get","empty","find","timeago","translated"],"mappings":"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","file":"public/src/client/flags/detail.js","sourcesContent":["'use strict';\n\ndefine('forum/flags/detail', ['forum/flags/list', 'components', 'translator', 'benchpress', 'forum/account/header', 'accounts/delete'], function (FlagsList, components, translator, Benchpress, AccountHeader, AccountsDelete) {\n\tvar Detail = {};\n\n\tDetail.init = function () {\n\t\t// Update attributes\n\t\t$('#state').val(ajaxify.data.state).removeAttr('disabled');\n\t\t$('#assignee').val(ajaxify.data.assignee).removeAttr('disabled');\n\n\t\t$('#content > div').on('click', '[data-action]', function () {\n\t\t\tvar action = this.getAttribute('data-action');\n\t\t\tvar uid = $(this).parents('[data-uid]').attr('data-uid');\n\t\t\tvar noteEl = document.getElementById('note');\n\n\t\t\tswitch (action) {\n\t\t\t\tcase 'assign':\n\t\t\t\t\t$('#assignee').val(app.user.uid);\n\t\t\t\t\t// falls through\n\n\t\t\t\tcase 'update':\n\t\t\t\t\tsocket.emit('flags.update', {\n\t\t\t\t\t\tflagId: ajaxify.data.flagId,\n\t\t\t\t\t\tdata: $('#attributes').serializeArray(),\n\t\t\t\t\t}, function (err, history) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tapp.alertSuccess('[[flags:updated]]');\n\t\t\t\t\t\tDetail.reloadHistory(history);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'appendNote':\n\t\t\t\t\tsocket.emit('flags.appendNote', {\n\t\t\t\t\t\tflagId: ajaxify.data.flagId,\n\t\t\t\t\t\tnote: noteEl.value,\n\t\t\t\t\t\tdatetime: noteEl.getAttribute('data-datetime'),\n\t\t\t\t\t}, function (err, payload) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tapp.alertSuccess('[[flags:note-added]]');\n\t\t\t\t\t\tDetail.reloadNotes(payload.notes);\n\t\t\t\t\t\tDetail.reloadHistory(payload.history);\n\n\t\t\t\t\t\tnoteEl.setAttribute('data-action', 'appendNote');\n\t\t\t\t\t\tnoteEl.removeAttribute('data-datetime');\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'chat':\n\t\t\t\t\tapp.newChat(uid);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ban':\n\t\t\t\t\tAccountHeader.banAccount(uid, ajaxify.refresh);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'delete-account':\n\t\t\t\t\tAccountsDelete.account(uid, ajaxify.refresh);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'delete-content':\n\t\t\t\t\tAccountsDelete.content(uid, ajaxify.refresh);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'delete-all':\n\t\t\t\t\tAccountsDelete.purge(uid, ajaxify.refresh);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'delete-post':\n\t\t\t\t\tpostAction('delete', ajaxify.data.target.pid, ajaxify.data.target.tid);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'purge-post':\n\t\t\t\t\tpostAction('purge', ajaxify.data.target.pid, ajaxify.data.target.tid);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'restore-post':\n\t\t\t\t\tpostAction('restore', ajaxify.data.target.pid, ajaxify.data.target.tid);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'delete-note':\n\t\t\t\t\tvar datetime = this.closest('[data-datetime]').getAttribute('data-datetime');\n\t\t\t\t\tbootbox.confirm('[[flags:delete-note-confirm]]', function (ok) {\n\t\t\t\t\t\tif (ok) {\n\t\t\t\t\t\t\tsocket.emit('flags.deleteNote', {\n\t\t\t\t\t\t\t\tflagId: ajaxify.data.flagId,\n\t\t\t\t\t\t\t\tdatetime: datetime,\n\t\t\t\t\t\t\t}, function (err, payload) {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tapp.alertSuccess('[[flags:note-deleted]]');\n\t\t\t\t\t\t\t\tDetail.reloadNotes(payload.notes);\n\t\t\t\t\t\t\t\tDetail.reloadHistory(payload.history);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'prepare-edit':\n\t\t\t\t\tvar selectedNoteEl = this.closest('[data-index]');\n\t\t\t\t\tvar index = selectedNoteEl.getAttribute('data-index');\n\t\t\t\t\tvar textareaEl = document.getElementById('note');\n\t\t\t\t\ttextareaEl.value = ajaxify.data.notes[index].content;\n\t\t\t\t\ttextareaEl.setAttribute('data-datetime', ajaxify.data.notes[index].datetime);\n\n\t\t\t\t\tvar siblings = selectedNoteEl.parentElement.children;\n\t\t\t\t\tfor (var el in siblings) {\n\t\t\t\t\t\tif (siblings.hasOwnProperty(el)) {\n\t\t\t\t\t\t\tsiblings[el].classList.remove('editing');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tselectedNoteEl.classList.add('editing');\n\t\t\t\t\ttextareaEl.focus();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\tFlagsList.enableFilterForm();\n\t};\n\n\tfunction postAction(action, pid, tid) {\n\t\ttranslator.translate('[[topic:post_' + action + '_confirm]]', function (msg) {\n\t\t\tbootbox.confirm(msg, function (confirm) {\n\t\t\t\tif (!confirm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsocket.emit('posts.' + action, {\n\t\t\t\t\tpid: pid,\n\t\t\t\t\ttid: tid,\n\t\t\t\t}, function (err) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tapp.alertError(err.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tajaxify.refresh();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tDetail.reloadNotes = function (notes) {\n\t\tajaxify.data.notes = notes;\n\t\tBenchpress.parse('flags/detail', 'notes', {\n\t\t\tnotes: notes,\n\t\t}, function (html) {\n\t\t\tvar wrapperEl = components.get('flag/notes');\n\t\t\twrapperEl.empty();\n\t\t\twrapperEl.html(html);\n\t\t\twrapperEl.find('span.timeago').timeago();\n\t\t\tdocument.getElementById('note').value = '';\n\t\t});\n\t};\n\n\tDetail.reloadHistory = function (history) {\n\t\tBenchpress.parse('flags/detail', 'history', {\n\t\t\thistory: history,\n\t\t}, function (html) {\n\t\t\ttranslator.translate(html, function (translated) {\n\t\t\t\tvar wrapperEl = components.get('flag/history');\n\t\t\t\twrapperEl.empty();\n\t\t\t\twrapperEl.html(translated);\n\t\t\t\twrapperEl.find('span.timeago').timeago();\n\t\t\t});\n\t\t});\n\t};\n\n\treturn Detail;\n});\n"]}