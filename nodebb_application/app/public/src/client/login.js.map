{"version":3,"sources":["public/src/client/login.js"],"names":["define","Login","init","errorEl","$","submitEl","formEl","on","e","preventDefault","val","find","translateText","show","hide","hasClass","addClass","ajaxSubmit","headers","x-csrf-token","config","csrf_token","success","data","pathname","utils","urlToLocation","next","params","url","loggedin","qs","decodeURIComponent","param","window","location","href","error","status","responseText","relative_path","removeClass","length","select","focus"],"mappings":"AAAA,aAGAA,OAAO,iBAAmB,WACzB,IAAIC,KAEJA,EAAMC,KAAO,WACZ,IAAIC,EAAUC,EAAE,uBAChB,IAAIC,EAAWD,EAAE,UACjB,IAAIE,EAASF,EAAE,eAEfC,EAASE,GAAG,QAAS,SAAUC,GAC9BA,EAAEC,iBAEF,IAAKL,EAAE,aAAaM,QAAUN,EAAE,aAAaM,MAAO,CACnDP,EAAQQ,KAAK,KAAKC,cAAc,0CAChCT,EAAQU,WACF,CACNV,EAAQW,OAER,GAAIT,EAASU,SAAS,YAAa,CAClC,OAGDV,EAASW,SAAS,YAGlBV,EAAOW,YACNC,SACCC,eAAgBC,OAAOC,YAExBC,QAAS,SAAUC,GAClB,IAAIC,EAAWC,MAAMC,cAAcH,EAAKI,MAAMH,SAC9C,IAAII,EAASH,MAAMG,QAASC,IAAKN,EAAKI,OACtCC,EAAOE,SAAW,KAClB,IAAIC,EAAKC,mBAAmB5B,EAAE6B,MAAML,IAEpCM,OAAOC,SAASC,KAAOZ,EAAW,IAAMO,GAEzCM,MAAO,SAAUd,GAChB,GAAIA,EAAKe,SAAW,KAAOf,EAAKgB,eAAiB,YAAa,CAC7DL,OAAOC,SAASC,KAAOhB,OAAOoB,cAAgB,gCACxC,CACNrC,EAAQQ,KAAK,KAAKC,cAAcW,EAAKgB,cACrCpC,EAAQU,OACRR,EAASoC,YAAY,YAGrB,GAAIrC,EAAE,mBAAmBsC,OAAQ,CAChCtC,EAAE,aAAauC,iBAQrBvC,EAAE,8BAA8BG,GAAG,QAAS,SAAUC,GACrDA,EAAEC,iBACFN,EAAQW,OACR,OAAO,QAGR,GAAIV,EAAE,sBAAsBM,MAAO,CAClCN,EAAE,sBAAsBM,IAAI,IAAIkC,YAC1B,CACNxC,EAAE,sBAAsBwC,QAEzBxC,EAAE,sBAAsBM,IAAI,UAG7B,OAAOT","file":"public/src/client/login.js","sourcesContent":["'use strict';\n\n\ndefine('forum/login', [], function () {\n\tvar\tLogin = {};\n\n\tLogin.init = function () {\n\t\tvar errorEl = $('#login-error-notify');\n\t\tvar submitEl = $('#login');\n\t\tvar formEl = $('#login-form');\n\n\t\tsubmitEl.on('click', function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tif (!$('#username').val() || !$('#password').val()) {\n\t\t\t\terrorEl.find('p').translateText('[[error:invalid-username-or-password]]');\n\t\t\t\terrorEl.show();\n\t\t\t} else {\n\t\t\t\terrorEl.hide();\n\n\t\t\t\tif (submitEl.hasClass('disabled')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsubmitEl.addClass('disabled');\n\n\n\t\t\t\tformEl.ajaxSubmit({\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t'x-csrf-token': config.csrf_token,\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t\tvar pathname = utils.urlToLocation(data.next).pathname;\n\t\t\t\t\t\tvar params = utils.params({ url: data.next });\n\t\t\t\t\t\tparams.loggedin = true;\n\t\t\t\t\t\tvar qs = decodeURIComponent($.param(params));\n\n\t\t\t\t\t\twindow.location.href = pathname + '?' + qs;\n\t\t\t\t\t},\n\t\t\t\t\terror: function (data) {\n\t\t\t\t\t\tif (data.status === 403 && data.responseText === 'Forbidden') {\n\t\t\t\t\t\t\twindow.location.href = config.relative_path + '/login?error=csrf-invalid';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\terrorEl.find('p').translateText(data.responseText);\n\t\t\t\t\t\t\terrorEl.show();\n\t\t\t\t\t\t\tsubmitEl.removeClass('disabled');\n\n\t\t\t\t\t\t\t// Select the entire password if that field has focus\n\t\t\t\t\t\t\tif ($('#password:focus').length) {\n\t\t\t\t\t\t\t\t$('#password').select();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t$('#login-error-notify button').on('click', function (e) {\n\t\t\te.preventDefault();\n\t\t\terrorEl.hide();\n\t\t\treturn false;\n\t\t});\n\n\t\tif ($('#content #username').val()) {\n\t\t\t$('#content #password').val('').focus();\n\t\t} else {\n\t\t\t$('#content #username').focus();\n\t\t}\n\t\t$('#content #noscript').val('false');\n\t};\n\n\treturn Login;\n});\n"]}