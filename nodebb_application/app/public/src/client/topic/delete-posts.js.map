{"version":3,"sources":["public/src/client/topic/delete-posts.js"],"names":["define","components","postSelect","DeletePosts","modal","deleteBtn","purgeBtn","tid","init","ajaxify","data","$","window","off","onAjaxifyEnd","on","app","parseAndTranslate","html","append","find","closeModal","checkButtonEnable","showPostsSelected","deletePosts","template","name","btn","command","attr","socket","emit","pids","err","removeAttr","alertError","message","length","translateHtml","remove","disable"],"mappings":"AAAA,aAGAA,OAAO,4BAA6B,aAAc,cAAe,SAAUC,EAAYC,GACtF,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJJ,EAAYK,KAAO,WAClBD,EAAME,QAAQC,KAAKH,IAEnBI,EAAEC,QAAQC,IAAI,qBAAsBC,GAAcC,GAAG,qBAAsBD,GAE3E,GAAIV,EAAO,CACV,OAGDY,IAAIC,kBAAkB,iCAAmC,SAAUC,GAClEd,EAAQc,EAERP,EAAE,QAAQQ,OAAOf,GAEjBC,EAAYD,EAAMgB,KAAK,yBACvBd,EAAWF,EAAMgB,KAAK,wBAEtBhB,EAAMgB,KAAK,+BAA+BL,GAAG,QAASM,GAEtDnB,EAAWM,KAAK,WACfc,IACAC,MAEDA,IAEAlB,EAAUU,GAAG,QAAS,WACrBS,EAAYnB,EAAW,uBAExBC,EAASS,GAAG,QAAS,WACpBS,EAAYlB,EAAU,yBAKzB,SAASQ,IACR,GAAIL,QAAQC,KAAKe,SAASC,OAAS,SAAWjB,QAAQC,KAAKH,MAAQA,EAAK,CACvEc,IACAV,EAAEC,QAAQC,IAAI,qBAAsBC,IAItC,SAASU,EAAYG,EAAKC,GACzBD,EAAIE,KAAK,WAAY,MACrBC,OAAOC,KAAKH,GACXrB,IAAKE,QAAQC,KAAKH,IAClByB,KAAM9B,EAAW8B,MACf,SAAUC,GACZN,EAAIO,WAAW,YACf,GAAID,EAAK,CACR,OAAOjB,IAAImB,WAAWF,EAAIG,SAG3Bf,MAIF,SAASE,IACR,GAAIrB,EAAW8B,KAAKK,OAAQ,CAC3BjC,EAAMgB,KAAK,SAASkB,cAAc,2BAA6BpC,EAAW8B,KAAKK,OAAS,UAClF,CACNjC,EAAMgB,KAAK,SAASkB,cAAc,2BAIpC,SAAShB,IACR,GAAIpB,EAAW8B,KAAKK,OAAQ,CAC3BhC,EAAU6B,WAAW,YACrB5B,EAAS4B,WAAW,gBACd,CACN7B,EAAUwB,KAAK,WAAY,MAC3BvB,EAASuB,KAAK,WAAY,OAI5B,SAASR,IACR,GAAIjB,EAAO,CACVA,EAAMmC,SACNnC,EAAQ,KACRF,EAAWsC,WAIb,OAAOrC","file":"public/src/client/topic/delete-posts.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/delete-posts', ['components', 'postSelect'], function (components, postSelect) {\n\tvar DeletePosts = {};\n\tvar modal;\n\tvar deleteBtn;\n\tvar purgeBtn;\n\tvar tid;\n\n\tDeletePosts.init = function () {\n\t\ttid = ajaxify.data.tid;\n\n\t\t$(window).off('action:ajaxify.end', onAjaxifyEnd).on('action:ajaxify.end', onAjaxifyEnd);\n\n\t\tif (modal) {\n\t\t\treturn;\n\t\t}\n\n\t\tapp.parseAndTranslate('partials/delete_posts_modal', {}, function (html) {\n\t\t\tmodal = html;\n\n\t\t\t$('body').append(modal);\n\n\t\t\tdeleteBtn = modal.find('#delete_posts_confirm');\n\t\t\tpurgeBtn = modal.find('#purge_posts_confirm');\n\n\t\t\tmodal.find('.close,#delete_posts_cancel').on('click', closeModal);\n\n\t\t\tpostSelect.init(function () {\n\t\t\t\tcheckButtonEnable();\n\t\t\t\tshowPostsSelected();\n\t\t\t});\n\t\t\tshowPostsSelected();\n\n\t\t\tdeleteBtn.on('click', function () {\n\t\t\t\tdeletePosts(deleteBtn, 'posts.deletePosts');\n\t\t\t});\n\t\t\tpurgeBtn.on('click', function () {\n\t\t\t\tdeletePosts(purgeBtn, 'posts.purgePosts');\n\t\t\t});\n\t\t});\n\t};\n\n\tfunction onAjaxifyEnd() {\n\t\tif (ajaxify.data.template.name !== 'topic' || ajaxify.data.tid !== tid) {\n\t\t\tcloseModal();\n\t\t\t$(window).off('action:ajaxify.end', onAjaxifyEnd);\n\t\t}\n\t}\n\n\tfunction deletePosts(btn, command) {\n\t\tbtn.attr('disabled', true);\n\t\tsocket.emit(command, {\n\t\t\ttid: ajaxify.data.tid,\n\t\t\tpids: postSelect.pids,\n\t\t}, function (err) {\n\t\t\tbtn.removeAttr('disabled');\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tcloseModal();\n\t\t});\n\t}\n\n\tfunction showPostsSelected() {\n\t\tif (postSelect.pids.length) {\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\n\t\t} else {\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_no_pids]]');\n\t\t}\n\t}\n\n\tfunction checkButtonEnable() {\n\t\tif (postSelect.pids.length) {\n\t\t\tdeleteBtn.removeAttr('disabled');\n\t\t\tpurgeBtn.removeAttr('disabled');\n\t\t} else {\n\t\t\tdeleteBtn.attr('disabled', true);\n\t\t\tpurgeBtn.attr('disabled', true);\n\t\t}\n\t}\n\n\tfunction closeModal() {\n\t\tif (modal) {\n\t\t\tmodal.remove();\n\t\t\tmodal = null;\n\t\t\tpostSelect.disable();\n\t\t}\n\t}\n\n\treturn DeletePosts;\n});\n"]}