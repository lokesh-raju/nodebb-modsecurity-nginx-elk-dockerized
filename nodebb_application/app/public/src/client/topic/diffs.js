"use strict";define("forum/topic/diffs",["forum/topic/images","benchpress","translator"],function(t,e,s){var i={};i.open=function(t){if(!config.enablePostHistory){return}var r={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};socket.emit("posts.getDiffs",{pid:t},function(n,o){if(n){return app.alertError(n.message)}e.parse("partials/modals/post_history",{diffs:o.revisions.map(function(t){var e=parseInt(t.timestamp,10);return{username:t.username,timestamp:e,pretty:new Date(e).toLocaleString(config.userLang.replace("_","-"),r)}}),numDiffs:o.timestamps.length,editable:o.editable},function(e){s.translate(e,function(e){var s=bootbox.dialog({title:"[[topic:diffs.title]]",message:e,size:"large"});if(!o.timestamps.length){return}var r=s.find("select");var n=s.find('button[data-action="restore"]');var a=s.find("ul.posts-list");r.on("change",function(){i.load(t,this.value,a);n.prop("disabled",o.timestamps.indexOf(this.value)===0)});n.on("click",function(){i.restore(t,r.val(),s)});s.on("shown.bs.modal",function(){i.load(t,r.val(),a);n.prop("disabled",true)})})})})};i.load=function(t,e,s){if(!config.enablePostHistory){return}socket.emit("posts.showPostAt",{pid:t,since:e},function(t,e){if(t){return app.alertError(t.message)}e.deleted=!!parseInt(e.deleted,10);app.parseAndTranslate("partials/posts_list","posts",{posts:[e]},function(t){s.empty().append(t)})})};i.restore=function(t,e,s){if(!config.enablePostHistory){return}socket.emit("posts.restoreDiff",{pid:t,since:e},function(t){if(t){return app.alertError(t)}s.modal("hide");app.alertSuccess("[[topic:diffs.post-restored]]")})};return i});
//# sourceMappingURL=diffs.js.map