{"version":3,"sources":["public/src/client/topic/fork.js"],"names":["define","components","postSelect","Fork","forkModal","forkCommit","fromTid","init","ajaxify","data","tid","$","window","off","onAjaxifyEnd","on","app","parseAndTranslate","html","find","append","closeForkModal","checkForkButtonEnable","showPostsSelected","createTopicFromPosts","template","name","attr","socket","emit","title","val","pids","err","newTopic","fadeOutAndRemove","pid","get","fadeOut","this","remove","removeAttr","alertError","message","alert","timeout","type","clickfn","go","slug","forEach","length","translateHtml","disable"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,aAAc,cAAe,SAAUC,EAAYC,GAC9E,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJH,EAAKI,KAAO,WACXD,EAAUE,QAAQC,KAAKC,IAEvBC,EAAEC,QAAQC,IAAI,qBAAsBC,GAAcC,GAAG,qBAAsBD,GAE3E,GAAIV,EAAW,CACd,OAGDY,IAAIC,kBAAkB,gCAAkC,SAAUC,GACjEd,EAAYc,EAEZb,EAAaD,EAAUe,KAAK,uBAE5BR,EAAE,QAAQS,OAAOhB,GAEjBA,EAAUe,KAAK,8BAA8BJ,GAAG,QAASM,GACzDjB,EAAUe,KAAK,eAAeJ,GAAG,QAASO,GAE1CpB,EAAWK,KAAK,WACfe,IACAC,MAEDA,IAEAlB,EAAWU,GAAG,QAASS,MAIzB,SAASV,IACR,GAAIN,QAAQC,KAAKgB,SAASC,OAAS,SAAWlB,QAAQC,KAAKC,MAAQJ,EAAS,CAC3Ee,IACAV,EAAEC,QAAQC,IAAI,qBAAsBC,IAItC,SAASU,IACRnB,EAAWsB,KAAK,WAAY,MAC5BC,OAAOC,KAAK,+BACXC,MAAO1B,EAAUe,KAAK,eAAeY,MACrCC,KAAM9B,EAAW8B,KACjB1B,QAASA,GACP,SAAU2B,EAAKC,GACjB,SAASC,EAAiBC,GACzBnC,EAAWoC,IAAI,OAAQ,MAAOD,GAAKE,QAAQ,IAAK,WAC/C3B,EAAE4B,MAAMC,WAGVnC,EAAWoC,WAAW,YACtB,GAAIR,EAAK,CACR,OAAOjB,IAAI0B,WAAWT,EAAIU,SAG3B3B,IAAI4B,OACHC,QAAS,IACTf,MAAO,2BACPa,QAAS,yBACTG,KAAM,UACNC,QAAS,WACRvC,QAAQwC,GAAG,SAAWd,EAASe,SAIjC/C,EAAW8B,KAAKkB,QAAQ,SAAUd,GACjCD,EAAiBC,KAGlBf,MAIF,SAASE,IACR,GAAIrB,EAAW8B,KAAKmB,OAAQ,CAC3B/C,EAAUe,KAAK,cAAciC,cAAc,2BAA6BlD,EAAW8B,KAAKmB,OAAS,UAC3F,CACN/C,EAAUe,KAAK,cAAciC,cAAc,2BAI7C,SAAS9B,IACR,GAAIlB,EAAUe,KAAK,eAAeY,MAAMoB,QAAUjD,EAAW8B,KAAKmB,OAAQ,CACzE9C,EAAWoC,WAAW,gBAChB,CACNpC,EAAWsB,KAAK,WAAY,OAI9B,SAASN,IACR,GAAIjB,EAAW,CACdA,EAAUoC,SACVpC,EAAY,KACZF,EAAWmD,WAIb,OAAOlD","file":"public/src/client/topic/fork.js","sourcesContent":["'use strict';\n\n\ndefine('forum/topic/fork', ['components', 'postSelect'], function (components, postSelect) {\n\tvar Fork = {};\n\tvar forkModal;\n\tvar forkCommit;\n\tvar fromTid;\n\n\tFork.init = function () {\n\t\tfromTid = ajaxify.data.tid;\n\n\t\t$(window).off('action:ajaxify.end', onAjaxifyEnd).on('action:ajaxify.end', onAjaxifyEnd);\n\n\t\tif (forkModal) {\n\t\t\treturn;\n\t\t}\n\n\t\tapp.parseAndTranslate('partials/fork_thread_modal', {}, function (html) {\n\t\t\tforkModal = html;\n\n\t\t\tforkCommit = forkModal.find('#fork_thread_commit');\n\n\t\t\t$('body').append(forkModal);\n\n\t\t\tforkModal.find('.close,#fork_thread_cancel').on('click', closeForkModal);\n\t\t\tforkModal.find('#fork-title').on('keyup', checkForkButtonEnable);\n\n\t\t\tpostSelect.init(function () {\n\t\t\t\tcheckForkButtonEnable();\n\t\t\t\tshowPostsSelected();\n\t\t\t});\n\t\t\tshowPostsSelected();\n\n\t\t\tforkCommit.on('click', createTopicFromPosts);\n\t\t});\n\t};\n\n\tfunction onAjaxifyEnd() {\n\t\tif (ajaxify.data.template.name !== 'topic' || ajaxify.data.tid !== fromTid) {\n\t\t\tcloseForkModal();\n\t\t\t$(window).off('action:ajaxify.end', onAjaxifyEnd);\n\t\t}\n\t}\n\n\tfunction createTopicFromPosts() {\n\t\tforkCommit.attr('disabled', true);\n\t\tsocket.emit('topics.createTopicFromPosts', {\n\t\t\ttitle: forkModal.find('#fork-title').val(),\n\t\t\tpids: postSelect.pids,\n\t\t\tfromTid: fromTid,\n\t\t}, function (err, newTopic) {\n\t\t\tfunction fadeOutAndRemove(pid) {\n\t\t\t\tcomponents.get('post', 'pid', pid).fadeOut(500, function () {\n\t\t\t\t\t$(this).remove();\n\t\t\t\t});\n\t\t\t}\n\t\t\tforkCommit.removeAttr('disabled');\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tapp.alert({\n\t\t\t\ttimeout: 5000,\n\t\t\t\ttitle: '[[global:alert.success]]',\n\t\t\t\tmessage: '[[topic:fork_success]]',\n\t\t\t\ttype: 'success',\n\t\t\t\tclickfn: function () {\n\t\t\t\t\tajaxify.go('topic/' + newTopic.slug);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tpostSelect.pids.forEach(function (pid) {\n\t\t\t\tfadeOutAndRemove(pid);\n\t\t\t});\n\n\t\t\tcloseForkModal();\n\t\t});\n\t}\n\n\tfunction showPostsSelected() {\n\t\tif (postSelect.pids.length) {\n\t\t\tforkModal.find('#fork-pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\n\t\t} else {\n\t\t\tforkModal.find('#fork-pids').translateHtml('[[topic:fork_no_pids]]');\n\t\t}\n\t}\n\n\tfunction checkForkButtonEnable() {\n\t\tif (forkModal.find('#fork-title').val().length && postSelect.pids.length) {\n\t\t\tforkCommit.removeAttr('disabled');\n\t\t} else {\n\t\t\tforkCommit.attr('disabled', true);\n\t\t}\n\t}\n\n\tfunction closeForkModal() {\n\t\tif (forkModal) {\n\t\t\tforkModal.remove();\n\t\t\tforkModal = null;\n\t\t\tpostSelect.disable();\n\t\t}\n\t}\n\n\treturn Fork;\n});\n"]}