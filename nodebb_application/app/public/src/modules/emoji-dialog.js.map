{"version":3,"sources":["node_modules/nodebb-plugin-emoji/build/public/lib/emoji-dialog.js"],"names":["define","require","exports","translator_1","benchpress_1","controls_1","scrollStop_1","emoji_1","Object","defineProperty","value","$html","$","dialogActions","open","dialog","addClass","find","focus","close","removeClass","priorities","people","nature","food","activity","travel","objects","symbols","flags","regional","modifier","other","window","config","emojiCustomFirst","custom","translator","Translator","create","stringCompare","a","b","init","callback","Promise","all","getJSON","base","buster","resolve","then","_a","categoriesInfo","packs","categories","keys","map","category","emojis","name","table","emoji","html","buildEmoji","sort","aPriority","bPriority","render","result","translate","appendTo","on","e","target","next","tab","results","search","slice","join","tabContent","showDeferred","container","rect","getBoundingClientRect","num","Math","ceil","width","height","filter","i","elem","elemRect","right","left","bottom","top","each","src","getAttribute","setAttribute","firstTab","click","preventDefault","eq","setTimeout","trigger","apply","document","is","draggable","handle","catch","err","console","error","toggle","opener","onClick","after","hasClass","off","currentTarget","buttonRect","innerHeight","innerWidth","position","css","length","toggleForInsert","textarea","selectStart","selectEnd","event","button","parents","text","selectionStart","selectionEnd","end","start","insertIntoTextarea","updateTextareaSelection"],"mappings":"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","file":"node_modules/nodebb-plugin-emoji/build/public/lib/emoji-dialog.js","sourcesContent":["// eslint-disable-next-line spaced-comment\n/// <amd-module name=\"emoji-dialog\"/>\ndefine(\"emoji-dialog\", [\"require\", \"exports\", \"translator\", \"benchpress\", \"composer/controls\", \"scrollStop\", \"emoji\"], function (require, exports, translator_1, benchpress_1, controls_1, scrollStop_1, emoji_1) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    var $html = $('html');\n    exports.dialogActions = {\n        open: function (dialog) {\n            $html.addClass('emoji-insert');\n            dialog.addClass('open');\n            dialog.find('.emoji-dialog-search').focus();\n            return dialog;\n        },\n        close: function (dialog) {\n            $html.removeClass('emoji-insert');\n            return dialog.removeClass('open');\n        },\n    };\n    var priorities = {\n        people: 10,\n        nature: 9,\n        food: 8,\n        activity: 7,\n        travel: 6,\n        objects: 5,\n        symbols: 4,\n        flags: 3,\n        regional: 2,\n        modifier: 1,\n        other: 0,\n    };\n    if (window.config.emojiCustomFirst) {\n        priorities.custom = 100;\n    }\n    var translator = translator_1.Translator.create();\n    function stringCompare(a, b) {\n        if (a < b) {\n            return -1;\n        }\n        if (a > b) {\n            return 1;\n        }\n        return 0;\n    }\n    // create modal\n    function init(callback) {\n        Promise.all([\n            $.getJSON(emoji_1.base + \"/emoji/categories.json?\" + emoji_1.buster),\n            $.getJSON(emoji_1.base + \"/emoji/packs.json?\" + emoji_1.buster),\n            new Promise(function (resolve) { return emoji_1.init(resolve); }),\n        ])\n            .then(function (_a) {\n            var categoriesInfo = _a[0], packs = _a[1];\n            var categories = Object.keys(categoriesInfo).map(function (category) {\n                var emojis = categoriesInfo[category].map(function (name) { return emoji_1.table[name]; });\n                return {\n                    name: category,\n                    emojis: emojis.map(function (emoji) { return ({\n                        name: emoji.name,\n                        html: emoji_1.buildEmoji(emoji, true),\n                    }); }).sort(function (a, b) { return stringCompare(a.name, b.name); }),\n                };\n            }).sort(function (a, b) {\n                var aPriority = priorities[a.name] || 0;\n                var bPriority = priorities[b.name] || 0;\n                return bPriority - aPriority;\n            });\n            return benchpress_1.render('partials/emoji-dialog', {\n                categories: categories,\n                packs: packs,\n            });\n        })\n            .then(function (result) { return translator.translate(result); }).then(function (html) {\n            var dialog = $(html).appendTo('body');\n            dialog.find('.emoji-dialog-search').on('input', function (e) {\n                var value = e.target.value;\n                if (!value) {\n                    dialog.find('.emoji-dialog-search-results').addClass('hidden');\n                    dialog.find('.nav-tabs .emoji-dialog-search-results').next().find('a').tab('show');\n                    return;\n                }\n                var results = emoji_1.search(value)\n                    .slice(0, 100)\n                    .map(function (emoji) { return \"<a class=\\\"emoji-link\\\" name=\\\"\" + emoji.name + \"\\\" href=\\\"#\\\">\" + emoji_1.buildEmoji(emoji, false) + \"</a>\"; })\n                    .join('\\n');\n                dialog.find('.tab-pane.emoji-dialog-search-results').html(results);\n                dialog.find('.emoji-dialog-search-results').removeClass('hidden');\n                dialog.find('.nav-tabs .emoji-dialog-search-results a').tab('show');\n            });\n            var tabContent = dialog.find('.emoji-tabs .tab-content');\n            function showDeferred(container) {\n                var rect = tabContent[0].getBoundingClientRect();\n                var num = Math.ceil((rect.width * rect.height) / (40 * 40));\n                container\n                    .find('.emoji-link img.defer')\n                    .filter(function (i, elem) {\n                    if (i <= num) {\n                        return true;\n                    }\n                    var elemRect = elem.getBoundingClientRect();\n                    return elemRect.right > rect.left &&\n                        elemRect.left < rect.right &&\n                        elemRect.bottom > rect.top &&\n                        elemRect.top < rect.bottom;\n                })\n                    .removeClass('defer')\n                    .each(function (i, elem) {\n                    var src = elem.getAttribute('data-src');\n                    elem.setAttribute('src', src);\n                });\n            }\n            var firstTab = dialog.find('.emoji-tabs .nav-tabs a').click(function (e) {\n                e.preventDefault();\n                $(e.target).tab('show');\n            }).on('show.bs.tab', function (e) {\n                showDeferred($(e.target.getAttribute('href')));\n            }).eq(1);\n            setTimeout(function () { return firstTab.trigger('show.bs.tab'); }, 10);\n            tabContent.on('scroll', function () {\n                showDeferred(tabContent.find('.tab-pane.active'));\n            });\n            scrollStop_1.apply(tabContent[0]);\n            var close = function () { return exports.dialogActions.close(dialog); };\n            $(window).on([\n                'action:composer.discard',\n                'action:composer.submit',\n                'action:composer.minimize',\n                'action:chat.minimize',\n                'action:chat.closed',\n            ].join(' '), close);\n            dialog.find('.close').click(close);\n            $(document).on('click', function (e) {\n                if (!$(e.target).is('.emoji-dialog *')) {\n                    close();\n                }\n            });\n            if (dialog.draggable) {\n                dialog.draggable({\n                    handle: '.top-bar',\n                });\n            }\n            callback(dialog);\n        })\n            .catch(function (err) {\n            console.error('Failed to initialize emoji dialog', err);\n        });\n    }\n    exports.init = init;\n    function toggle(opener, onClick) {\n        function after(dialog) {\n            if (dialog.hasClass('open')) {\n                exports.dialogActions.close(dialog);\n                return;\n            }\n            dialog.off('click').on('click', '.emoji-link', function (e) {\n                e.preventDefault();\n                var name = e.currentTarget.name;\n                onClick(e, name, dialog);\n            });\n            // default if there's no button\n            var buttonRect = opener ? opener.getBoundingClientRect() : {\n                top: window.innerHeight / 3,\n                left: window.innerWidth / 3,\n            };\n            var position = {\n                bottom: 'auto',\n                top: 'auto',\n                right: 'auto',\n                left: 'auto',\n            };\n            if (buttonRect.top > 440) {\n                position.top = buttonRect.top - 400 + \"px\";\n            }\n            else {\n                position.top = buttonRect.top + 40 + \"px\";\n            }\n            if (buttonRect.left < window.innerWidth / 2) {\n                position.left = buttonRect.left + 40 + \"px\";\n            }\n            else {\n                position.left = buttonRect.left - 400 + \"px\";\n            }\n            dialog.css(position);\n            exports.dialogActions.open(dialog);\n        }\n        var dialog = $('#emoji-dialog');\n        if (dialog.length) {\n            after(dialog);\n        }\n        else {\n            init(after);\n        }\n    }\n    exports.toggle = toggle;\n    function toggleForInsert(textarea, selectStart, selectEnd, event) {\n        // handle new and old API case\n        var button;\n        if (event && event.target) {\n            button = $(event.target);\n        }\n        else {\n            button = $(textarea).parents('.composer-container').find('[data-format=\"emoji-add-emoji\"]');\n        }\n        button = button[0];\n        toggle(button, function (e, name) {\n            var text = \":\" + name + \": \";\n            var selectionStart = textarea.selectionStart, selectionEnd = textarea.selectionEnd;\n            var end = selectionEnd + text.length;\n            var start = selectionStart === selectionEnd ? end : selectionStart;\n            controls_1.insertIntoTextarea(textarea, text);\n            controls_1.updateTextareaSelection(textarea, start, end);\n            $(textarea).trigger('input');\n        });\n    }\n    exports.toggleForInsert = toggleForInsert;\n});\n//# sourceMappingURL=emoji-dialog.js.map"]}