{"version":3,"sources":["public/src/modules/flags.js"],"names":["define","Flag","flagModal","flagCommit","flagReason","showFlagModal","data","app","parseAndTranslate","html","$","on","remove","find","reportText","this","text","val","length","createFlag","type","id","bootbox","confirm","title","message","callback","result","prop","focus","modal","window","trigger","modalEl","checkFlagButtonEnable","reason","socket","emit","err","alertError","alertSuccess","removeAttr","attr"],"mappings":"AAAA,aAGAA,OAAO,QAAS,WACf,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJH,EAAKI,cAAgB,SAAUC,GAC9BC,IAAIC,kBAAkB,6BAA8BF,EAAM,SAAUG,GACnEP,EAAYQ,EAAED,GAEdP,EAAUS,GAAG,kBAAmB,WAC/BT,EAAUU,WAGXT,EAAaD,EAAUW,KAAK,qBAC5BT,EAAaF,EAAUW,KAAK,uBAG5BX,EAAUS,GAAG,QAAS,eAAgB,WACrC,IAAIG,EAAaJ,EAAEK,MAAMC,OAEzB,GAAIZ,EAAWa,MAAMC,SAAW,EAAG,CAClC,OAAOC,EAAWb,EAAKc,KAAMd,EAAKe,GAAIP,GAIvCQ,QAAQC,SACPC,MAAO,iCACPC,QAAS,+GACTC,SAAU,SAAUC,GACnB,GAAIA,EAAQ,CACXR,EAAWb,EAAKc,KAAMd,EAAKe,GAAIP,SAOnCX,EAAWQ,GAAG,QAAS,WACtBQ,EAAWb,EAAKc,KAAMd,EAAKe,GAAInB,EAAUW,KAAK,uBAAuBI,SAGtEf,EAAUS,GAAG,QAAS,iBAAkB,WACvCP,EAAWwB,KAAK,WAAY,OAC5BxB,EAAWyB,UAGZ3B,EAAU4B,MAAM,QAChBpB,EAAEqB,QAAQC,QAAQ,yBACjBC,QAAS/B,EACTkB,KAAMd,EAAKc,KACXC,GAAIf,EAAKe,KAGVnB,EAAUW,KAAK,uBAAuBF,GAAG,oBAAqBuB,MAIhE,SAASf,EAAWC,EAAMC,EAAIc,GAC7B,IAAKf,IAASC,IAAOc,EAAQ,CAC5B,OAEDC,OAAOC,KAAK,gBAAkBjB,KAAMA,EAAMC,GAAIA,EAAIc,OAAQA,GAAU,SAAUG,GAC7E,GAAIA,EAAK,CACR,OAAO/B,IAAIgC,WAAWD,EAAIb,SAG3BvB,EAAU4B,MAAM,QAChBvB,IAAIiC,aAAa,oCAInB,SAASN,IACR,GAAIhC,EAAUW,KAAK,uBAAuBI,MAAO,CAChDd,EAAWsC,WAAW,gBAChB,CACNtC,EAAWuC,KAAK,WAAY,OAI9B,OAAOzC","file":"public/src/modules/flags.js","sourcesContent":["'use strict';\n\n\ndefine('flags', function () {\n\tvar Flag = {};\n\tvar flagModal;\n\tvar flagCommit;\n\tvar flagReason;\n\n\tFlag.showFlagModal = function (data) {\n\t\tapp.parseAndTranslate('partials/modals/flag_modal', data, function (html) {\n\t\t\tflagModal = $(html);\n\n\t\t\tflagModal.on('hidden.bs.modal', function () {\n\t\t\t\tflagModal.remove();\n\t\t\t});\n\n\t\t\tflagCommit = flagModal.find('#flag-post-commit');\n\t\t\tflagReason = flagModal.find('#flag-reason-custom');\n\n\t\t\t// Quick-report buttons\n\t\t\tflagModal.on('click', '.flag-reason', function () {\n\t\t\t\tvar reportText = $(this).text();\n\n\t\t\t\tif (flagReason.val().length === 0) {\n\t\t\t\t\treturn createFlag(data.type, data.id, reportText);\n\t\t\t\t}\n\n\t\t\t\t// Custom reason has text, confirm submission\n\t\t\t\tbootbox.confirm({\n\t\t\t\t\ttitle: '[[flags:modal-submit-confirm]]',\n\t\t\t\t\tmessage: '<p>[[flags:modal-submit-confirm-text]]</p><p class=\"help-block\">[[flags:modal-submit-confirm-text-help]]</p>',\n\t\t\t\t\tcallback: function (result) {\n\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\tcreateFlag(data.type, data.id, reportText);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Custom reason report submission\n\t\t\tflagCommit.on('click', function () {\n\t\t\t\tcreateFlag(data.type, data.id, flagModal.find('#flag-reason-custom').val());\n\t\t\t});\n\n\t\t\tflagModal.on('click', '.toggle-custom', function () {\n\t\t\t\tflagReason.prop('disabled', false);\n\t\t\t\tflagReason.focus();\n\t\t\t});\n\n\t\t\tflagModal.modal('show');\n\t\t\t$(window).trigger('action:flag.showModal', {\n\t\t\t\tmodalEl: flagModal,\n\t\t\t\ttype: data.type,\n\t\t\t\tid: data.id,\n\t\t\t});\n\n\t\t\tflagModal.find('#flag-reason-custom').on('keyup blur change', checkFlagButtonEnable);\n\t\t});\n\t};\n\n\tfunction createFlag(type, id, reason) {\n\t\tif (!type || !id || !reason) {\n\t\t\treturn;\n\t\t}\n\t\tsocket.emit('flags.create', { type: type, id: id, reason: reason }, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tflagModal.modal('hide');\n\t\t\tapp.alertSuccess('[[flags:modal-submit-success]]');\n\t\t});\n\t}\n\n\tfunction checkFlagButtonEnable() {\n\t\tif (flagModal.find('#flag-reason-custom').val()) {\n\t\t\tflagCommit.removeAttr('disabled');\n\t\t} else {\n\t\t\tflagCommit.attr('disabled', true);\n\t\t}\n\t}\n\n\treturn Flag;\n});\n"]}