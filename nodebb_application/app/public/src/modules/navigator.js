"use strict";define("navigator",["forum/pagination","components"],function(t,o){var e={};var n=1;var a=0;var i;var r;var l;var c;var s;var f;var d=false;var u=true;e.scrollActive=false;var p=$(".pagination-block");var h=p.find(".pagination-text");var g=p.find("meter");var v=p.find(".progress-bar");$(window).on("action:ajaxify.start",function(){$(window).off("keydown",x)});e.init=function(t,o,a,i,f){n=1;e.selector=t;e.callback=f;e.toTop=a||function(){};e.toBottom=i||function(){};p=$(".pagination-block");h=p.find(".pagination-text");g=p.find("meter");v=p.find(".progress-bar");$(window).off("scroll",e.delayedUpdate).on("scroll",e.delayedUpdate);p.find(".dropdown-menu").off("click").on("click",function(t){t.stopPropagation()});p.off("shown.bs.dropdown",".dropdown").on("shown.bs.dropdown",".dropdown",function(){setTimeout(function(){$(".pagination-block input").focus()},100)});p.find(".pageup").off("click").on("click",e.scrollUp);p.find(".pagedown").off("click").on("click",e.scrollDown);p.find(".pagetop").off("click").on("click",e.toTop);p.find(".pagebottom").off("click").on("click",e.toBottom);p.find("input").on("keydown",function(t){if(t.which===13){var o=$(this);if(!utils.isNumber(o.val())){o.val("");return}var e=parseInt(o.val(),10);var n=T(e);o.val("");$(".pagination-block .dropdown-toggle").trigger("click");ajaxify.go(n)}});$(".pagination-block.visible-xs").on("touchstart",function(t){r=$(".navigator-thumb");c=Math.min($(window).width(),Math.max(0,t.touches[0].clientX));s=Math.min($(window).height(),Math.max(0,t.touches[0].clientY));u=true}).on("touchmove",function(t){var a=$(window).width();var i=$(window).height();var f=Math.abs(c-Math.min(a,Math.max(0,t.touches[0].clientX)));var p=Math.abs(s-Math.min(i,Math.max(0,t.touches[0].clientY)));c=Math.min(a,Math.max(0,t.touches[0].clientX));s=Math.min(i,Math.max(0,t.touches[0].clientY));if(f>=p&&u){d=true;l=setInterval(m,100)}if(d){t.preventDefault();t.stopPropagation();var h=c/a;n=Math.max(1,Math.ceil(o*h));n=n>o?o:n;if(u){m(function(){r.removeClass("hidden")})}e.updateTextAndProgressBar()}u=false}).on("touchend",function(){if(l){clearInterval(l);l=0}if(d){r.addClass("hidden");e.scrollToIndex(n-1,true,0);d=false}});w();e.setCount(o);e.update(0)};function m(t){t=t||function(){};if(f===n){return}f=n;r.css({left:Math.min($(window).width()-r.outerWidth(),Math.max(c-r.outerWidth()/2,0))});socket.emit("posts.getTimestampByIndex",{tid:ajaxify.data.tid,index:n-1},function(o,e){if(o){return app.alertError(o.message)}var i=new Date(e);var l=i.toLocaleString(config.userLang,{month:"long"});r.find(".text").translateText("[[global:pagination.out_of, "+n+", "+a+"]]");if(e>Date.now()-30*24*60*60*1e3){r.find(".time").text(l+" "+i.getDate())}else{r.find(".time").text(l+" "+i.getFullYear())}t()})}function w(){if(!config.usePagination){$(window).off("keydown",x).on("keydown",x)}}function x(t){if(t.target.nodeName==="BODY"){if(t.shiftKey||t.ctrlKey||t.altKey){return}if(t.which===36&&e.toTop){e.toTop();return false}else if(t.which===35&&e.toBottom){e.toBottom();return false}}}function T(t){var o=window.location.pathname.replace(config.relative_path,"");var e=o.split("/");return e[1]+"/"+e[2]+"/"+e[3]+(t?"/"+t:"")}e.setCount=function(t){a=parseInt(t,10);e.updateTextAndProgressBar()};e.show=function(){b(true)};e.disable=function(){a=0;n=1;e.callback=null;e.selector=null;$(window).off("scroll",e.delayedUpdate);b(false)};function b(t){var o=ajaxify.removeRelativePath(window.location.pathname.slice(1));if(t&&(!o.startsWith("topic")&&!o.startsWith("category"))){return}p.toggleClass("ready",t)}e.delayedUpdate=function(){if(!i){i=setTimeout(function(){e.update();i=undefined},100)}};e.update=function(t){t=typeof t==="number"?t:undefined;var i=$(e.selector);if(i.length){n=parseInt(i.first().attr("data-index"),10)+1}var r=$(window).scrollTop();var l=$(window).height();var c=$(document).height();var s=r+l/2;var f=Number.MAX_VALUE;i.each(function(){var t=Math.abs(s-$(this).offset().top);if(t>f){return false}if(t<f){n=parseInt($(this).attr("data-index"),10)+1;f=t}});var d=r===0&&parseInt(i.first().attr("data-index"),10)===0;var u=r+l>c-100&&parseInt(i.last().attr("data-index"),10)===a-1;if(d){n=1}else if(u){n=a}if(t===undefined&&ajaxify.data.template.topic===true){if(d){t=0}else{var p=o.get("post/anchor",n-1);if(p.length){var h=p.get(0).getBoundingClientRect();t=h.top}}}if(typeof e.callback==="function"){e.callback(n,a,t)}e.updateTextAndProgressBar();b(!!a)};e.updateTextAndProgressBar=function(){if(!utils.isNumber(n)){return}n=n>a?a:n;h.translateHtml("[[global:pagination.out_of, "+n+", "+a+"]]");var t=(n-1)/(a-1||1);g.val(t);v.width(t*100+"%")};e.scrollUp=function(){var o=$(window);if(config.usePagination){var e=o.scrollTop()<=0;if(e){return t.previousPage(function(){$("body,html").scrollTop($(document).height()-o.height())})}}$("body,html").animate({scrollTop:o.scrollTop()-o.height()})};e.scrollDown=function(){var o=$(window);if(config.usePagination){var e=o.scrollTop()>=$(document).height()-o.height();if(e){return t.nextPage()}}$("body,html").animate({scrollTop:o.scrollTop()+o.height()})};e.scrollTop=function(t){if($(e.selector+'[data-index="'+t+'"]').length){e.scrollToIndex(t,true)}else{ajaxify.go(T())}};e.scrollBottom=function(t){if(parseInt(t,10)<0){return}if($(e.selector+'[data-index="'+t+'"]').length){e.scrollToIndex(t,true)}else{t=parseInt(t,10)+1;ajaxify.go(T(t))}};e.scrollToIndex=function(n,a,i){var r=!!o.get("topic").length;var l=!!o.get("category").length;if(!utils.isNumber(n)||!r&&!l){return}i=i!==undefined?i:400;e.scrollActive=true;if(r&&o.get("post/anchor",n).length){return e.scrollToPostIndex(n,a,i)}if(l&&$('[component="category/topic"][data-index="'+n+'"]').length){return e.scrollToTopicIndex(n,a,i)}if(!config.usePagination){e.scrollActive=false;n=parseInt(n,10)+1;ajaxify.go(T(n));return}var c=r?e.scrollToPostIndex:e.scrollToTopicIndex;var s=1+Math.floor(n/config.postsPerPage);if(parseInt(s,10)!==ajaxify.data.pagination.currentPage){t.loadPage(s,function(){c(n,a,i)})}else{c(n,a,i)}};e.scrollToPostIndex=function(t,n,a){var i=o.get("post","index",t);e.scrollToElement(i,n,a)};e.scrollToTopicIndex=function(t,o,n){var a=$('[component="category/topic"][data-index="'+t+'"]');e.scrollToElement(a,o,n)};e.scrollToElement=function(t,n,a){if(!t.length){e.scrollActive=false;return}var i=t.height();var r=$(window).height();var l=o.get("navbar").height();$(window).off("scroll",e.update);a=a!==undefined?a:400;e.scrollActive=true;var c=false;function s(){function o(){if(c){$(window).on("scroll",e.update);var o=t.get(0).getBoundingClientRect();e.update(o.top);return}c=true;e.scrollActive=false;f();$("body").scrollTop($("body").scrollTop()-1);$("html").scrollTop($("html").scrollTop()-1)}var n=0;if(i<r){n=t.offset().top-r/2+i/2}else{n=t.offset().top-l}if(a===0){$(window).scrollTop(n);return o()}$("html, body").animate({scrollTop:n+"px"},a,o)}function f(){if(n){t.addClass("highlight");setTimeout(function(){t.removeClass("highlight")},1e4)}}s()};return e});
//# sourceMappingURL=navigator.js.map