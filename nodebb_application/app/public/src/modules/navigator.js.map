{"version":3,"sources":["public/src/modules/navigator.js"],"names":["define","pagination","components","navigator","index","count","navigatorUpdateTimeoutId","touchTooltipEl","touchIntervalId","touchX","touchY","touchIndex","isNavigating","firstMove","scrollActive","paginationBlockEl","$","paginationTextEl","find","paginationBlockMeterEl","paginationBlockProgressEl","window","on","off","onKeyDown","init","selector","toTop","toBottom","callback","delayedUpdate","e","stopPropagation","setTimeout","focus","scrollUp","scrollDown","which","input","this","utils","isNumber","val","parseInt","url","generateUrl","trigger","ajaxify","go","Math","min","width","max","touches","clientX","height","clientY","windowWidth","windowHeight","deltaX","abs","deltaY","setInterval","updateTooltip","preventDefault","percent","ceil","removeClass","updateTextAndProgressBar","clearInterval","addClass","scrollToIndex","handleKeys","setCount","update","css","left","outerWidth","socket","emit","tid","data","err","timestamp","app","alertError","message","date","Date","ds","toLocaleString","config","userLang","month","translateText","now","text","getDate","getFullYear","usePagination","ev","target","nodeName","shiftKey","ctrlKey","altKey","pathname","location","replace","relative_path","parts","split","value","show","toggle","disable","flag","path","removeRelativePath","slice","startsWith","toggleClass","undefined","threshold","els","length","first","attr","scrollTop","documentHeight","document","middleOfViewport","previousDistance","Number","MAX_VALUE","each","distanceToMiddle","offset","top","atTop","nearBottom","last","template","topic","anchorEl","get","anchorRect","getBoundingClientRect","translateHtml","fraction","$window","previousPage","animate","atBottom","nextPage","scrollBottom","highlight","duration","inTopic","inCategory","scrollToPostIndex","scrollToTopicIndex","scrollMethod","page","floor","postsPerPage","currentPage","loadPage","postIndex","scrollTo","scrollToElement","topicIndex","postHeight","viewportHeight","navbarHeight","done","animateScroll","onAnimateComplete","scrollToRect","highlightPost"],"mappings":"AAAA,aAEAA,OAAO,aAAc,mBAAoB,cAAe,SAAUC,EAAYC,GAC7E,IAAIC,KACJ,IAAIC,EAAQ,EACZ,IAAIC,EAAQ,EACZ,IAAIC,EAEJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAAe,MACnB,IAAIC,EAAY,KAEhBV,EAAUW,aAAe,MAEzB,IAAIC,EAAoBC,EAAE,qBAC1B,IAAIC,EAAmBF,EAAkBG,KAAK,oBAC9C,IAAIC,EAAyBJ,EAAkBG,KAAK,SACpD,IAAIE,EAA4BL,EAAkBG,KAAK,iBAEvDF,EAAEK,QAAQC,GAAG,uBAAwB,WACpCN,EAAEK,QAAQE,IAAI,UAAWC,KAG1BrB,EAAUsB,KAAO,SAAUC,EAAUrB,EAAOsB,EAAOC,EAAUC,GAC5DzB,EAAQ,EACRD,EAAUuB,SAAWA,EACrBvB,EAAU0B,SAAWA,EACrB1B,EAAUwB,MAAQA,GAAS,aAC3BxB,EAAUyB,SAAWA,GAAY,aAEjCb,EAAoBC,EAAE,qBACtBC,EAAmBF,EAAkBG,KAAK,oBAC1CC,EAAyBJ,EAAkBG,KAAK,SAChDE,EAA4BL,EAAkBG,KAAK,iBAEnDF,EAAEK,QAAQE,IAAI,SAAUpB,EAAU2B,eAAeR,GAAG,SAAUnB,EAAU2B,eAExEf,EAAkBG,KAAK,kBAAkBK,IAAI,SAASD,GAAG,QAAS,SAAUS,GAC3EA,EAAEC,oBAGHjB,EAAkBQ,IAAI,oBAAqB,aAAaD,GAAG,oBAAqB,YAAa,WAC5FW,WAAW,WACVjB,EAAE,2BAA2BkB,SAC3B,OAEJnB,EAAkBG,KAAK,WAAWK,IAAI,SAASD,GAAG,QAASnB,EAAUgC,UACrEpB,EAAkBG,KAAK,aAAaK,IAAI,SAASD,GAAG,QAASnB,EAAUiC,YACvErB,EAAkBG,KAAK,YAAYK,IAAI,SAASD,GAAG,QAASnB,EAAUwB,OACtEZ,EAAkBG,KAAK,eAAeK,IAAI,SAASD,GAAG,QAASnB,EAAUyB,UAEzEb,EAAkBG,KAAK,SAASI,GAAG,UAAW,SAAUS,GACvD,GAAIA,EAAEM,QAAU,GAAI,CACnB,IAAIC,EAAQtB,EAAEuB,MACd,IAAKC,MAAMC,SAASH,EAAMI,OAAQ,CACjCJ,EAAMI,IAAI,IACV,OAGD,IAAItC,EAAQuC,SAASL,EAAMI,MAAO,IAClC,IAAIE,EAAMC,EAAYzC,GACtBkC,EAAMI,IAAI,IACV1B,EAAE,sCAAsC8B,QAAQ,SAChDC,QAAQC,GAAGJ,MAIb5B,EAAE,gCAAgCM,GAAG,aAAc,SAAUS,GAC5DxB,EAAiBS,EAAE,oBACnBP,EAASwC,KAAKC,IAAIlC,EAAEK,QAAQ8B,QAASF,KAAKG,IAAI,EAAGrB,EAAEsB,QAAQ,GAAGC,UAC9D5C,EAASuC,KAAKC,IAAIlC,EAAEK,QAAQkC,SAAUN,KAAKG,IAAI,EAAGrB,EAAEsB,QAAQ,GAAGG,UAC/D3C,EAAY,OACVS,GAAG,YAAa,SAAUS,GAC5B,IAAI0B,EAAczC,EAAEK,QAAQ8B,QAC5B,IAAIO,EAAe1C,EAAEK,QAAQkC,SAC7B,IAAII,EAASV,KAAKW,IAAInD,EAASwC,KAAKC,IAAIO,EAAaR,KAAKG,IAAI,EAAGrB,EAAEsB,QAAQ,GAAGC,WAC9E,IAAIO,EAASZ,KAAKW,IAAIlD,EAASuC,KAAKC,IAAIQ,EAAcT,KAAKG,IAAI,EAAGrB,EAAEsB,QAAQ,GAAGG,WAC/E/C,EAASwC,KAAKC,IAAIO,EAAaR,KAAKG,IAAI,EAAGrB,EAAEsB,QAAQ,GAAGC,UACxD5C,EAASuC,KAAKC,IAAIQ,EAAcT,KAAKG,IAAI,EAAGrB,EAAEsB,QAAQ,GAAGG,UACzD,GAAIG,GAAUE,GAAUhD,EAAW,CAClCD,EAAe,KACfJ,EAAkBsD,YAAYC,EAAe,KAE9C,GAAInD,EAAc,CACjBmB,EAAEiC,iBACFjC,EAAEC,kBACF,IAAIiC,EAAUxD,EAASgD,EACvBrD,EAAQ6C,KAAKG,IAAI,EAAGH,KAAKiB,KAAK7D,EAAQ4D,IACtC7D,EAAQA,EAAQC,EAAQA,EAAQD,EAChC,GAAIS,EAAW,CACdkD,EAAc,WACbxD,EAAe4D,YAAY,YAG7BhE,EAAUiE,2BAEXvD,EAAY,QACVS,GAAG,WAAY,WACjB,GAAId,EAAiB,CACpB6D,cAAc7D,GACdA,EAAkB,EAGnB,GAAII,EAAc,CACjBL,EAAe+D,SAAS,UACxBnE,EAAUoE,cAAcnE,EAAQ,EAAG,KAAM,GACzCQ,EAAe,SAIjB4D,IAEArE,EAAUsE,SAASpE,GACnBF,EAAUuE,OAAO,IAGlB,SAASX,EAAclC,GACtBA,EAAWA,GAAY,aACvB,GAAIlB,IAAeP,EAAO,CACzB,OAEDO,EAAaP,EACbG,EAAeoE,KAAMC,KAAM3B,KAAKC,IAAIlC,EAAEK,QAAQ8B,QAAU5C,EAAesE,aAAc5B,KAAKG,IAAI3C,EAAUF,EAAesE,aAAe,EAAI,MAE1IC,OAAOC,KAAK,6BAA+BC,IAAKjC,QAAQkC,KAAKD,IAAK5E,MAAOA,EAAQ,GAAK,SAAU8E,EAAKC,GACpG,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3B,IAAIC,EAAO,IAAIC,KAAKL,GACpB,IAAIM,EAAKF,EAAKG,eAAeC,OAAOC,UAAYC,MAAO,SACvDtF,EAAeW,KAAK,SAAS4E,cAAc,+BAAiC1F,EAAQ,KAAOC,EAAQ,MACnG,GAAI8E,EAAYK,KAAKO,MAAS,GAAK,GAAK,GAAK,GAAK,IAAO,CACxDxF,EAAeW,KAAK,SAAS8E,KAAKP,EAAK,IAAMF,EAAKU,eAC5C,CACN1F,EAAeW,KAAK,SAAS8E,KAAKP,EAAK,IAAMF,EAAKW,eAEnDrE,MAIF,SAAS2C,IACR,IAAKmB,OAAOQ,cAAe,CAC1BnF,EAAEK,QAAQE,IAAI,UAAWC,GAAWF,GAAG,UAAWE,IAIpD,SAASA,EAAU4E,GAClB,GAAIA,EAAGC,OAAOC,WAAa,OAAQ,CAClC,GAAIF,EAAGG,UAAYH,EAAGI,SAAWJ,EAAGK,OAAQ,CAC3C,OAED,GAAIL,EAAG/D,QAAU,IAAMlC,EAAUwB,MAAO,CACvCxB,EAAUwB,QACV,OAAO,WACD,GAAIyE,EAAG/D,QAAU,IAAMlC,EAAUyB,SAAU,CACjDzB,EAAUyB,WACV,OAAO,QAKV,SAASiB,EAAYzC,GACpB,IAAIsG,EAAWrF,OAAOsF,SAASD,SAASE,QAAQjB,OAAOkB,cAAe,IACtE,IAAIC,EAAQJ,EAASK,MAAM,KAC3B,OAAOD,EAAM,GAAK,IAAMA,EAAM,GAAK,IAAMA,EAAM,IAAM1G,EAAQ,IAAMA,EAAQ,IAG5ED,EAAUsE,SAAW,SAAUuC,GAC9B3G,EAAQsC,SAASqE,EAAO,IACxB7G,EAAUiE,4BAGXjE,EAAU8G,KAAO,WAChBC,EAAO,OAGR/G,EAAUgH,QAAU,WACnB9G,EAAQ,EACRD,EAAQ,EACRD,EAAU0B,SAAW,KACrB1B,EAAUuB,SAAW,KACrBV,EAAEK,QAAQE,IAAI,SAAUpB,EAAU2B,eAElCoF,EAAO,QAGR,SAASA,EAAOE,GACf,IAAIC,EAAOtE,QAAQuE,mBAAmBjG,OAAOsF,SAASD,SAASa,MAAM,IACrE,GAAIH,KAAUC,EAAKG,WAAW,WAAaH,EAAKG,WAAW,aAAc,CACxE,OAGDzG,EAAkB0G,YAAY,QAASL,GAGxCjH,EAAU2B,cAAgB,WACzB,IAAKxB,EAA0B,CAC9BA,EAA2B2B,WAAW,WACrC9B,EAAUuE,SACVpE,EAA2BoH,WACzB,OAILvH,EAAUuE,OAAS,SAAUiD,GAK5BA,SAAmBA,IAAc,SAAWA,EAAYD,UAExD,IAAIE,EAAM5G,EAAEb,EAAUuB,UACtB,GAAIkG,EAAIC,OAAQ,CACfzH,EAAQuC,SAASiF,EAAIE,QAAQC,KAAK,cAAe,IAAM,EAGxD,IAAIC,EAAYhH,EAAEK,QAAQ2G,YAC1B,IAAItE,EAAe1C,EAAEK,QAAQkC,SAC7B,IAAI0E,EAAiBjH,EAAEkH,UAAU3E,SACjC,IAAI4E,EAAmBH,EAAatE,EAAe,EACnD,IAAI0E,EAAmBC,OAAOC,UAC9BV,EAAIW,KAAK,WACR,IAAIC,EAAmBvF,KAAKW,IAAIuE,EAAmBnH,EAAEuB,MAAMkG,SAASC,KAEpE,GAAIF,EAAmBJ,EAAkB,CACxC,OAAO,MAGR,GAAII,EAAmBJ,EAAkB,CACxChI,EAAQuC,SAAS3B,EAAEuB,MAAMwF,KAAK,cAAe,IAAM,EACnDK,EAAmBI,KAIrB,IAAIG,EAAQX,IAAc,GAAKrF,SAASiF,EAAIE,QAAQC,KAAK,cAAe,MAAQ,EAChF,IAAIa,EAAaZ,EAAYtE,EAAeuE,EAAiB,KAAOtF,SAASiF,EAAIiB,OAAOd,KAAK,cAAe,MAAQ1H,EAAQ,EAE5H,GAAIsI,EAAO,CACVvI,EAAQ,OACF,GAAIwI,EAAY,CACtBxI,EAAQC,EAIT,GAAIsH,IAAcD,WAAa3E,QAAQkC,KAAK6D,SAASC,QAAU,KAAM,CACpE,GAAIJ,EAAO,CACVhB,EAAY,MACN,CACN,IAAIqB,EAAW9I,EAAW+I,IAAI,cAAe7I,EAAQ,GACrD,GAAI4I,EAASnB,OAAQ,CACpB,IAAIqB,EAAaF,EAASC,IAAI,GAAGE,wBACjCxB,EAAYuB,EAAWR,MAK1B,UAAWvI,EAAU0B,WAAa,WAAY,CAC7C1B,EAAU0B,SAASzB,EAAOC,EAAOsH,GAGlCxH,EAAUiE,2BACV8C,IAAS7G,IAGVF,EAAUiE,yBAA2B,WACpC,IAAK5B,MAAMC,SAASrC,GAAQ,CAC3B,OAEDA,EAAQA,EAAQC,EAAQA,EAAQD,EAChCa,EAAiBmI,cAAc,+BAAiChJ,EAAQ,KAAOC,EAAQ,MACvF,IAAIgJ,GAAYjJ,EAAQ,IAAMC,EAAQ,GAAK,GAC3Cc,EAAuBuB,IAAI2G,GAC3BjI,EAA0B+B,MAAOkG,EAAW,IAAO,MAGpDlJ,EAAUgC,SAAW,WACpB,IAAImH,EAAUtI,EAAEK,QAEhB,GAAIsE,OAAOQ,cAAe,CACzB,IAAIwC,EAAQW,EAAQtB,aAAe,EACnC,GAAIW,EAAO,CACV,OAAO1I,EAAWsJ,aAAa,WAC9BvI,EAAE,aAAagH,UAAUhH,EAAEkH,UAAU3E,SAAW+F,EAAQ/F,aAI3DvC,EAAE,aAAawI,SACdxB,UAAWsB,EAAQtB,YAAcsB,EAAQ/F,YAI3CpD,EAAUiC,WAAa,WACtB,IAAIkH,EAAUtI,EAAEK,QAEhB,GAAIsE,OAAOQ,cAAe,CACzB,IAAIsD,EAAWH,EAAQtB,aAAehH,EAAEkH,UAAU3E,SAAW+F,EAAQ/F,SACrE,GAAIkG,EAAU,CACb,OAAOxJ,EAAWyJ,YAGpB1I,EAAE,aAAawI,SACdxB,UAAWsB,EAAQtB,YAAcsB,EAAQ/F,YAI3CpD,EAAU6H,UAAY,SAAU5H,GAC/B,GAAIY,EAAEb,EAAUuB,SAAW,gBAAkBtB,EAAQ,MAAMyH,OAAQ,CAClE1H,EAAUoE,cAAcnE,EAAO,UACzB,CACN2C,QAAQC,GAAGH,OAIb1C,EAAUwJ,aAAe,SAAUvJ,GAClC,GAAIuC,SAASvC,EAAO,IAAM,EAAG,CAC5B,OAGD,GAAIY,EAAEb,EAAUuB,SAAW,gBAAkBtB,EAAQ,MAAMyH,OAAQ,CAClE1H,EAAUoE,cAAcnE,EAAO,UACzB,CACNA,EAAQuC,SAASvC,EAAO,IAAM,EAC9B2C,QAAQC,GAAGH,EAAYzC,MAIzBD,EAAUoE,cAAgB,SAAUnE,EAAOwJ,EAAWC,GACrD,IAAIC,IAAY5J,EAAW+I,IAAI,SAASpB,OACxC,IAAIkC,IAAe7J,EAAW+I,IAAI,YAAYpB,OAE9C,IAAKrF,MAAMC,SAASrC,KAAY0J,IAAYC,EAAa,CACxD,OAGDF,EAAWA,IAAanC,UAAYmC,EAAW,IAC/C1J,EAAUW,aAAe,KAGzB,GAAIgJ,GAAW5J,EAAW+I,IAAI,cAAe7I,GAAOyH,OAAQ,CAC3D,OAAO1H,EAAU6J,kBAAkB5J,EAAOwJ,EAAWC,GAItD,GAAIE,GAAc/I,EAAE,4CAA8CZ,EAAQ,MAAMyH,OAAQ,CACvF,OAAO1H,EAAU8J,mBAAmB7J,EAAOwJ,EAAWC,GAGvD,IAAKlE,OAAOQ,cAAe,CAC1BhG,EAAUW,aAAe,MACzBV,EAAQuC,SAASvC,EAAO,IAAM,EAC9B2C,QAAQC,GAAGH,EAAYzC,IACvB,OAGD,IAAI8J,EAAeJ,EAAU3J,EAAU6J,kBAAoB7J,EAAU8J,mBAErE,IAAIE,EAAO,EAAIlH,KAAKmH,MAAMhK,EAAQuF,OAAO0E,cACzC,GAAI1H,SAASwH,EAAM,MAAQpH,QAAQkC,KAAKhF,WAAWqK,YAAa,CAC/DrK,EAAWsK,SAASJ,EAAM,WACzBD,EAAa9J,EAAOwJ,EAAWC,SAE1B,CACNK,EAAa9J,EAAOwJ,EAAWC,KAIjC1J,EAAU6J,kBAAoB,SAAUQ,EAAWZ,EAAWC,GAC7D,IAAIY,EAAWvK,EAAW+I,IAAI,OAAQ,QAASuB,GAC/CrK,EAAUuK,gBAAgBD,EAAUb,EAAWC,IAGhD1J,EAAU8J,mBAAqB,SAAUU,EAAYf,EAAWC,GAC/D,IAAIY,EAAWzJ,EAAE,4CAA8C2J,EAAa,MAC5ExK,EAAUuK,gBAAgBD,EAAUb,EAAWC,IAGhD1J,EAAUuK,gBAAkB,SAAUD,EAAUb,EAAWC,GAC1D,IAAKY,EAAS5C,OAAQ,CACrB1H,EAAUW,aAAe,MACzB,OAED,IAAI8J,EAAaH,EAASlH,SAC1B,IAAIsH,EAAiB7J,EAAEK,QAAQkC,SAC/B,IAAIuH,EAAe5K,EAAW+I,IAAI,UAAU1F,SAG5CvC,EAAEK,QAAQE,IAAI,SAAUpB,EAAUuE,QAElCmF,EAAWA,IAAanC,UAAYmC,EAAW,IAC/C1J,EAAUW,aAAe,KACzB,IAAIiK,EAAO,MAEX,SAASC,IACR,SAASC,IACR,GAAIF,EAAM,CAET/J,EAAEK,QAAQC,GAAG,SAAUnB,EAAUuE,QACjC,IAAIwG,EAAeT,EAASxB,IAAI,GAAGE,wBACnChJ,EAAUuE,OAAOwG,EAAaxC,KAC9B,OAEDqC,EAAO,KAEP5K,EAAUW,aAAe,MACzBqK,IACAnK,EAAE,QAAQgH,UAAUhH,EAAE,QAAQgH,YAAc,GAC5ChH,EAAE,QAAQgH,UAAUhH,EAAE,QAAQgH,YAAc,GAG7C,IAAIA,EAAY,EAChB,GAAI4C,EAAaC,EAAgB,CAChC7C,EAAayC,EAAShC,SAASC,IAAOmC,EAAiB,EAAMD,EAAa,MACpE,CACN5C,EAAYyC,EAAShC,SAASC,IAAMoC,EAErC,GAAIjB,IAAa,EAAG,CACnB7I,EAAEK,QAAQ2G,UAAUA,GACpB,OAAOiD,IAERjK,EAAE,cAAcwI,SACfxB,UAAWA,EAAY,MACrB6B,EAAUoB,GAGd,SAASE,IACR,GAAIvB,EAAW,CACda,EAASnG,SAAS,aAClBrC,WAAW,WACVwI,EAAStG,YAAY,cACnB,MAIL6G,KAGD,OAAO7K","file":"public/src/modules/navigator.js","sourcesContent":["'use strict';\n\ndefine('navigator', ['forum/pagination', 'components'], function (pagination, components) {\n\tvar navigator = {};\n\tvar index = 1;\n\tvar count = 0;\n\tvar navigatorUpdateTimeoutId;\n\n\tvar touchTooltipEl;\n\tvar touchIntervalId;\n\tvar touchX;\n\tvar touchY;\n\tvar touchIndex;\n\tvar isNavigating = false;\n\tvar firstMove = true;\n\n\tnavigator.scrollActive = false;\n\n\tvar paginationBlockEl = $('.pagination-block');\n\tvar paginationTextEl = paginationBlockEl.find('.pagination-text');\n\tvar paginationBlockMeterEl = paginationBlockEl.find('meter');\n\tvar paginationBlockProgressEl = paginationBlockEl.find('.progress-bar');\n\n\t$(window).on('action:ajaxify.start', function () {\n\t\t$(window).off('keydown', onKeyDown);\n\t});\n\n\tnavigator.init = function (selector, count, toTop, toBottom, callback) {\n\t\tindex = 1;\n\t\tnavigator.selector = selector;\n\t\tnavigator.callback = callback;\n\t\tnavigator.toTop = toTop || function () {};\n\t\tnavigator.toBottom = toBottom || function () {};\n\n\t\tpaginationBlockEl = $('.pagination-block');\n\t\tpaginationTextEl = paginationBlockEl.find('.pagination-text');\n\t\tpaginationBlockMeterEl = paginationBlockEl.find('meter');\n\t\tpaginationBlockProgressEl = paginationBlockEl.find('.progress-bar');\n\n\t\t$(window).off('scroll', navigator.delayedUpdate).on('scroll', navigator.delayedUpdate);\n\n\t\tpaginationBlockEl.find('.dropdown-menu').off('click').on('click', function (e) {\n\t\t\te.stopPropagation();\n\t\t});\n\n\t\tpaginationBlockEl.off('shown.bs.dropdown', '.dropdown').on('shown.bs.dropdown', '.dropdown', function () {\n\t\t\tsetTimeout(function () {\n\t\t\t\t$('.pagination-block input').focus();\n\t\t\t}, 100);\n\t\t});\n\t\tpaginationBlockEl.find('.pageup').off('click').on('click', navigator.scrollUp);\n\t\tpaginationBlockEl.find('.pagedown').off('click').on('click', navigator.scrollDown);\n\t\tpaginationBlockEl.find('.pagetop').off('click').on('click', navigator.toTop);\n\t\tpaginationBlockEl.find('.pagebottom').off('click').on('click', navigator.toBottom);\n\n\t\tpaginationBlockEl.find('input').on('keydown', function (e) {\n\t\t\tif (e.which === 13) {\n\t\t\t\tvar input = $(this);\n\t\t\t\tif (!utils.isNumber(input.val())) {\n\t\t\t\t\tinput.val('');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar index = parseInt(input.val(), 10);\n\t\t\t\tvar url = generateUrl(index);\n\t\t\t\tinput.val('');\n\t\t\t\t$('.pagination-block .dropdown-toggle').trigger('click');\n\t\t\t\tajaxify.go(url);\n\t\t\t}\n\t\t});\n\n\t\t$('.pagination-block.visible-xs').on('touchstart', function (e) {\n\t\t\ttouchTooltipEl = $('.navigator-thumb');\n\t\t\ttouchX = Math.min($(window).width(), Math.max(0, e.touches[0].clientX));\n\t\t\ttouchY = Math.min($(window).height(), Math.max(0, e.touches[0].clientY));\n\t\t\tfirstMove = true;\n\t\t}).on('touchmove', function (e) {\n\t\t\tvar windowWidth = $(window).width();\n\t\t\tvar windowHeight = $(window).height();\n\t\t\tvar deltaX = Math.abs(touchX - Math.min(windowWidth, Math.max(0, e.touches[0].clientX)));\n\t\t\tvar deltaY = Math.abs(touchY - Math.min(windowHeight, Math.max(0, e.touches[0].clientY)));\n\t\t\ttouchX = Math.min(windowWidth, Math.max(0, e.touches[0].clientX));\n\t\t\ttouchY = Math.min(windowHeight, Math.max(0, e.touches[0].clientY));\n\t\t\tif (deltaX >= deltaY && firstMove) {\n\t\t\t\tisNavigating = true;\n\t\t\t\ttouchIntervalId = setInterval(updateTooltip, 100);\n\t\t\t}\n\t\t\tif (isNavigating) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tvar percent = touchX / windowWidth;\n\t\t\t\tindex = Math.max(1, Math.ceil(count * percent));\n\t\t\t\tindex = index > count ? count : index;\n\t\t\t\tif (firstMove) {\n\t\t\t\t\tupdateTooltip(function () {\n\t\t\t\t\t\ttouchTooltipEl.removeClass('hidden');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tnavigator.updateTextAndProgressBar();\n\t\t\t}\n\t\t\tfirstMove = false;\n\t\t}).on('touchend', function () {\n\t\t\tif (touchIntervalId) {\n\t\t\t\tclearInterval(touchIntervalId);\n\t\t\t\ttouchIntervalId = 0;\n\t\t\t}\n\n\t\t\tif (isNavigating) {\n\t\t\t\ttouchTooltipEl.addClass('hidden');\n\t\t\t\tnavigator.scrollToIndex(index - 1, true, 0);\n\t\t\t\tisNavigating = false;\n\t\t\t}\n\t\t});\n\n\t\thandleKeys();\n\n\t\tnavigator.setCount(count);\n\t\tnavigator.update(0);\n\t};\n\n\tfunction updateTooltip(callback) {\n\t\tcallback = callback || function () {};\n\t\tif (touchIndex === index) {\n\t\t\treturn;\n\t\t}\n\t\ttouchIndex = index;\n\t\ttouchTooltipEl.css({ left: Math.min($(window).width() - touchTooltipEl.outerWidth(), Math.max(touchX - (touchTooltipEl.outerWidth() / 2), 0)) });\n\n\t\tsocket.emit('posts.getTimestampByIndex', { tid: ajaxify.data.tid, index: index - 1 }, function (err, timestamp) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tvar date = new Date(timestamp);\n\t\t\tvar ds = date.toLocaleString(config.userLang, { month: 'long' });\n\t\t\ttouchTooltipEl.find('.text').translateText('[[global:pagination.out_of, ' + index + ', ' + count + ']]');\n\t\t\tif (timestamp > Date.now() - (30 * 24 * 60 * 60 * 1000)) {\n\t\t\t\ttouchTooltipEl.find('.time').text(ds + ' ' + date.getDate());\n\t\t\t} else {\n\t\t\t\ttouchTooltipEl.find('.time').text(ds + ' ' + date.getFullYear());\n\t\t\t}\n\t\t\tcallback();\n\t\t});\n\t}\n\n\tfunction handleKeys() {\n\t\tif (!config.usePagination) {\n\t\t\t$(window).off('keydown', onKeyDown).on('keydown', onKeyDown);\n\t\t}\n\t}\n\n\tfunction onKeyDown(ev) {\n\t\tif (ev.target.nodeName === 'BODY') {\n\t\t\tif (ev.shiftKey || ev.ctrlKey || ev.altKey) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (ev.which === 36 && navigator.toTop) { // home key\n\t\t\t\tnavigator.toTop();\n\t\t\t\treturn false;\n\t\t\t} else if (ev.which === 35 && navigator.toBottom) { // end key\n\t\t\t\tnavigator.toBottom();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction generateUrl(index) {\n\t\tvar pathname = window.location.pathname.replace(config.relative_path, '');\n\t\tvar parts = pathname.split('/');\n\t\treturn parts[1] + '/' + parts[2] + '/' + parts[3] + (index ? '/' + index : '');\n\t}\n\n\tnavigator.setCount = function (value) {\n\t\tcount = parseInt(value, 10);\n\t\tnavigator.updateTextAndProgressBar();\n\t};\n\n\tnavigator.show = function () {\n\t\ttoggle(true);\n\t};\n\n\tnavigator.disable = function () {\n\t\tcount = 0;\n\t\tindex = 1;\n\t\tnavigator.callback = null;\n\t\tnavigator.selector = null;\n\t\t$(window).off('scroll', navigator.delayedUpdate);\n\n\t\ttoggle(false);\n\t};\n\n\tfunction toggle(flag) {\n\t\tvar path = ajaxify.removeRelativePath(window.location.pathname.slice(1));\n\t\tif (flag && (!path.startsWith('topic') && !path.startsWith('category'))) {\n\t\t\treturn;\n\t\t}\n\n\t\tpaginationBlockEl.toggleClass('ready', flag);\n\t}\n\n\tnavigator.delayedUpdate = function () {\n\t\tif (!navigatorUpdateTimeoutId) {\n\t\t\tnavigatorUpdateTimeoutId = setTimeout(function () {\n\t\t\t\tnavigator.update();\n\t\t\t\tnavigatorUpdateTimeoutId = undefined;\n\t\t\t}, 100);\n\t\t}\n\t};\n\n\tnavigator.update = function (threshold) {\n\t\t/*\n\t\t\tThe \"threshold\" is defined as the distance from the top of the page to\n\t\t\ta spot where a user is expecting to begin reading.\n\t\t*/\n\t\tthreshold = typeof threshold === 'number' ? threshold : undefined;\n\n\t\tvar els = $(navigator.selector);\n\t\tif (els.length) {\n\t\t\tindex = parseInt(els.first().attr('data-index'), 10) + 1;\n\t\t}\n\n\t\tvar scrollTop = $(window).scrollTop();\n\t\tvar windowHeight = $(window).height();\n\t\tvar documentHeight = $(document).height();\n\t\tvar middleOfViewport = scrollTop + (windowHeight / 2);\n\t\tvar previousDistance = Number.MAX_VALUE;\n\t\tels.each(function () {\n\t\t\tvar distanceToMiddle = Math.abs(middleOfViewport - $(this).offset().top);\n\n\t\t\tif (distanceToMiddle > previousDistance) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (distanceToMiddle < previousDistance) {\n\t\t\t\tindex = parseInt($(this).attr('data-index'), 10) + 1;\n\t\t\t\tpreviousDistance = distanceToMiddle;\n\t\t\t}\n\t\t});\n\n\t\tvar atTop = scrollTop === 0 && parseInt(els.first().attr('data-index'), 10) === 0;\n\t\tvar nearBottom = scrollTop + windowHeight > documentHeight - 100 && parseInt(els.last().attr('data-index'), 10) === count - 1;\n\n\t\tif (atTop) {\n\t\t\tindex = 1;\n\t\t} else if (nearBottom) {\n\t\t\tindex = count;\n\t\t}\n\n\t\t// If a threshold is undefined, try to determine one based on new index\n\t\tif (threshold === undefined && ajaxify.data.template.topic === true) {\n\t\t\tif (atTop) {\n\t\t\t\tthreshold = 0;\n\t\t\t} else {\n\t\t\t\tvar anchorEl = components.get('post/anchor', index - 1);\n\t\t\t\tif (anchorEl.length) {\n\t\t\t\t\tvar anchorRect = anchorEl.get(0).getBoundingClientRect();\n\t\t\t\t\tthreshold = anchorRect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (typeof navigator.callback === 'function') {\n\t\t\tnavigator.callback(index, count, threshold);\n\t\t}\n\n\t\tnavigator.updateTextAndProgressBar();\n\t\ttoggle(!!count);\n\t};\n\n\tnavigator.updateTextAndProgressBar = function () {\n\t\tif (!utils.isNumber(index)) {\n\t\t\treturn;\n\t\t}\n\t\tindex = index > count ? count : index;\n\t\tpaginationTextEl.translateHtml('[[global:pagination.out_of, ' + index + ', ' + count + ']]');\n\t\tvar fraction = (index - 1) / (count - 1 || 1);\n\t\tpaginationBlockMeterEl.val(fraction);\n\t\tpaginationBlockProgressEl.width((fraction * 100) + '%');\n\t};\n\n\tnavigator.scrollUp = function () {\n\t\tvar $window = $(window);\n\n\t\tif (config.usePagination) {\n\t\t\tvar atTop = $window.scrollTop() <= 0;\n\t\t\tif (atTop) {\n\t\t\t\treturn pagination.previousPage(function () {\n\t\t\t\t\t$('body,html').scrollTop($(document).height() - $window.height());\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t$('body,html').animate({\n\t\t\tscrollTop: $window.scrollTop() - $window.height(),\n\t\t});\n\t};\n\n\tnavigator.scrollDown = function () {\n\t\tvar $window = $(window);\n\n\t\tif (config.usePagination) {\n\t\t\tvar atBottom = $window.scrollTop() >= $(document).height() - $window.height();\n\t\t\tif (atBottom) {\n\t\t\t\treturn pagination.nextPage();\n\t\t\t}\n\t\t}\n\t\t$('body,html').animate({\n\t\t\tscrollTop: $window.scrollTop() + $window.height(),\n\t\t});\n\t};\n\n\tnavigator.scrollTop = function (index) {\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\n\t\t\tnavigator.scrollToIndex(index, true);\n\t\t} else {\n\t\t\tajaxify.go(generateUrl());\n\t\t}\n\t};\n\n\tnavigator.scrollBottom = function (index) {\n\t\tif (parseInt(index, 10) < 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\n\t\t\tnavigator.scrollToIndex(index, true);\n\t\t} else {\n\t\t\tindex = parseInt(index, 10) + 1;\n\t\t\tajaxify.go(generateUrl(index));\n\t\t}\n\t};\n\n\tnavigator.scrollToIndex = function (index, highlight, duration) {\n\t\tvar inTopic = !!components.get('topic').length;\n\t\tvar inCategory = !!components.get('category').length;\n\n\t\tif (!utils.isNumber(index) || (!inTopic && !inCategory)) {\n\t\t\treturn;\n\t\t}\n\n\t\tduration = duration !== undefined ? duration : 400;\n\t\tnavigator.scrollActive = true;\n\n\t\t// if in topic and item already on page\n\t\tif (inTopic && components.get('post/anchor', index).length) {\n\t\t\treturn navigator.scrollToPostIndex(index, highlight, duration);\n\t\t}\n\n\t\t// if in category and item alreay on page\n\t\tif (inCategory && $('[component=\"category/topic\"][data-index=\"' + index + '\"]').length) {\n\t\t\treturn navigator.scrollToTopicIndex(index, highlight, duration);\n\t\t}\n\n\t\tif (!config.usePagination) {\n\t\t\tnavigator.scrollActive = false;\n\t\t\tindex = parseInt(index, 10) + 1;\n\t\t\tajaxify.go(generateUrl(index));\n\t\t\treturn;\n\t\t}\n\n\t\tvar scrollMethod = inTopic ? navigator.scrollToPostIndex : navigator.scrollToTopicIndex;\n\n\t\tvar page = 1 + Math.floor(index / config.postsPerPage);\n\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\n\t\t\tpagination.loadPage(page, function () {\n\t\t\t\tscrollMethod(index, highlight, duration);\n\t\t\t});\n\t\t} else {\n\t\t\tscrollMethod(index, highlight, duration);\n\t\t}\n\t};\n\n\tnavigator.scrollToPostIndex = function (postIndex, highlight, duration) {\n\t\tvar scrollTo = components.get('post', 'index', postIndex);\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\n\t};\n\n\tnavigator.scrollToTopicIndex = function (topicIndex, highlight, duration) {\n\t\tvar scrollTo = $('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]');\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\n\t};\n\n\tnavigator.scrollToElement = function (scrollTo, highlight, duration) {\n\t\tif (!scrollTo.length) {\n\t\t\tnavigator.scrollActive = false;\n\t\t\treturn;\n\t\t}\n\t\tvar postHeight = scrollTo.height();\n\t\tvar viewportHeight = $(window).height();\n\t\tvar navbarHeight = components.get('navbar').height();\n\n\t\t// Temporarily disable navigator update on scroll\n\t\t$(window).off('scroll', navigator.update);\n\n\t\tduration = duration !== undefined ? duration : 400;\n\t\tnavigator.scrollActive = true;\n\t\tvar done = false;\n\n\t\tfunction animateScroll() {\n\t\t\tfunction onAnimateComplete() {\n\t\t\t\tif (done) {\n\t\t\t\t\t// Re-enable onScroll behaviour\n\t\t\t\t\t$(window).on('scroll', navigator.update);\n\t\t\t\t\tvar scrollToRect = scrollTo.get(0).getBoundingClientRect();\n\t\t\t\t\tnavigator.update(scrollToRect.top);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdone = true;\n\n\t\t\t\tnavigator.scrollActive = false;\n\t\t\t\thighlightPost();\n\t\t\t\t$('body').scrollTop($('body').scrollTop() - 1);\n\t\t\t\t$('html').scrollTop($('html').scrollTop() - 1);\n\t\t\t}\n\n\t\t\tvar scrollTop = 0;\n\t\t\tif (postHeight < viewportHeight) {\n\t\t\t\tscrollTop = (scrollTo.offset().top - (viewportHeight / 2) + (postHeight / 2));\n\t\t\t} else {\n\t\t\t\tscrollTop = scrollTo.offset().top - navbarHeight;\n\t\t\t}\n\t\t\tif (duration === 0) {\n\t\t\t\t$(window).scrollTop(scrollTop);\n\t\t\t\treturn onAnimateComplete();\n\t\t\t}\n\t\t\t$('html, body').animate({\n\t\t\t\tscrollTop: scrollTop + 'px',\n\t\t\t}, duration, onAnimateComplete);\n\t\t}\n\n\t\tfunction highlightPost() {\n\t\t\tif (highlight) {\n\t\t\t\tscrollTo.addClass('highlight');\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tscrollTo.removeClass('highlight');\n\t\t\t\t}, 10000);\n\t\t\t}\n\t\t}\n\n\t\tanimateScroll();\n\t};\n\n\treturn navigator;\n});\n"]}