{"version":3,"sources":["public/src/modules/topicList.js"],"names":["define","infinitescroll","handleBack","topicSelect","categorySearch","categoryTools","TopicList","templateName","tplToSort","recent","unread","popular","top","newTopicCount","newPostCount","loadTopicsCallback","topicListEl","$","window","on","removeListeners","init","template","cb","findTopicListElement","loadTopicsAfter","watchForNewPosts","handleCategorySelection","config","usePagination","loadMoreTopics","after","handleBackCallback","data","loadCallback","onTopicsLoaded","topics","ajaxify","showSelect","height","children","length","show","trigger","filter","i","e","parents","this","addClass","socket","onNewTopic","onNewPost","removeListener","isCategoryVisible","cid","categories","some","c","parseInt","selectedCids","indexOf","selectedFilter","category","updateAlertText","post","posts","topic","isFollowing","mainPid","pid","text","translateText","removeClass","fadeIn","getSelectedCids","cids","each","index","el","find","push","attr","sort","a","b","changed","forEach","url","location","pathname","currentParams","utils","params","decodeURIComponent","param","go","ev","selectChildren","parentCid","flag","toggleClass","categoryEl","link","ctrlKey","hasClass","first","direction","afterEl","last","isNumber","done","callback","query","loadMore","count","topicsPerPage","term","selectedTerm","set","filterTopicsOnDom","tid","hide","before","topicEls","tplData","name","app","parseAndTranslate","html","remove","insertAfter","document","scrollTop","insertBefore","append","getSelectedTids","removeExtra","timeago","createUserTooltips","makeNumbersHumanReadable"],"mappings":"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","file":"public/src/modules/topicList.js","sourcesContent":["'use strict';\n\ndefine('topicList', [\n\t'forum/infinitescroll',\n\t'handleBack',\n\t'topicSelect',\n\t'categorySearch',\n\t'forum/category/tools',\n], function (infinitescroll, handleBack, topicSelect, categorySearch, categoryTools) {\n\tvar TopicList = {};\n\tvar templateName = '';\n\n\tvar tplToSort = {\n\t\trecent: 'recent',\n\t\tunread: 'unread',\n\t\tpopular: 'posts',\n\t\ttop: 'votes',\n\t};\n\n\tvar newTopicCount = 0;\n\tvar newPostCount = 0;\n\n\tvar loadTopicsCallback;\n\tvar topicListEl;\n\n\t$(window).on('action:ajaxify.start', function () {\n\t\tTopicList.removeListeners();\n\t\tcategoryTools.removeListeners();\n\t});\n\n\tTopicList.init = function (template, cb) {\n\t\ttopicListEl = findTopicListElement();\n\n\t\ttemplateName = template;\n\t\tloadTopicsCallback = cb || loadTopicsAfter;\n\n\t\tcategoryTools.init();\n\n\t\tTopicList.watchForNewPosts();\n\n\t\tTopicList.handleCategorySelection();\n\n\t\tif (!config.usePagination) {\n\t\t\tinfinitescroll.init(TopicList.loadMoreTopics);\n\t\t}\n\n\t\thandleBack.init(function (after, handleBackCallback) {\n\t\t\tloadTopicsCallback(after, 1, function (data, loadCallback) {\n\t\t\t\tTopicList.onTopicsLoaded(templateName, data.topics, ajaxify.data.showSelect, 1, function () {\n\t\t\t\t\thandleBackCallback();\n\t\t\t\t\tloadCallback();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tif ($('body').height() <= $(window).height() && topicListEl.children().length >= 20) {\n\t\t\t$('#load-more-btn').show();\n\t\t}\n\n\t\t$('#load-more-btn').on('click', function () {\n\t\t\tTopicList.loadMoreTopics(1);\n\t\t});\n\n\t\t$(window).trigger('action:topics.loaded', { topics: ajaxify.data.topics });\n\t};\n\n\tfunction findTopicListElement() {\n\t\treturn $('[component=\"category\"]').filter(function (i, e) {\n\t\t\treturn !$(e).parents('[widget-area],[data-widget-area]').length;\n\t\t});\n\t}\n\n\tTopicList.watchForNewPosts = function () {\n\t\t$('#new-topics-alert').on('click', function () {\n\t\t\t$(this).addClass('hide');\n\t\t});\n\t\tnewPostCount = 0;\n\t\tnewTopicCount = 0;\n\t\tTopicList.removeListeners();\n\t\tsocket.on('event:new_topic', onNewTopic);\n\t\tsocket.on('event:new_post', onNewPost);\n\t};\n\n\tTopicList.removeListeners = function () {\n\t\tsocket.removeListener('event:new_topic', onNewTopic);\n\t\tsocket.removeListener('event:new_post', onNewPost);\n\t};\n\n\tfunction isCategoryVisible(cid) {\n\t\treturn ajaxify.data.categories && ajaxify.data.categories.length && ajaxify.data.categories.some(function (c) {\n\t\t\treturn parseInt(c.cid, 10) === parseInt(cid, 10);\n\t\t});\n\t}\n\n\tfunction onNewTopic(data) {\n\t\tif (\n\t\t\t(ajaxify.data.selectedCids && ajaxify.data.selectedCids.length && ajaxify.data.selectedCids.indexOf(parseInt(data.cid, 10)) === -1) ||\n\t\t\t(ajaxify.data.selectedFilter && ajaxify.data.selectedFilter.filter === 'watched') ||\n\t\t\t(ajaxify.data.template.category && parseInt(ajaxify.data.cid, 10) !== parseInt(data.cid, 10)) ||\n\t\t\t(!isCategoryVisible(data.cid))\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tnewTopicCount += 1;\n\t\tupdateAlertText();\n\t}\n\n\tfunction onNewPost(data) {\n\t\tvar post = data.posts[0];\n\t\tif (!post || !post.topic) {\n\t\t\treturn;\n\t\t}\n\t\tif (!post.topic.isFollowing && (\n\t\t\t(parseInt(post.topic.mainPid, 10) === parseInt(post.pid, 10)) ||\n\t\t\t(ajaxify.data.selectedCids && ajaxify.data.selectedCids.length && ajaxify.data.selectedCids.indexOf(parseInt(post.topic.cid, 10)) === -1) ||\n\t\t\t(ajaxify.data.selectedFilter && ajaxify.data.selectedFilter.filter === 'new') ||\n\t\t\t(ajaxify.data.selectedFilter && ajaxify.data.selectedFilter.filter === 'watched' && !post.topic.isFollowing) ||\n\t\t\t(ajaxify.data.template.category && parseInt(ajaxify.data.cid, 10) !== parseInt(post.topic.cid, 10)) ||\n\t\t\t(!isCategoryVisible(post.topic.cid))\n\t\t)) {\n\t\t\treturn;\n\t\t}\n\n\t\tnewPostCount += 1;\n\t\tupdateAlertText();\n\t}\n\n\tfunction updateAlertText() {\n\t\tvar text = '';\n\n\t\tif (newTopicCount === 0) {\n\t\t\tif (newPostCount === 1) {\n\t\t\t\ttext = '[[recent:there-is-a-new-post]]';\n\t\t\t} else if (newPostCount > 1) {\n\t\t\t\ttext = '[[recent:there-are-new-posts, ' + newPostCount + ']]';\n\t\t\t}\n\t\t} else if (newTopicCount === 1) {\n\t\t\tif (newPostCount === 0) {\n\t\t\t\ttext = '[[recent:there-is-a-new-topic]]';\n\t\t\t} else if (newPostCount === 1) {\n\t\t\t\ttext = '[[recent:there-is-a-new-topic-and-a-new-post]]';\n\t\t\t} else if (newPostCount > 1) {\n\t\t\t\ttext = '[[recent:there-is-a-new-topic-and-new-posts, ' + newPostCount + ']]';\n\t\t\t}\n\t\t} else if (newTopicCount > 1) {\n\t\t\tif (newPostCount === 0) {\n\t\t\t\ttext = '[[recent:there-are-new-topics, ' + newTopicCount + ']]';\n\t\t\t} else if (newPostCount === 1) {\n\t\t\t\ttext = '[[recent:there-are-new-topics-and-a-new-post, ' + newTopicCount + ']]';\n\t\t\t} else if (newPostCount > 1) {\n\t\t\t\ttext = '[[recent:there-are-new-topics-and-new-posts, ' + newTopicCount + ', ' + newPostCount + ']]';\n\t\t\t}\n\t\t}\n\n\t\ttext += ' [[recent:click-here-to-reload]]';\n\n\t\t$('#new-topics-alert').translateText(text).removeClass('hide').fadeIn('slow');\n\t\t$('#category-no-topics').addClass('hide');\n\t}\n\n\tTopicList.handleCategorySelection = function () {\n\t\tfunction getSelectedCids() {\n\t\t\tvar cids = [];\n\t\t\t$('[component=\"category/list\"] [data-cid]').each(function (index, el) {\n\t\t\t\tif ($(el).find('i.fa-check').length) {\n\t\t\t\t\tcids.push(parseInt($(el).attr('data-cid'), 10));\n\t\t\t\t}\n\t\t\t});\n\t\t\tcids.sort(function (a, b) {\n\t\t\t\treturn a - b;\n\t\t\t});\n\t\t\treturn cids;\n\t\t}\n\n\t\tcategorySearch.init($('[component=\"category/dropdown\"]'));\n\n\t\t$('[component=\"category/dropdown\"]').on('hidden.bs.dropdown', function () {\n\t\t\tvar cids = getSelectedCids();\n\t\t\tvar changed = ajaxify.data.selectedCids.length !== cids.length;\n\t\t\tajaxify.data.selectedCids.forEach(function (cid, index) {\n\t\t\t\tif (cid !== cids[index]) {\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (changed) {\n\t\t\t\tvar url = window.location.pathname;\n\t\t\t\tvar currentParams = utils.params();\n\t\t\t\tif (cids.length) {\n\t\t\t\t\tcurrentParams.cid = cids;\n\t\t\t\t\turl += '?' + decodeURIComponent($.param(currentParams));\n\t\t\t\t}\n\t\t\t\tajaxify.go(url);\n\t\t\t}\n\t\t});\n\n\t\t$('[component=\"category/list\"]').on('click', '[data-cid]', function (ev) {\n\t\t\tfunction selectChildren(parentCid, flag) {\n\t\t\t\t$('[component=\"category/list\"] [data-parent-cid=\"' + parentCid + '\"] [component=\"category/select/icon\"]').toggleClass('fa-check', flag);\n\t\t\t\t$('[component=\"category/list\"] [data-parent-cid=\"' + parentCid + '\"]').each(function (index, el) {\n\t\t\t\t\tselectChildren($(el).attr('data-cid'), flag);\n\t\t\t\t});\n\t\t\t}\n\t\t\tvar categoryEl = $(this);\n\t\t\tvar link = categoryEl.find('a').attr('href');\n\t\t\tif (link && link !== '#' && link.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar cid = categoryEl.attr('data-cid');\n\t\t\tif (ev.ctrlKey) {\n\t\t\t\tselectChildren(cid, !categoryEl.find('[component=\"category/select/icon\"]').hasClass('fa-check'));\n\t\t\t}\n\t\t\tcategoryEl.find('[component=\"category/select/icon\"]').toggleClass('fa-check');\n\t\t\t$('[component=\"category/list\"] li').first().find('i').toggleClass('fa-check', !getSelectedCids().length);\n\t\t\treturn false;\n\t\t});\n\t};\n\n\tTopicList.loadMoreTopics = function (direction) {\n\t\tif (!topicListEl.length || !topicListEl.children().length) {\n\t\t\treturn;\n\t\t}\n\t\tvar topics = topicListEl.find('[component=\"category/topic\"]');\n\t\tvar afterEl = direction > 0 ? topics.last() : topics.first();\n\t\tvar after = (parseInt(afterEl.attr('data-index'), 10) || 0) + (direction > 0 ? 1 : 0);\n\n\t\tif (!utils.isNumber(after) || (after === 0 && topicListEl.find('[component=\"category/topic\"][data-index=\"0\"]').length)) {\n\t\t\treturn;\n\t\t}\n\n\t\tloadTopicsCallback(after, direction, function (data, done) {\n\t\t\tTopicList.onTopicsLoaded(templateName, data.topics, ajaxify.data.showSelect, direction, done);\n\t\t});\n\t};\n\n\tfunction loadTopicsAfter(after, direction, callback) {\n\t\tcallback = callback || function () {};\n\t\tvar query = utils.params();\n\t\tinfinitescroll.loadMore('topics.loadMoreSortedTopics', {\n\t\t\tafter: after,\n\t\t\tdirection: direction,\n\t\t\tsort: tplToSort[templateName],\n\t\t\tcount: config.topicsPerPage,\n\t\t\tcid: query.cid,\n\t\t\tquery: query,\n\t\t\tterm: ajaxify.data.selectedTerm && ajaxify.data.selectedTerm.term,\n\t\t\tfilter: ajaxify.data.selectedFilter.filter,\n\t\t\tset: topicListEl.attr('data-set') ? topicListEl.attr('data-set') : 'topics:recent',\n\t\t}, callback);\n\t}\n\n\tfunction filterTopicsOnDom(topics) {\n\t\treturn topics.filter(function (topic) {\n\t\t\treturn !topicListEl.find('[component=\"category/topic\"][data-tid=\"' + topic.tid + '\"]').length;\n\t\t});\n\t}\n\n\tTopicList.onTopicsLoaded = function (templateName, topics, showSelect, direction, callback) {\n\t\tif (!topics || !topics.length) {\n\t\t\t$('#load-more-btn').hide();\n\t\t\treturn callback();\n\t\t}\n\t\ttopics = filterTopicsOnDom(topics);\n\n\t\tif (!topics.length) {\n\t\t\t$('#load-more-btn').hide();\n\t\t\treturn callback();\n\t\t}\n\n\t\tvar after;\n\t\tvar before;\n\t\tvar topicEls = topicListEl.find('[component=\"category/topic\"]');\n\n\t\tif (direction > 0 && topics.length) {\n\t\t\tafter = topicEls.last();\n\t\t} else if (direction < 0 && topics.length) {\n\t\t\tbefore = topicEls.first();\n\t\t}\n\n\t\tvar tplData = {\n\t\t\ttopics: topics,\n\t\t\tshowSelect: showSelect,\n\t\t\ttemplate: {\n\t\t\t\tname: templateName,\n\t\t\t},\n\t\t};\n\t\ttplData.template[templateName] = true;\n\n\t\tapp.parseAndTranslate(templateName, 'topics', tplData, function (html) {\n\t\t\ttopicListEl.removeClass('hidden');\n\t\t\t$('#category-no-topics').remove();\n\n\t\t\tif (after && after.length) {\n\t\t\t\thtml.insertAfter(after);\n\t\t\t} else if (before && before.length) {\n\t\t\t\tvar height = $(document).height();\n\t\t\t\tvar scrollTop = $(window).scrollTop();\n\n\t\t\t\thtml.insertBefore(before);\n\n\t\t\t\t$(window).scrollTop(scrollTop + ($(document).height() - height));\n\t\t\t} else {\n\t\t\t\ttopicListEl.append(html);\n\t\t\t}\n\n\t\t\tif (!topicSelect.getSelectedTids().length) {\n\t\t\t\tinfinitescroll.removeExtra(topicListEl.find('[component=\"category/topic\"]'), direction, config.topicsPerPage * 3);\n\t\t\t}\n\n\t\t\thtml.find('.timeago').timeago();\n\t\t\tapp.createUserTooltips(html);\n\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\n\t\t\t$(window).trigger('action:topics.loaded', { topics: topics, template: templateName });\n\t\t\tcallback();\n\t\t});\n\t};\n\n\treturn TopicList;\n});\n"]}