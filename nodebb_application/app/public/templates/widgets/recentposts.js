!function(t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd&&define(t)}(function(){function p(t,s,r,n,e){var o=t.__escape;return'<div class="recent-replies">\r\n\t<ul id="recent_posts" data-numposts="'+o(r(s&&s.numPosts))+'" data-cid="'+o(r(s&&s.cid))+'">\r\n\t'+p.blocks.posts(t,s,r,n,e)+"\r\n\t</ul>\r\n</div>\r\n\r\n<script>\r\n'use strict';\r\n/* globals app, socket, translator, templates*/\r\n(function() {\r\n\tfunction onLoad() {\r\n\t\tvar replies = $('#recent_posts');\r\n\r\n\t\tapp.createUserTooltips();\r\n\t\tprocessHtml(replies);\r\n\r\n\t\tvar recentPostsWidget = app.widgets.recentPosts;\r\n\t\tvar numPosts = parseInt(replies.attr('data-numposts'), 10) || 4;\r\n\r\n\t\tif (!recentPostsWidget) {\r\n\t\t\trecentPostsWidget = {};\r\n\t\t\trecentPostsWidget.onNewPost = function(data) {\r\n\r\n\t\t\t\tvar cid = replies.attr('data-cid');\r\n\t\t\t\tvar recentPosts = $('#recent_posts');\r\n\t\t\t\tif (!recentPosts.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (cid && parseInt(cid, 10) !== parseInt(data.posts[0].topic.cid, 10)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.parseAndTranslate('partials/posts', {\r\n\t\t\t\t\trelative_path: config.relative_path,\r\n\t\t\t\t\tposts: data.posts\r\n\t\t\t\t}, function(html) {\r\n\t\t\t\t\tprocessHtml(html);\r\n\r\n\t\t\t\t\thtml.hide()\r\n\t\t\t\t\t\t.prependTo(recentPosts)\r\n\t\t\t\t\t\t.fadeIn();\r\n\r\n\t\t\t\t\tapp.createUserTooltips();\r\n\t\t\t\t\tif (recentPosts.children().length > numPosts) {\r\n\t\t\t\t\t\trecentPosts.children().last().remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tapp.widgets.recentPosts = recentPostsWidget;\r\n\t\t\tsocket.on('event:new_post', app.widgets.recentPosts.onNewPost);\r\n\t\t}\r\n\r\n\t\tfunction processHtml(html) {\r\n\t\t\thtml.find('img:not(.not-responsive)').addClass('img-responsive');\r\n\t\t\thtml.find('span.timeago').timeago();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tif (window.jQuery) {\r\n\t\tonLoad();\r\n\t} else {\r\n\t\twindow.addEventListener('load', onLoad);\r\n\t}\r\n})();\r\n<\/script>\r\n"}return p.blocks={posts:function(t,s,r,n){var e=t.__escape;return n(r(s&&s.posts),function(t){return'\r\n<li data-pid="'+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].pid))+'" class="clearfix widget-posts">\r\n\t<a href="'+(r(s&&s.posts&&s.posts[t]&&s.posts[t].user&&s.posts[t].user.userslug)?e(r(s&&s.relative_path))+"/user/"+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].user&&s.posts[t].user.userslug)):"#")+'">\r\n\r\n\t\t'+(r(s&&s.posts&&s.posts[t]&&s.posts[t].user&&s.posts[t].user.picture)?'\r\n\t\t<img title="'+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].user&&s.posts[t].user.username))+'" class="avatar avatar-sm not-responsive" src="'+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].user&&s.posts[t].user.picture))+'" />\r\n\t\t':'\r\n\t\t<div title="'+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].user&&s.posts[t].user.username))+'" class="avatar avatar-sm not-responsive" style="background-color: '+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].user&&s.posts[t].user["icon:bgColor"]))+';">'+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].user&&s.posts[t].user["icon:text"]))+"</div>\r\n\t\t")+"\r\n\t</a>\r\n\t<div>\r\n\t\t"+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].content))+'\r\n\t\t<p class="fade-out"></p>\r\n\t</div>\r\n\t<span class="pull-right post-preview-footer">\r\n\t\t<span class="timeago" title="'+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].timestampISO))+'"></span> &bull;\r\n\t\t<a href="'+e(r(s&&s.relative_path))+"/post/"+e(r(s&&s.posts&&s.posts[t]&&s.posts[t].pid))+'">[[global:read_more]]</a>\r\n\t</span>\r\n</li>\r\n'},function(){return""})}},p});